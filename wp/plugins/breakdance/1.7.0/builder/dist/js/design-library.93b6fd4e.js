(()=>{"use strict";var t={78533:(t,e,s)=>{var a=s(20144),i=s(85450),r=s(49026),o=s(74604),l=s(82202),n=s(31096),p=s(37179),d=function(){var t=this,e=t._self._c;t._self._setupProxy;return e(n.Z,{staticClass:"breakdance-admin-wp"},[t.isLoading?e("Loading"):t._e(),e("Notifications"),e("div",{staticClass:"design-library"},[e("h1",{staticClass:"design-library__title"},[t._v("Design Library")]),e("div",{staticClass:"design-library__grid"},t._l(t.designProviders,(function(s){return e("div",{key:s.name,staticClass:"design-library-item"},[e("div",{staticClass:"design-library-item__preview"},[e(p.Z,{staticClass:"design-library-item__preview-button",attrs:{href:s.url,target:"_blank",color:"secondary",rounded:""}},[t._v(" Live Preview ")]),t.templateThumbnailUrl(s.meta)?e("img",{staticClass:"design-library-item__thubmnail",attrs:{src:t.templateThumbnailUrl(s.meta),width:"300",alt:`Thumbnail image for the ${s.name} site`}}):t._e(),e("Icon",{staticClass:"design-library-item__thumbnail-icon",attrs:{else:"",icon:"ImageIcon",size:"24"}})],1),e("div",[e("div",{staticClass:"design-library-item__meta"},[e("h2",{staticClass:"design-library-item__title"},[t._v(" "+t._s(s.name)+" ")]),e(p.Z,{staticClass:"design-library-item__import-button",attrs:{size:"sm",color:"blue",dark:""},on:{click:function(e){return t.setProviderToImport(s.url)}}},[t._v(" Import ")])],1)])])})),0)]),t.showOverrideWarning?e("Dialog",{attrs:{value:!0,width:500},on:{close:t.closeOverrideWarningDialog,"click:outside":t.closeOverrideWarningDialog,keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.closeOverrideWarningDialog.apply(null,arguments)}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(' Import the "'+t._s(t.providerToImport?t.providerToImport.name:"")+'" site ')]},proxy:!0},{key:"text",fn:function(){return[t.loadedData.fullSiteLastImportedFromUrl?e(l.Z,{attrs:{color:"red",text:""}},[t.loadedData.fullSiteLastImportedFromUrl===t.providerToImport.url?e("span",{staticClass:"text-body-2"},[t._v(" You already did full site import for this site ")]):e("span",{staticClass:"text-body-2"},[t._v(' You last did a full site import for the site "'+t._s(t.loadedData.fullSiteLastImportedFromUrl)+'" ')])]):t._e(),e("p",[t._v(" Importing a full site will override your site's "),e("b",[t._v("Global Settings")]),t._v(", "),e("b",[t._v("Breakdance settings")]),t._v(", and also import all "),e("b",[t._v("pages")]),t._v(", "),e("b",[t._v("posts")]),t._v(", and "),e("b",[t._v("templates")]),t._v(" from the design set. ")]),e("p",[t._v(" It will also trash all your existing "),e("b",[t._v("Templates")]),t._v(", "),e("b",[t._v("Headers")]),t._v(", "),e("b",[t._v("Footers")]),t._v(", "),e("b",[t._v("Global Blocks")]),t._v(", and "),e("b",[t._v("Popups")]),t._v(". You can restore them from the trash after the import. ")])]},proxy:!0},{key:"actions",fn:function(){return[e(p.Z,{attrs:{text:""},on:{click:t.closeOverrideWarningDialog}},[t._v(" Cancel ")]),e(p.Z,{attrs:{color:"blue",dark:""},on:{click:t.importFullSite}},[t._v(" Confirm Overwrite & Import ")])]},proxy:!0}],null,!1,1068894658)}):t._e(),t.showImportingDialog?e("DesignLibraryImportingDialog",{attrs:{value:t.providerToImport},on:{close:t.closeImportingDialog}}):t._e()],1)},u=[],m=s(70655),g=s(14391),c=s(75051),h=s(3735),_=s(48973),y=s(98851),v=s(92260),b=s(77986),I=s(89137),f=s(85283),S=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",["loading"===t.status?e("Icon",{staticClass:"design_library__spinning_icon",attrs:{icon:"SpinnerIcon",title:"Importing the data"}}):"success"===t.status||"successNothingToDo"===t.status?e("Icon",{staticClass:"design_library__icon_success",attrs:{icon:"CheckSquareIcon",title:"Success loading the data"}}):"error"!==t.status&&t.status?"partialError"===t.status?e("Icon",{staticClass:"design_library__icon_partial_error",attrs:{icon:"ExclamationMarkCircleIcon",title:"Some requests failed. Try again"}}):t._e():e("Icon",{staticClass:"design_library__icon_error",attrs:{icon:"CloseSquareIcon",title:"There was an error loading the data"}})],1)},D=[];let T=class extends a.ZP{};(0,m.gn)([(0,g.fI)()],T.prototype,"status",void 0),T=(0,m.gn)([(0,g.wA)({components:{Icon:f.Z}})],T);const k=T,P=k;var w=s(1001),O=(0,w.Z)(P,S,D,!1,null,null,null);const Z=O.exports;var C=s(73385),B=s(75223),x=s(12570),A=function(){var t=this,e=t._self._c;t._self._setupProxy;return e(x.Z,{attrs:{value:!0,width:500,persistent:!0},on:{input:t.close}},[e(C.Z,{staticClass:"breakdance-dialog",attrs:{tile:"",flat:""}},[e(B.EB,{staticClass:"breakdance-dialog-title"},[t._v(' Importing the "'+t._s(t.value?t.value.name:"")+'" site ')]),e(B.ZB,{staticClass:"breakdance-dialog-contents"},[e("div",{staticClass:"design_library__importing_item"},[e("DesignLibraryStatusIcon",{attrs:{status:t.importingDataStatus["trashingTemplates"]}}),e("div",["loading"===t.importingDataStatus["trashingTemplates"]?e("span",[t._v(" Trashing ")]):"success"===t.importingDataStatus["trashingTemplates"]?e("span",[t._v(" Successfully trashed ")]):"error"===t.importingDataStatus["trashingTemplates"]?e("span",[t._v(" Error trashing ")]):t._e(),t._v(" existing Templates, Headers, Footers, Global Blocks, and Popups. ")])],1),t._l(t.infoToImport,(function(s){return e("div",{staticClass:"design_library__importing_item"},[e("DesignLibraryStatusIcon",{attrs:{status:t.importingDataStatus[s.statusKey]}}),e("div",["loading"===t.importingDataStatus[s.statusKey]?e("span",[t._v(" Importing ")]):"success"===t.importingDataStatus[s.statusKey]?e("span",[t._v(" Successfully imported ")]):"successNothingToDo"===t.importingDataStatus[s.statusKey]?e("span",[t._v(" Nothing to import for ")]):"error"===t.importingDataStatus[s.statusKey]?e("span",[t._v(" Error importing ")]):"partialError"===t.importingDataStatus[s.statusKey]?e("span",[t._v(" Failed to import all ")]):t._e(),e("b",[t._v(t._s(s.label))])])],1)})),t.canCloseImportingDialog?t._e():e(l.Z,{staticClass:"mt-4",attrs:{text:"",color:"red"}},[e("span",{staticClass:"text-body-2"},[t._v("Please don't close this tab until the import is finished.")])])],2),t.canCloseImportingDialog?e(B.h7,{staticClass:"breakdance-dialog-actions"},[e(p.Z,{on:{click:t.close}},[t._v(" Close ")]),t.getImportedSiteHomepageUrl?e(p.Z,{staticClass:"ml-2",attrs:{href:t.getImportedSiteHomepageUrl,target:"_blank",color:"primary",link:!0}},[t._v(" Open in Breakdance ")]):t._e()],1):t._e()],1)],1)},G=[],F=s(39664),L=s(32521);const H=L.dt({templateIds:L.IX(L.pk),headerIds:L.IX(L.pk),footerIds:L.IX(L.pk),popupIds:L.IX(L.pk),blockIds:L.IX(L.pk)});var N=s(75031);s(64940);function U(){(0,y.D)({action:"breakdance_regenerate_global_settings_cache",decoder:L._4})}var j=s(89412);let K=class extends a.ZP{constructor(){super(...arguments),this.importingDataStatus={trashingTemplates:null,globalSettings:null,postsAndPages:null,templates:null,headers:null,footers:null,popups:null,blocks:null},this.temporaryDataStatus={trashingTemplates:null,globalSettings:null,postsAndPages:null,templates:null,headers:null,footers:null,popups:null,blocks:null},this.remoteHomepageId=null,this.importedHomepageIdOrFirstPostId=null,this.idsOfPostsAndPagesToImport=null}async mounted(){this.value?((0,j.w)(),this.applyStatusToAllTemplateStatuses("loading"),this.importingDataStatus.postsAndPages="loading",this.importingDataStatus.globalSettings="loading",this.importingDataStatus.trashingTemplates="loading",this.setFullSiteLastImportedFromUrl(),this.importGlobalSettings(),await this.getRemoteHomepageId(),this.importPostsAndPages(),await this.trashAllTemplatesHeadersFooters(),this.importAllTemplates()):F.Z.log.errorMessage("Couldn't import site, something went wrong")}get infoToImport(){return[{label:"Global Settings",statusKey:"globalSettings"},{label:"Posts and Pages",statusKey:"postsAndPages"},{label:"Breakdance Templates",statusKey:"templates"},{label:"Breakdance Headers",statusKey:"headers"},{label:"Breakdance Footers",statusKey:"footers"},{label:"Breakdance Popups",statusKey:"popups"},{label:"Breakdance Blocks",statusKey:"blocks"}]}get canCloseImportingDialog(){const t=t=>"loading"!==t;return t(this.importingDataStatus.postsAndPages)&&t(this.importingDataStatus.globalSettings)&&t(this.importingDataStatus.templates)&&t(this.importingDataStatus.blocks)&&t(this.importingDataStatus.popups)&&t(this.importingDataStatus.footers)&&t(this.importingDataStatus.headers)}get getImportedSiteHomepageUrl(){if(!this.value||!this.importedHomepageIdOrFirstPostId||!window.Breakdance.homeUrl)return null;const t=new URL(window.Breakdance.homeUrl);return t.searchParams.append("breakdance","builder"),t.searchParams.append("id",`${this.importedHomepageIdOrFirstPostId}`),t.href}close(){this.$emit("close")}setFullSiteLastImportedFromUrl(){this.value&&(0,y.D)({action:"breakdance_save_arbitrary",dataToPost:{key:"design_library_full_site_last_imported_from_url",data:this.value.url},decoder:L._4})}async importGlobalSettings(){this.value&&(0,h.zG)(await(0,y.D)({action:"breakdance_import_external_global_settings",decoder:N.az,dataToPost:{url:this.value.url},friendlyName:"Importing Global Settings"}),(0,_.g_)((()=>{this.importingDataStatus.globalSettings="error"}),(()=>{U(),this.importingDataStatus.globalSettings="success"})))}async importPostsAndPages(){this.value&&(this.idsOfPostsAndPagesToImport=await this.getPostsIdsToImport(this.value.url),null!==this.idsOfPostsAndPagesToImport?this.idsOfPostsAndPagesToImport.length?this.importPostsAndPagesOneByOne(this.idsOfPostsAndPagesToImport):this.importingDataStatus.postsAndPages="successNothingToDo":this.importingDataStatus.postsAndPages="error")}async getPostsIdsToImport(t){return(0,h.zG)(await(0,y.D)({action:"breakdance_design_lib_get_ids_of_posts_and_pages_to_import",decoder:L.G0([L.IX(L.pk),L.lB]),dataToPost:{url:t},friendlyName:"Getting Posts IDs to import"}),(0,_.g_)((()=>null),(t=>t)))}async importPostsAndPagesOneByOne(t){if(!this.value)return;let e=!1,s=!1,a=null;for(const i of t)(0,h.zG)(await(0,y.D)({action:"breakdance_design_lib_import_post_or_page",decoder:L.dt({success:L.Z_,postId:L.G0([L.pk,L.S1])}),dataToPost:{url:this.value.url,id:i},friendlyName:"Importing all post and pages"}),(0,_.g_)((()=>{e=!0}),(t=>{!a&&t.postId&&(a=t.postId),i===this.remoteHomepageId&&t.postId&&(this.importedHomepageIdOrFirstPostId=t.postId),s=!0})));this.importedHomepageIdOrFirstPostId||(this.importedHomepageIdOrFirstPostId=a),this.updateTemporaryState("postsAndPages",e,s),this.importingDataStatus.postsAndPages=this.temporaryDataStatus.postsAndPages}updateTemporaryState(t,e,s){e&&s?this.temporaryDataStatus[t]="partialError":e?this.temporaryDataStatus[t]="error":s&&(this.temporaryDataStatus[t]="success")}async trashAllTemplatesHeadersFooters(){const t=await Promise.all([this.trashTemplateByPostType("headers"),this.trashTemplateByPostType("footers"),this.trashTemplateByPostType("templates"),this.trashTemplateByPostType("global_blocks"),this.trashTemplateByPostType("popups")]);return this.importingDataStatus["trashingTemplates"]=this.temporaryDataStatus["trashingTemplates"],t}async trashTemplateByPostType(t){return(0,h.zG)(await(0,y.D)({action:"breakdance_design_lib_trash_all_templates_by_type",decoder:L.dt({success:L.Z_}),dataToPost:{templateType:t},friendlyName:`Trashing all ${t}`}),(0,_.g_)((()=>{this.updateTemporaryState("trashingTemplates",!0,"success"===this.temporaryDataStatus["trashingTemplates"])}),(()=>{this.updateTemporaryState("trashingTemplates","error"===this.temporaryDataStatus["trashingTemplates"],!0)})))}async importAllTemplates(){if(!this.value)return;const t=await this.getTemplateIdsToImport(this.value.url);t&&(0!==Object.values(t).flat().length?(this.importTemplates(t.templateIds),this.importHeaders(t.headerIds),this.importFooter(t.footerIds),this.importPopups(t.popupIds),this.importBlocks(t.blockIds)):this.applyStatusToAllTemplateStatuses("successNothingToDo"))}applyStatusToAllTemplateStatuses(t){this.importingDataStatus.templates=t,this.importingDataStatus.headers=t,this.importingDataStatus.footers=t,this.importingDataStatus.blocks=t,this.importingDataStatus.popups=t}async getTemplateIdsToImport(t){return(0,h.zG)(await(0,y.D)({action:"breakdance_design_lib_get_ids_of_templates_to_import",decoder:H,dataToPost:{url:t},friendlyName:"Getting template IDs to import"}),(0,_.g_)((()=>(this.applyStatusToAllTemplateStatuses("error"),null)),(t=>t)))}async importTemplates(t){if(t.length){for(const e of t)await this.importTemplateById(e,"templates");this.importingDataStatus.templates=this.temporaryDataStatus.templates,this.temporaryDataStatus.templates=null}else this.importingDataStatus.templates="successNothingToDo"}async importHeaders(t){if(t.length){for(const e of t)await this.importTemplateById(e,"headers");this.importingDataStatus.headers=this.temporaryDataStatus.headers,this.temporaryDataStatus.headers=null}else this.importingDataStatus.headers="successNothingToDo"}async importFooter(t){if(t.length){for(const e of t)await this.importTemplateById(e,"footers");this.importingDataStatus.footers=this.temporaryDataStatus.footers,this.temporaryDataStatus.footers=null}else this.importingDataStatus.footers="successNothingToDo"}async importPopups(t){if(t.length){for(const e of t)await this.importTemplateById(e,"popups");this.importingDataStatus.popups=this.temporaryDataStatus.popups,this.temporaryDataStatus.popups=null}else this.importingDataStatus.popups="successNothingToDo"}async importBlocks(t){if(t.length){for(const e of t)await this.importTemplateById(e,"blocks");this.importingDataStatus.blocks=this.temporaryDataStatus.blocks,this.temporaryDataStatus.blocks=null}else this.importingDataStatus.blocks="successNothingToDo"}async importTemplateById(t,e){this.value&&(0,h.zG)(await(0,y.D)({action:"breakdance_design_lib_import_template_by_id",decoder:L.dt({success:L.Z_}),dataToPost:{url:this.value.url,id:t},friendlyName:`Importing template with ID "${t}"`}),(0,_.g_)((()=>{this.updateTemporaryState(e,!0,"success"===this.temporaryDataStatus[e])}),(()=>{this.updateTemporaryState(e,"error"===this.temporaryDataStatus[e],!0)})))}async getRemoteHomepageId(){if(this.value)return(0,h.zG)(await(0,y.D)({action:"breakdance_design_lib_get_homepage_id_to_import",decoder:L.dt({id:L.pk}),dataToPost:{url:this.value.url},friendlyName:"Importing homepage id"}),(0,_.g_)((()=>{}),(t=>{this.remoteHomepageId=t.id})))}};(0,m.gn)([(0,g.fI)()],K.prototype,"value",void 0),K=(0,m.gn)([(0,g.wA)({components:{DesignLibraryStatusIcon:Z}})],K);const z=K,W=z;var E=(0,w.Z)(W,A,G,!1,null,null,null);const X=E.exports;var $=s(43274),M=s(2028),q=(s(69137),s(9950),s(565),s(31549));function V(t){(0,q.r)("breakdance_last_used_design_provider",t)}let Y=class extends a.ZP{constructor(){super(...arguments),this.isLoading=!0,this.loadedData={designProviders:[],globalSettingsLastImportedFromUrl:null,fullSiteLastImportedFromUrl:null},this.showOverrideWarning=!1,this.showImportingDialog=!1,this.providerToImport=!1}async mounted(){(0,h.zG)(await(0,y.D)({action:"breakdance_get_design_library_data",decoder:v.Jd}),(0,_.g_)((()=>{this.isLoading=!1}),(t=>{this.loadedData=t,this.isLoading=!1})))}get designProviders(){return this.loadedData.designProviders.filter((t=>!t.isLocal)).filter((t=>"complete_site"===t.type))}getTypeLabel(t){switch(t){case"sections":return"Sections";case"ui_kit":return"Website UI Kit";case"complete_site":return"Complete Website";default:return""}}setProviderToImport(t){this.showOverrideWarning=!0,(0,j.w)(),this.providerToImport=this.designProviders.find((e=>e.url===t))||!1}templateThumbnailUrl(t){return t&&t.thumbnailUrl}closeOverrideWarningDialog(){this.showOverrideWarning=!1,this.providerToImport=!1}closeImportingDialog(){this.showImportingDialog=!1,this.providerToImport=!1}async importFullSite(){this.showOverrideWarning=!1,this.showImportingDialog=!0,this.providerToImport&&(this.loadedData.fullSiteLastImportedFromUrl=this.providerToImport.url,V(this.providerToImport.url))}};Y=(0,m.gn)([(0,g.wA)({components:{AlertBox:M.Z,Notifications:$.Z,DesignLibraryImportingDialog:X,DesignLibraryStatusIcon:Z,Icon:f.Z,Dialog:I.Z,NiceButton:b.Z,Loading:c.Z}})],Y);const R=Y,J=R;var Q=(0,w.Z)(J,d,u,!1,null,null,null);const tt=Q.exports;a.ZP.directive("permission",o.Z),a.ZP.config.productionTip=!1,new a.ZP({store:i.ZP,vuetify:r.Z,render:t=>t(tt)}).$mount("#design-library-wrapper")},92260:(t,e,s)=>{s.d(e,{Jd:()=>o});var a=s(32521);const i=a.dt({thumbnailUrl:a.G0([a.Z_,a.S1])}),r=a.dt({name:a.Z_,url:a.Z_,type:a.G0([a.i0("complete_site"),a.i0("sections"),a.i0("ui_kit"),a.S1]),isLocal:a.G0([a.O7,a.S1]),meta:a.G0([a.S1,i])}),o=a.dt({designProviders:a.IX(r),globalSettingsLastImportedFromUrl:a.G0([a.Z_,a.lB]),fullSiteLastImportedFromUrl:a.G0([a.Z_,a.lB])}),l=a.dt({id:a.pk,name:a.Z_,url:a.Z_,tags:a.IX(a.Z_)});a.dt({enabled:a.O7,reliesOnGlobalSettings:a.G0([a.O7,a.S1]),name:a.Z_,requiresPassword:a.G0([a.O7,a.S1]),passwordValid:a.G0([a.O7,a.S1]),posts:a.IX(l)}),a.dt({url:a.Z_,id:a.pk})},75031:(t,e,s)=>{s.d(e,{az:()=>i});var a=s(32521);const i=a.Yj,r=a.dt({type:a.Z_,properties:i}),o=a.sH("TreeNode",(()=>a.jV([a.dt({id:a.pk,data:r,children:a.IX(o)}),a.r$({_parentId:a.pk})]))),l=a.dt({root:o,_nextNodeId:a.pk}),n=(a.jV([l,a.dt({status:a.i0("valid"),_lookupTable:a.IM(a.Z_,a.G0([a.S1,o]))})]),a.jV([l,a.dt({status:a.i0("exported")})]));a.G0([n,a.i0(!1)])}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={id:a,loaded:!1,exports:{}};return t[a].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=t,(()=>{var t=[];s.O=(e,a,i,r)=>{if(!a){var o=1/0;for(d=0;d<t.length;d++){for(var[a,i,r]=t[d],l=!0,n=0;n<a.length;n++)(!1&r||o>=r)&&Object.keys(s.O).every((t=>s.O[t](a[n])))?a.splice(n--,1):(l=!1,r<o&&(o=r));if(l){t.splice(d--,1);var p=i();void 0!==p&&(e=p)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[a,i,r]}})(),(()=>{s.n=t=>{var e=t&&t.__esModule?()=>t["default"]:()=>t;return s.d(e,{a:e}),e}})(),(()=>{s.d=(t,e)=>{for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{s.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}})(),(()=>{s.nmd=t=>(t.paths=[],t.children||(t.children=[]),t)})(),(()=>{s.j=35})(),(()=>{var t={35:0};s.O.j=e=>0===t[e];var e=(e,a)=>{var i,r,[o,l,n]=a,p=0;if(o.some((e=>0!==t[e]))){for(i in l)s.o(l,i)&&(s.m[i]=l[i]);if(n)var d=n(s)}for(e&&e(a);p<o.length;p++)r=o[p],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(d)},a=globalThis["webpackChunkbuilder"]=globalThis["webpackChunkbuilder"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))})();var a=s.O(void 0,[998,64],(()=>s(78533)));a=s.O(a)})();
//# sourceMappingURL=design-library.93b6fd4e.js.map