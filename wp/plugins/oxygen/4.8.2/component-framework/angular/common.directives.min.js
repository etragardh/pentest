var CTCommonDirectives=angular.module("CTCommonDirectives",[]);CTCommonDirectives.factory("ctScopeService",function(){var n={};return{store:function(e,t){n[e]=t},get:function(e){return n[e]}}}),CTCommonDirectives.factory("ctOxyCache",function(){var n={};return{store:function(e,t){n[e]=t},get:function(e){return n[e]}}});var newTreeControlState={acceptsDrop:["ct_columns","ct_new_columns","ct_column","ct_section","ct_ul","ct_link","ct_inner_content","ct_div_block","oxy_dynamic_list","ct_nestable_shortcode","oxy_icon_box_button_area","oxy_tabs","oxy_tabs_contents","oxy_tab","oxy_tab_content","oxy_toggle","oxy_header","ct_if_wrap","ct_else_wrap","oxy_header","oxy_header_left","oxy_header_center","oxy_header_right","ct_slider","ct_slide","ct_modal"],currentShowMore:null};CTCommonDirectives.directive("newTreeControl",function(){return{restrict:"A",scope:{newTreeControl:"="},link:function(o,r,e){-1<newTreeControlState.acceptsDrop.indexOf(o.newTreeControl.item.name)?setTimeout(function(){r.addClass("ct_accepts_drop")},200):o.$parent.iframeScope.waitComponentsTemplates(function(){o.$parent.iframeScope.isAPIComponent(o.newTreeControl.item.name)&&o.$parent.iframeScope.componentsTemplates[o.newTreeControl.item.name].nestable&&setTimeout(function(){r.addClass("ct_accepts_drop")},200)}),r.attr("data-component-name",o.newTreeControl.item.name),o.$parent.$on("treeCollapse",function(){o.newTreeControl.collapsed=!0}),o.$parent.$on("treeExpand",function(){o.newTreeControl.collapsed=!1}),o.$parent.$on("nodeExpand",function(e,t){r.get(0)===t&&(o.newTreeControl.collapsed=!1)}),o.$parent.$on("nodeShowMore",function(e,t){null===t&&(o.newTreeControl&&o.newTreeControl.editable&&(o.newTreeControl.editable=!1),o.newTreeControl&&o.newTreeControl.showCategorize&&(o.newTreeControl.showCategorize=!1));var n=parseInt(r.attr("ng-attr-tree-id"));n===parseInt(t)?(o.newTreeControl.showMoreOptions=!o.newTreeControl.showMoreOptions,o.newTreeControl.showMoreOptions&&(newTreeControlState.currentShowMore=t,setTimeout(function(){newTreeControlState.currentShowMore=null},500))):!0===o.newTreeControl.showMoreOptions&&n!==parseInt(newTreeControlState.currentShowMore)&&(o.newTreeControl.showMoreOptions=!1)})}}}),CTCommonDirectives.directive("ctiriscolorpicker",function(){return{restrict:"A",require:"ngModel",scope:{ctiriscallback:"=",gradientindex:"="},link:function(i,c,t,l){var n=!1;setTimeout(function(){c.alphaColorPicker({color:i.$parent.iframeScope.getGlobalColorValue(l.$modelValue),change:function(e){c.val().length!=e.color.toString().length&&0!==c.val().length||n||(n=setTimeout(function(){void 0!==i.$parent.globalColorToEdit.id?(i.$parent.updateGlobalColorValue(c.ctColorPicker("color")),i.$parent.globalColorChange()):l.$setViewValue(i.$parent.iframeScope.getGlobalColorValue(c.ctColorPicker("color"))),clearTimeout(n),n=!1},100)),i.ctiriscallback&&i.ctiriscallback()}});var e=t.ngModel;void 0!==i.gradientindex&&(e=e.replace("$index",i.gradientindex)),i.$parent.$watch(e,function(e){var t=i.$parent.iframeScope.getGlobalColorNiceName(e),n=c.closest(".oxygen-color-picker");if(jQuery(".oxy-global-color-label",n).remove(),t){var o;n.removeClass("oxy-not-global-color-value").children("input").prop("disabled",!0).after("<span class='oxy-global-color-label' title='"+t+"'>"+t+"<span class='oxy-global-color-label-remove'>Ã—</span></span>");var r=i.$parent.iframeScope.getGlobalColorValue(e).replace(/ /g,"");o=r.match(/rgba\(\d+\,\d+\,\d+\,([^\)]+)\)/)?(o=100*parseFloat(r.match(/rgba\(\d+\,\d+\,\d+\,([^\)]+)\)/)[1]).toFixed(2),parseInt(o)):100;var a=c.closest(".wp-picker-container").find(".alpha-slider");a.slider("value",o),a.find(".ui-slider-handle").text(o.toString())}else n.addClass("oxy-not-global-color-value").children("input").prop("disabled",!1),i.$parent.$parent.activeGlobalColor={};if(n.addClass("oxy-not-empty-color-value"),!(e&&""!==e||l.$modelValue))return n.removeClass("oxy-not-empty-color-value"),void c.closest(".wp-picker-container").find(".wp-color-result").css("background-color","");c.ctColorPicker("color",i.$parent.iframeScope.getGlobalColorValue(e))}),i.$apply()},0)}}}),CTCommonDirectives.directive("ctdynamiclist",["$compile","ctScopeService",function(e,t){return{restrict:"A",replace:!0,scope:{dynamicListOptions:"=",dynamicActions:"="},link:function(f,$,e){var a=parseInt($.attr("ng-attr-component-id")),i={};function g(n,o,e){f.$parent.$parent.dynamicListTrees.forcleanup[a]&&0<f.$parent.$parent.dynamicListTrees.forcleanup[a].length&&f.$parent.$parent.dynamicListTrees.forcleanup[a].forEach(function(e){delete f.$parent.$parent.cache.idStyles[e],f.$parent.$parent.recycleIDs.push(e)}),f.$parent.$parent.dynamicListTrees.forcleanup[a]=[],f.$parent.$parent.dynamicListTrees.trees[a]=[],n.forEach(function(e,t){var n=JSON.parse(JSON.stringify(o));n.repeaterListIndex=t,function t(n,e,o){void 0===n.source_id&&(n.source_id=n.id),void 0!==i[n.source_id]?n.id=i[n.source_id]:n.id=0<f.$parent.$parent.recycleIDs.length?f.$parent.$parent.recycleIDs.shift():f.$parent.$parent.component.id++,n.options.ct_id=n.id,f.$parent.$parent.component.options[n.id]={id:{},model:{},original:{}},void 0!==e&&(n.options.ct_parent=e);var r=o.find(function(e){return e.ct_id===n.source_id});r&&r.ct_content&&(n.options.ct_content=r.ct_content,n.options.ct_content=n.options.ct_content.replace(/\<span id\=\"ct-placeholder-([^\"]*)\"\>\<\/span\>/gi,function(e,t){var n=0<f.$parent.$parent.recycleIDs.length?f.$parent.$parent.recycleIDs.shift():f.$parent.$parent.component.id++;return'<span id="ct-placeholder-'+(i[t]=n)+'"></span>'})),r&&r.renderedHTML&&(n.options.renderedHTML=r.renderedHTML),r&&r.original&&(n.options.original=r.original),"oxy_dynamic_list"==n.name&&(f.$parent.dynamicListActions.actions[n.id]={}),f.$parent.$parent.dynamicListTrees.forcleanup[a].push(n.id),n.children&&0<n.children.length&&n.children.forEach(function(e){t(e,n.id,o)})}(n,null,e),f.$parent.$parent.dynamicListTrees.trees[a].push(n)}),$.attr("data-for-id",a);var t=$.children(".oxy_repeater_original");t.length<1&&(t=$.children().first()).addClass("oxy_repeater_original"),t.siblings().remove(),f.$parent.buildComponentsFromTree(f.$parent.$parent.dynamicListTrees.trees[a],null,!1,$),t.insertBefore($.children().first()),f.$parent.$parent.dynamicListTrees.trees[a].forEach(function(e,t){!function n(e,o,r){e.children&&e.children.forEach(function(t){if("oxy_dynamic_list"==t.name){var e=o[r].find(function(e){return e.ct_id===t.source_id});f.$parent.$parent.dynamicListAction(t.id,1,!0,t,e.children)}else n(t,o,r)})}(e,n,t)}),f.$parent.$parent.adjustResizeBox(),f.$parent.$parent.$emit("oxy-dynamic-list-"+a),o&&o.children&&function(e){e.forEach(function(e){f.$parent.componentsTemplates[e.name]&&f.$parent.componentsTemplates[e.name].has_js?f.$parent.rebuildDOM(e.id):e.children&&e.children});f.$parent.componentsTemplates[""]}(o.children),e&&$.append(angular.element('<div class="oxy-repeater-pages-wrap" style="opacity:1">').append(angular.element('<div class="oxy-repeater-pages">').append(e)))}$.on("click",function(e){var t=angular.element(e.target).closest(".oxy_repeater_original");t.closest("#"+$.attr("id")).length<1&&(t=!1),(!t||t.length<1)&&f.$parent.$parent.parentScope.scrollToComponent($.children().attr("id"),100)}),angular.extend(f.dynamicActions.actions[a],{action:function(e,t,n,o,r){e=parseInt(e),void 0!==n&&f.$parent.$parent.waitOxygenTree(function(){!function(e,t,n,o){var r=parseInt($.attr("ng-attr-component-id"));if(!f.$parent.$parent)return;if(f.$parent.$parent.component.options[r].model.listrendertype){var a=$.children().first();return a.addClass("oxy_repeater_original"),f.$parent.$parent.adjustResizeBox(),f.$parent.$parent.$emit("oxy-dynamic-list-"+r)}if(e!==r)return;var i=null;i=n||f.$parent.findComponentItem(f.$parent.componentsTree.children,r,f.$parent.getComponentItem);if(!i||!i.children||i.children.length<1)return;var c=i.children[0];if(n)g(o,c);else{for(var l=function o(e){var r=[];e.forEach(function(e){var t=angular.element.extend(!0,{},e.options);"oxy_dynamic_list"===e.name&&(t.children=o(e.children)),t.name=e.name;var n=f.$parent.$parent.componentsTemplates[t.name];n&&n.phpCallback&&(t.renderedHTML=!0,t.component=e),r.push(t),"oxy_dynamic_list"!==e.name&&e.children&&(r=r.concat(o(e.children)))});return r}(i.children),p=!1,s=$,d=[],u=0;s&&0<s.length;){var m=parseInt(s.attr("ng-attr-component-id"));f.$parent.$parent.component.options[m].original.use_acf_repeater?(s=s.parent().closest(".oxy-dynamic-list"),0<u&&d.push(f.$parent.$parent.component.options[m].original.acf_repeater)):f.$parent.$parent.component.options[m].original.use_metabox_clonable_group?(s=s.parent().closest(".oxy-dynamic-list"),0<u&&d.push(f.$parent.$parent.component.options[m].original.metabox_group)):(p=parseInt(s.attr("ng-attr-component-id")),s=!1),u++}f.$parent.getDynamicDataFromQuery(r,l,g,c,p,d)}}(e,0,o,r)})}}),f.$parent.$parent.dynamicListTrees.runMainOnLoad.push(a)}}}]),CTCommonDirectives.directive("dyncontenteditable",["$compile","$timeout","$interval","ctScopeService",function(e,t,n,o){return{restrict:"A",link:function(i,c,e){c.bind("dblclick",function(e){e.stopPropagation();var t=c.attr("ng-attr-component-id"),n=i.findComponentItem(i.componentsTree.children,t,i.getComponentItem);if(n){var o;if("ct_span"==n.name)angular.element("[ng-attr-component-id="+t+"]").attr("disabled","disabled"),c.removeAttr("disabled"),i.buildComponentsFromTree([n],null,!1,c),o=c.children(),c.replaceWith(o);else{angular.element("[ng-attr-component-id="+t+"]").attr("disabled","disabled"),c.removeAttr("disabled");var r=c.parent(),a=(c.index(),angular.element("<div>").css("display","none"));r.append(a),i.buildComponentsFromTree([n],null,!1,a),(o=a.children()).insertBefore(c),c.css("display","none"),c.attr("disabled","disabled"),a.remove()}setTimeout(function(){o.trigger("dblclick")},100)}})}}}]),CTCommonDirectives.directive("ctrendernestableshortcode",["$http",function(e){return{restrict:"A",link:function(o,e,t){var r=parseInt(e.attr("ng-attr-component-id")),a=function(e,t){o.$parent.component.options[r].model.wrapping_end=void 0!==t?(t=t.split("_#wrapped_content_replacer#_"),o.$parent.component.options[r].model.wrapping_start=t[0],t[1]):o.$parent.component.options[r].model.wrapping_start="",o.$parent.setOption(r,"ct_nestable_shortcode","wrapping_start"),o.$parent.setOption(r,"ct_nestable_shortcode","wrapping_end"),o.$parent.rebuildDOM(r)},n=!1;o.$watch(e.attr("ct-nestable-shortcode-model"),function(e,t){!1===n&&t!==e&&(n=setTimeout(function(){setTimeout(function(){if(o.$parent){var e=o.$parent.component.options[r].id.wrapping_shortcode;if(e){var n=[];e.replace(/\[([^\s\]]{1,})[^\]]*\]/gi,function(e,t){return n.push(e),n.push(t),""});var t={original:{full_shortcode:n[0]+"_#wrapped_content_replacer#_[/"+n[1]+"]"}};o.renderShortcode(r,"ct_shortcode",a,t)}}},0),n=!1},500))})}}}]),CTCommonDirectives.directive("ctevalconditions",function(){return{restrict:"A",link:function(t,n,e){setTimeout(function(){var e=parseInt(n.attr("ng-attr-component-id"));t.parentScope.evalGlobalConditions(e)},0)}}}),CTCommonDirectives.directive("ctrenderoxyshortcode",["$http","ctOxyCache",function(e,t){return{restrict:"A",require:"ngModel",link:function(i,c,e,t){var o=function(e,t,n){c.html(t);var o=parseInt(c.attr("ng-attr-component-id")),r=i.getComponentById(o);if(0<e.indexOf("metabox_field_type='map'")&&void 0!==n){var a=r.closest("body");a.find('link[data-forId="'+o+'"], script[data-forId="'+o+'"]').remove(),function e(t){try{if(1<t.length){var n=t[0];a.append(angular.element(n).attr("data-forId",o)).ready(function(){setTimeout(function(){e(t.slice(1))},300)})}else a.append(angular.element(t[0]).attr("data-forId",o))}catch(e){console.log("JS error happened:",e)}}(n)}};setTimeout(function(){var e=parseInt(c.attr("ng-attr-component-id")),t=i.$parent.getOption("ct_content",e),n={original:{full_shortcode:t}};0<t.indexOf("metabox_field_type='map'")&&(i.$parent.getOption("width",e)||(i.$parent.setOptionModel("width","100",e),i.$parent.setOptionModel("width-unit","%",e)));0<t.indexOf("data='content'")&&(i.$parent.currentClass="oxy-stock-content-styles",i.addClassToComponent(e,"oxy-stock-content-styles",!1),i.$parent.currentClass=!1),i.renderShortcode(e,"ct_shortcode",o,n)},0)}}}]),CTCommonDirectives.directive("contenteditable",["$timeout","$interval","ctScopeService",function(l,e,p){return{restrict:"A",require:"ngModel",link:function(r,a,i,o){function c(){o.$setViewValue(a.html())}a.unbind("paste input"),o.$render=function(){if(void 0!==i.disabledynamic&&"true"===i.disabledynamic){a.removeClass("oxygen-disabled");var n=o.$viewValue;o.$viewValue.replace(/\<span id\=\"ct-placeholder-([^\"]*)\"\>\<\/span\>/gi,function(e,t){n=$scope.iframeScope.component.options[parseInt(t)].model.ct_content}),n.match(/\[oxygen[^\]]*\]/gi)&&a.addClass("oxygen-disabled")}a.html(o.$viewValue||"")},a.bind("input",function(e,t){r.$apply(c),t&&void 0!==i.plaintext&&"true"===i.plaintext&&(jQuery("<span>").html(a.html()).text().trim()!==a.html().trim().replace("&nbsp;","")&&a.html(a.text()),o.$setViewValue(a.text())),""===a.html().trim()&&void 0!==i.defaulttext&&""!==i.defaulttext.trim()&&a.text(i.defaulttext);var n=l(function(){var e=r,t=i.optionname||"ct_content";r.iframeScope&&(e=r.iframeScope),e.setOption(e.component.active.id,e.component.active.name,t),l.cancel(n)},20,!1)}),a.bind("paste",function(){setTimeout(function(){a.trigger("input","paste")},0)}),void 0===i.plaintext||"true"!==i.plaintext?(a.bind("click",function(e){e.preventDefault()}),a.bind("dblclick",function(e){e.stopPropagation();var t=p.get("scope").parentScope,n=i.optionname||"ct_content",o=r.getOption(n);r.contentEditableData.original=o,r.dynamicSpanCycleIDs=[],o=o.replace(/\<span id\=\"ct-placeholder-([^\"]*)\"\>\<\/span\>/gi,function(e,t){var n=r.component.options[parseInt(t)].model.ct_content;return n.match(/\[oxygen[^\]]*\]/gi)?(r.$parent.dynamicSpanCycleIDs.push(parseInt(t)),r.removeComponentById(parseInt(t),"span",r.component.active.id),n):e}),r.setOptionModel(n,o,r.component.active.id,r.component.active.name),r.contentEditableData.beingEdited=o,t.enableContentEdit(a),r.$apply()}),a[0].attributes["ng-attr-paragraph"]?a.bind("keypress",function(e){13==e.keyCode&&document.execCommand("formatBlock",!1,"p")}):a.bind("keypress",function(e){if(13==e.keyCode)return document.execCommand("insertHTML",!1,"<br><br>"),!1})):a.bind("keypress",function(e){if(13==e.keyCode)return a.blur(),!1}),void 0===i.ngBlur&&""===i.ngBlur||a.bind("blur",function(){var e=l(function(){r.$apply(i.ngBlur),l.cancel(e)},0,!1)})}}}]),CTCommonDirectives.directive("focusMe",["$timeout",function(o){return{scope:{trigger:"=focusMe"},link:function(t,n){t.$watch("trigger",function(e){!0===e&&o(function(){n[0].focus(),t.trigger=!1})})}}}]),CTCommonDirectives.directive("oxyRangeFix",function(){return{priority:0,require:"ngModel",link:{pre:function(e,t,n,o){o.$validators=[],o.$formatters=[],o.$parsers=[],o.$render=function(){}}}}});