<?php
/**
 * A PHP file for testing our Queueable in a sandbox environment.
 */


require_once(__DIR__ . '/wp_load.php');

(php_sapi_name() == 'cli') || die("Must be run from the command line\n");
parse_str(implode('&', array_slice($argv, 1)), $args);

($phone = nc_g($args, 'phone')) || die("Specify `phone` to queue a test sms to a phone #\n");
($area = nc_g($args, 'area')) || die("Specify `area` to specify area code\n");
($message = nc_g($args, 'message'));

// remove first 0 and append + area code
$full_phone = "+{$area}" . substr($phone, 1);

$NCN = new North_Commerce_Notification;

$_POST['phone'] = $full_phone;
$_POST['relation'] = 'customer';
$_POST['body'] = $message ?? "Test message";

$NCN->process_test_sms();

var_dump($NCN->last_action);

if ( $NCN->last_action === 'north-commerce/schedule/sms' ) {
    echo "SMS queued using Action Scheduler";
    $details = $NCN->get_last_action_details();
    var_dump($details);
} else {
    echo "SMS sent directly via system";
}
