<?php
/*
 * A PHP file for testing our Queueable in a sandbox environment.
 */


require_once(__DIR__ . '/wp_load.php');

(php_sapi_name() == 'cli') || die("Must be run from the command line\n");
parse_str(implode('&', array_slice($argv, 1)), $args);

($email = nc_g($args, 'email')) || die("Specify `email` to queue a test email to an address\n");

$NCN = new North_Commerce_Notification;

$_POST['email'] = $email;
$_POST['subject'] = "This is a test";
$_POST['body'] = "This is the body of the test";

$result = $NCN->process_test_email();

var_dump($NCN->last_action);

if ( $NCN->last_action === 'north-commerce/schedule/email' ) {
    echo "Email queued using Action Scheduler";
    $details = $NCN->get_last_action_details();
    var_dump($details);
} else {
    echo "Email sent directly via system";
}
