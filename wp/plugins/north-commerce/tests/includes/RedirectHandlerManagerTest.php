<?php
/*
 * A PHP file for testing out RedirectHandlerManager
 */

use NorthCommerce\RedirectHandlerManager as NorthCommerceRedirectHandlerManager;

require_once(__DIR__ . '/../north-commerce-test-case.php');

class RedirectHandlerManagerTest extends North_Commerce_Test_case
{
	public function testSetup()
	{
		$rhm = NorthCommerceRedirectHandlerManager::instance();
		$rhm->setup();

		$_GET = [
			NC_REDIRECT_HANDLER_ACTION_NAME => 'settings_page',
			'target' => 'checkout'
		];

		$found_location = false;
		$on_redir = function($location) use(&$found_location) {
			$found_location = $location;
		};

		nc_with_action('wp_redirect', $on_redir, function() {
			do_action('template_redirect');
		});

		$this->assertEquals(North_Commerce_Settings::nc_get_page_url('checkout'),
							$found_location);

	}
}
