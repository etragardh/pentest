<?php
/*
 * A PHP file for testing out our API parser
 */
require_once(__DIR__ . '/../../north-commerce-test-case.php');

class North_Commerce_Api_Parser_Test extends North_Commerce_Db_Test_Case
{

	public function testParseSort() {
		$req = new WP_REST_Request();
		$req->set_url_params([
			'entity' => 'line-items'
		]);

		$parser = new North_Commerce_Api_Parser();

		$tests = [
			'id:desc,amount:asc' => 'id desc, amount asc',
			'id:up,amout:down' => false,
			'ID:desc,Amount:ASC' => false,
			'quantity:asc' => 'quantity asc'
		];

		foreach($tests as $input => $expected) {
			$this->assertEquals($expected, $parser->parseSort($input, $req));
		}
	}

	public function testParseFilter() {
		$req = new WP_REST_Request();
		$req->set_url_params([
			'entity' => 'line-items'
		]);

		$parser = new North_Commerce_Api_Parser();

		$tests = [
			'id:eq:484' => ['id' => ['=', 484]],
			'id:gt:201,amount:lt:938' => [
				'id' => ['>', '201'],
				'amount' => ['<', '938']
			],
			'foo:bar:baz,zap' => false,
		];

		foreach($tests as $input => $expected) {
			$this->assertEquals($expected, $parser->parseFilter($input, $req));
		}
	}
}
