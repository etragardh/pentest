<?php
/*
 * A PHP file for testing out our CustomerStoreAutomation
 */

require_once(__DIR__ . '/AutomationTestCase.php');

class CustomerStoreAutomationTest extends AutomationTestCase
{

	public function testOnEntityAccessStoreChanges()
	{
		$this->agent->perspectiveManager()->asPublic(function() {
			$email = "changes-test." . nc_random_token() . '@' . NORTH_COMMERCE_TEST_DOMAIN;

			$c1 = $this->ea->store('customers', [
				'email' => $email,
				'marketing_optin' => true,
			]);

			$c2 = $this->ea->store('customers', [
				'email' => $email,
				'marketing_optin' => false
			]);

			$this->assertEquals(1, $c1['marketing_optin']);
			$this->assertEquals(0, $c2['marketing_optin']);
			$this->assertEquals($c1['id'], $c2['id']);
		});
	}

}
