<?php
/*
 * A PHP file for testing filling out a line item
 */

use NorthCommerce\Db\Effects\FillInLineItemEffect;

require_once(__DIR__ . '/../North_Commerce_Db_Test_Case.php');

class FillInLineItemEffectTest  extends North_Commerce_Db_Test_Case
{

	public function testBehavior()
	{
		$qty = rand(1, 10);
		$pv = $this->ef->randomProductVariant();
		$p = $this->ea->get('products', ['id' => $pv['product_id']]);
		$amount = ($pv['price'] == null ? $p['base_price'] : $pv['price']) * $qty;

		$before = [
			'quantity' => $qty,
			'product_variant_id' => $pv['id']
		];

		$after = FillInLineItemEffect::run($before);
		$this->assertEquals($qty, $after['quantity']);
		$this->assertEquals($amount, $after['amount']);
		$this->assertStringContainsString($p['name'], $after['description']);
		$this->assertStringContainsString($pv['sku'], $after['description']);
	}
}
