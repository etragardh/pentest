<?php
/*
 * A PHP file for testing out our column access rules
 */

use NorthCommerce\Db\Security\ColumnRules;

require_once(__DIR__ . '/../../../north-commerce-test-case.php');

class ColumnRulesTest extends North_Commerce_Db_Test_Case
{

	public function testAllowed() {
		$tests = [
			['required' => ['email'],
			 'optional' => ['marketing_optin'],
			 'check' => 'email',
			 'expected' => true],

			['required' => [],
			 'optional' => ['email', 'marketing_optin'],
			 'check' => 'email',
			 'expected' => true],

			['required' => ['email', 'marketing_optin'],
			 'optional' => [],
			 'check' => 'email',
			 'expected' => true],

			['required' => [],
			 'optional' => [],
			 'check' => 'email',
			 'expected' => false],
		];

		foreach($tests as $t) {
			$cr = new ColumnRules($t['required'], $t['optional']);
			$found = in_array($t['check'], $cr->allowed());
			$this->assertEquals($t['expected'], $found, print_r($t, true));
		}
	}

}
