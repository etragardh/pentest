<?php
/*
 * A PHP file for testing out our administrator perspective
 */

use NorthCommerce\Db\Schema;
use NorthCommerce\Db\Security\AdministratorPerspective;
use NorthCommerce\Testing\EntityFactory;

require_once(__DIR__ . '/../../../north-commerce-test-case.php');


class AdministratorPerspectiveTest extends North_Commerce_Db_Test_Case
{

	function testSlug()
	{
		$p = new AdministratorPerspective();
		$this->assertEquals('administrator', $p->slug());
	}

	function testAppliesTo() {
		$ef = EntityFactory::instance();
		$customer = $ef->newWpUser();
		$admin = $ef->newWpUser(['role' => 'administrator']);

		$p = new AdministratorPerspective();
		$this->assertTrue($p->appliesTo($admin));
		$this->assertFalse($p->appliesTo($customer));
		$this->assertFalse($p->appliesTo(null));
	}

	public function testCustomizeSchema() {
		$schema = new Schema();
		$p = new AdministratorPerspective();
		$all = $schema->getTables();
		$customized = $p->customizeSchema($all);
		$this->assertEquals(count($all), count($customized));
	}
}
