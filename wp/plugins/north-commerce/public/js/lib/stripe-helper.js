/**
 * A JS file for implementing code to help our stripe implementation
 */
;(function () {
    window.NorthCommerce = window.NorthCommerce ?? {}

    window.NorthCommerce.StripeHelper = {
        paymentElement: null,
        stripeApi: null,
        elements: null,
        clientSecret: null,

        isEnabled: function() {
            return document.querySelector('#nc_payment_service_stripe').value === 'enabled'
        },

        install: function() {
            if(!this.isEnabled()) {
                return false;
            }

            document.querySelector('.payment-service-name-stripe').innerText = 'Loading...'
            if (this.stripeApi == null) {
                this.stripeApi = Stripe(northCommerceSettings.stripePublic)
            }

            this.elements = this.stripeApi.elements({ clientSecret: this.clientSecret })
            this.paymentElement = this.elements.create('payment')

            // Listen for the 'ready' event
            this.paymentElement.on('ready', () => {
                document.querySelector('.payment-service-name-stripe').innerText = 'Card'
            })

            this.paymentElement.mount('#stripe-element')

            const btnContainer = document.querySelector('.nc-place-order-container')
            btnContainer.innerHTML = '<button type="submit" class="nc-place-order-btn">Place your order</button>'
        },
    }
})()
