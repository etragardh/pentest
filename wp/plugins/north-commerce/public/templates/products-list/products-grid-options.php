<?php

$product_options_section = '';

foreach ( $product['product_options'] as $index => $option ) {

    $option_type_slug = $option['product_option_type']['slug'];

    if ( 'color' === $option_type_slug ) {
        echo '<div class="option-color" data-type="product-options">';
            echo '<p class="variation-label">',
                esc_html( $option['name'] ),
            '</p>';

            echo '<ul class="color-swatch-list">';

                foreach ( $option['product_option_values'] ?? [] as $value ) {
                    $value_attr_id = 'product_' . $product['id'] . '__option_value_' . $value['id'];

                    echo '<li class="swatch-item">',
                        '<input',
                            ' type="radio"',
                            ' id="' . esc_attr( $value_attr_id ) . '"',
                            ' class="variation-selector"',
                            ' value="' . esc_attr( $value['id'] ) . '"',
                            ' name="' . esc_attr( $option_type_slug . '-' . $index ) . '"',
                            '>',
                        '<label',
                            ' for="' . esc_attr( $value_attr_id ) . '"',
                            ' class="swatch-label"',
                            ' data-type="option-label"',
                            ' title="' . esc_attr( $value['display_value'] ) . '"',
                            ' style="background-color: ' . $value['value'] . '"',
                            '></label>',
                    '</li>';
                }

            echo '</ul>';
        echo '</div>';
    }

    if (
        'size' === $option_type_slug
        || 'text' === $option_type_slug
    ) {
        $this->use( 'product/option-size', compact(
            'option',
            'index',
            'option_type_slug',
            'product',
        ) );
    }

    if ( 'image' === $option_type_slug ) {
        echo '<div class="nc-image-selector" data-type="product-options">';

            echo '<p class="variation-label">',
                esc_html( $option['name'] ),
            '</p>';

            foreach ( $option['product_option_values'] ?? [] as $value ) {
                $value_attr_id = 'product_' . $product['id'] . '__option_value_' . $value['id'];

                echo '<input',
                    ' type="radio"',
                    ' id="' . esc_attr( $value_attr_id ) . '"',
                    ' class="image-radio"',
                    ' value="' . esc_attr( $value['id'] ) . '"',
                    ' name="' . esc_attr( $option_type_slug . '-' . $index ) . '"',
                    '>';

                echo '<label',
                    ' for="' . esc_attr( $value_attr_id ) . '"',
                    ' class="image-option image-label"',
                    $value['value'] ? ' style="background-image: url(' . $value['value'] . ')"' : '',
                    '>',
                '</label>';
            }

        echo '</div>';
    }
}
