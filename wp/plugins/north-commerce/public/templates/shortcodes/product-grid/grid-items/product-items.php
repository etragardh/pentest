<?php

$image_placeholder = NORTH_COMMERCE_PLUGIN_DIR_URL . 'admin/images/product-empty-img.png';
$permalink_base = North_Commerce_Product::get_permalink_base();

$classes = ! empty( $desktop_columns ) ? 'nc-product-grid-' . $desktop_columns : '';
$classes .= ! empty( $mobile_columns ) ? ' nc-mob-product-grid-' . $mobile_columns : '';

?>
<div
    class="<?php echo esc_attr( $classes ); ?>"
    data-nc-rendered-product-collection
>
    <?php
    foreach ( $products as $product ) {
        $image_url = $product['product_images'][0]['image_url'] ?? $image_placeholder;
        ?>
        <div
            class="nc-productOne"
            data-type="nc-product"
            data-id="<?php echo esc_attr( $product['id'] ); ?>"
            data-product-collection-item
        >
            <?php
            if ( isset( $badge ) ) {
                ?>
                <span id="bestSeller"><?php echo $badge ?></span>
                <?php
            }
            ?>
            <div class="nc-img">
                <a href="<?php echo esc_url( $permalink_base . $product['slug'] ); ?>">
                    <img
                        src="<?php echo esc_url( $image_url ); ?>"
                        alt="<?php esc_attr_e( 'Product Name', 'north-commerce' ); ?>"
                    >
                    <?php
                    if (
                        ! empty( $product['product_images'] )
                        && count( $product['product_images'] ) > 1
                    ) {
                        ?>
                        <img
                            id="hover"
                            src="<?php echo esc_url( $product['product_images'][1]['image_url'] ); ?>"
                            alt="<?php esc_attr_e( 'Product Name', 'north-commerce' ); ?>"
                        >
                        <?php
                    }
                    ?>
                </a>
                <?php
                if ( $product['product_options'] ) {
                    ?>
                    <a
                        class="nc-img-view-product"
                        href="<?php echo esc_url( $permalink_base . $product['slug'] ); ?>"
                    >
                        <?php esc_html_e( 'View Options', 'north-commerce' ); ?>
                    </a>
                    <?php
                } else {
                    ?>
                    <button class="nc-img-view-product" data-add-to-cart-action>
                        <?php esc_html_e( 'Add to cart', 'north-commerce' ); ?>
                    </button>
                    <?php
                }
                ?>
            </div>
            <a
                class="nc-productOne-link"
                href="<?php echo esc_url( $permalink_base . $product['slug'] ); ?>"
            >
                <?php echo esc_html( $product['name'] ); ?>
            </a>
            <p class="description__price">
                <?php echo North_Commerce_Settings::formatted_price( $product['base_price'] ); ?>
            </p>
        </div>
        <?php
    }
    ?>
</div>