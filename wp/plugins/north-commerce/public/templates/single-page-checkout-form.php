<?php

use NorthCommerce\Db\Collections\{
    ProductOptionTypes,
    ProductTypes
};
use NorthCommerce\Models\ProductModel;
use North_Commerce_Settings as Settings;

$product_model = new ProductModel();

?>
<form
    class="nc-single-page-checkout"
    data-type="form"
    data-nc-selector="single-page-checkout"
    data-redirect="<?php echo $args['redirect']; ?>"
    data-currency="<?php echo Settings::get_currency_code(); ?>"
>
    <?php

    if ( ! empty( $args['products'] ) && '' !== $args['products'][0] ) {
        foreach ( $args['products'] as $product_id ) {
            $product = $product_model->get_by_id( $product_id );

            if ( ! $product ) {
                continue;
            }

            $product_type_slug = $product['product_type']['slug'];

            if ( ProductTypes::oneTime()->slug === $product_type_slug ) {
                $price = $product['base_price'];
            }
            if ( ProductTypes::subscription()->slug === $product_type_slug ) {
                $has_free_trial = (bool) ( $product['payment_detail']['has_free_trial'] ?? null );
                $has_first_period_payment = (bool) ( $product['payment_detail']['has_first_period_payment'] ?? null );
                if ( $has_free_trial ) {
                    $price = 0;
                } elseif ( $has_first_period_payment ) {
                    $price = $product['payment_detail']['first_period_payment'];
                } else {
                    $price = $product['base_price'];
                }
            }
            if ( ProductTypes::paymentPlan()->slug === $product_type_slug ) {
                $has_first_payment = (bool) $product['payment_detail']['has_first_payment'];
                if ( $has_first_payment ) {
                    $price = $product['payment_detail']['first_payment'];
                } else {
                    $price = floatval( $product['base_price'] );
                    $price -= floatval( $product['payment_detail']['first_payment'] );
                }
            }

            ?>
            <div class="SectionWrapper" data-type="section">
                <div
                    id="<?php echo esc_attr( $product['id'] ); ?>"
                    data-type="product"
                    data-product-id="<?php echo esc_attr( $product['id'] );?>"
                    data-product-type="<?php echo esc_attr( $product_type_slug ); ?>"
                    data-qty-max="<?php echo esc_attr( $product['quantity'] ); ?>"
                    data-price="<?php echo esc_attr( $price ); ?>"
                    class="productWrapper"
                >
                    <div data-type="product-title" class="productTitle">
                        <?php $product_id_attr = 'product_' . $product_id; ?>
                        <div>
                            <input
                                id="<?php echo esc_attr( $product_id_attr ); ?>"
                                type="radio"
                                data-product-name="<?php echo esc_attr( $product['name'] ); ?>"
                                class="ProductRadio ProductRadioCheckedAfter"
                            >
                            <label
                                for="<?php echo esc_attr( $product_id_attr ); ?>"
                                class="ProductRadioLabelBefore"
                            >
                            </label>
                        </div>

                        <label for="<?php echo esc_attr( $product_id_attr ); ?>" class="productRadioLabel">
                            <?php echo esc_html( $product['name'] ); ?>
                        </label>
                    </div>
                    <?php

                    if ( ProductTypes::oneTime()->slug === $product_type_slug ) {
                        ?>
                        <div class="ProductProps" data-type="product-properties">
                            <div data-type="nc-product-optionsvariations" class="product__options nc-container">
                                <?php
                                $product_options = $product['has_product_variants'] ? $product['product_options'] : [];
                                foreach ( $product_options as $opt_key => $option ) {
                                    $option_type_slug = $option['product_option_type']['slug'];

                                    if ( ProductOptionTypes::color()->slug === $option_type_slug ) {
                                        ?>
                                        <div
                                            class="option__set option-color"
                                            data-type="product-options"
                                            data-id="<?php echo esc_attr( $option['id'] ); ?>"
                                        >
                                            <p class="variation-label">
                                                <?php echo esc_html( $option['name'] ); ?>
                                            </p>
                                            <ul class="color-swatch-list">
                                                <?php

                                                foreach ( $option['product_option_values'] ?? [] as $value ) {
                                                    $value_attr_id = 'product_' . $product_id . '__option_value_' . esc_attr( $value['id'] );

                                                    echo '<li class="swatch-item">',
                                                        '<input',
                                                            ' type="radio"',
                                                            ' id="' . esc_attr( $value_attr_id ) . '"',
                                                            ' class="variation-selector"',
                                                            ' value="' . esc_attr( $value['id'] ) . '"',
                                                            ' name="' . esc_attr( $option_type_slug . '-' . $opt_key ) . '"',
                                                        '>',
                                                        '<label',
                                                            ' for="' . esc_attr( $value_attr_id ) . '"',
                                                            ' class="swatch-label"',
                                                            ' title="' . esc_attr( $value['display_value'] ) . '"',
                                                            ' style="background-color: ' . $value['value'] . '"',
                                                        '></label>',
                                                    '</li>';
                                                }

                                                ?>
                                            </ul>
                                        </div>
                                        <?php
                                    }

                                    if (
                                        ProductOptionTypes::size()->slug === $option_type_slug
                                        || ProductOptionTypes::text()->slug === $option_type_slug
                                    ) {
                                        ?>
                                        <div
                                            class="option__set<?php echo esc_attr( ' nc-' . $option_type_slug ); ?>"
                                            data-type="product-options"
                                            data-id="<?php echo esc_attr( $option['id'] ); ?>"
                                        >
                                            <p class="size-variation-label variation-label">
                                                <?php echo esc_html( $option['name'] ); ?>
                                            </p>
                                            <?php

                                            foreach ( $option['product_option_values'] ?? [] as $value ) {
                                                $value_attr_id = 'product_' . $product_id . '__option_value_' . $value['id'];

                                                ?>
                                                <input
                                                    type="radio"
                                                    id="<?php echo esc_attr( $value_attr_id ); ?>"
                                                    class="size-radio"
                                                    value="<?php echo esc_attr( $value['id'] ); ?>"
                                                    name="<?php echo esc_attr( $option_type_slug . '-' . $opt_key ); ?>"
                                                >
                                                <label
                                                    for="<?php echo esc_attr( $value_attr_id ); ?>"
                                                    class="size-label"
                                                >
                                                    <?php echo esc_html( wp_unslash( $value['display_value'] ) ); ?>
                                                </label>
                                                <?php
                                            }

                                            ?>
                                        </div>
                                        <?php
                                    }

                                    if ( ProductOptionTypes::image()->slug === $option_type_slug ) {
                                        echo '<div class="option__set nc-image-selector" data-type="product-options" data-id="' . $option['id'] . '">';

                                            echo '<p class="variation-label">',
                                                esc_html( $option['name'] ),
                                            '</p>';

                                            foreach ( $option['product_option_values'] ?? [] as $value ) {
                                                $value_attr_id = 'product_' . $product_id . '__option_value_' . esc_attr( $value['id'] );

                                                echo '<input',
                                                    ' type="radio"',
                                                    ' id="' . esc_attr( $value_attr_id ) . '"',
                                                    ' class="image-radio"',
                                                    ' value="' . esc_attr( $value['id'] ) . '"',
                                                    ' name="' . esc_attr( $option_type_slug . '-' . $opt_key ) . '"',
                                                '>';

                                                echo '<label',
                                                    ' for="' . esc_attr( $value_attr_id ) . '"',
                                                    $value['value'] ? ' style="background-image: url(' . $value['value'] . ')"' : '',
                                                    ' class="image-option"',
                                                '></label>';
                                            }

                                        echo '</div>';
                                    }
                                }

                                ?>
                                <div data-type="product-qnt" class="productQnt">
                                    <button type="button" class="ProductQntBtn" data-qnt-type="minus">
                                        <svg width="16" height="16" viewBox="0 0 16 16"><path d="M2 7H14V9H2V7Z"></path></svg>
                                    </button>
                                    <input
                                        class="ProductQntInt"
                                        type="number"
                                        value="<?php echo null === $product['quantity'] || intval( $product['quantity'] ) > 0 ? '1' : '0'; ?>"
                                        data-type="qty-input"
                                    >
                                    <button type="button" class="ProductQntBtn" data-qnt-type="plus">
                                        <svg width="12" height="12" viewBox="0 0 12 12"><path d="M12 5H7V0H5V5H0L0 7H5V12H7V7H12V5Z"></path></svg>
                                    </button>
                                </div>

                            </div>

                            <div class="textFieldError" data-type="error">
                                <span class="ErrorIcon textFieldErrorIcon" data-type="error-icon">
                                    <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                                </span>
                            </div>

                        </div>
                        <?php
                    }

                    ?>
                    <hr class="ProductDivider">
                    <?php

                    if ( ProductTypes::subscription()->slug !== $product_type_slug ) {
                        ?>
                        <div data-type="product-stock" class="ProductStock">
                            <span data-type="stock-label" class="ProductStockInventory">Inventory:</span>
                            <span data-type="stock-value" class="ProductStockInventory">
                                <?php echo esc_html( null === $product['quantity'] ? '∞' : $product['quantity'] ) . ' in stock'; ?>
                            </span>
                        </div>
                        <?php
                    }

                    if ( ProductTypes::subscription()->slug === $product_type_slug ) {

                        if ( $has_free_trial || $has_first_period_payment ) {
                            if ( $has_free_trial ) {
                                echo '<div class="ProductInfo" data-type="product-trial">',
                                    '<span data-type="total-label" class="productPrice">',
                                        esc_html__( 'Trial', 'north-commerce' ),
                                    '</span>',
                                    '<span data-type="total-trial" class="productPrice">',
                                        esc_html( 'Free (' . $product['payment_detail']['free_trial_frequency'] . ' ' . $product['payment_detail']['free_trial_type']['name'] . ')' ),
                                    '</span>',
                                '</div>';
                            }

                            if ( $has_first_period_payment ) {
                                echo '<div class="ProductInfo" data-type="product-first-period">',
                                    '<span data-type="total-label" class="productPrice">',
                                        esc_html__( 'First Period', 'north-commerce' ),
                                    '</span>',
                                    '<span data-type="total-period" class="productPrice">',
                                        Settings::formatted_price( $product['payment_detail']['first_period_payment'] ),
                                    '</span>',
                                '</div>';
                            }

                            ?>
                            <div class="ProductTotal" data-type="product-total">
                                <span data-type="total-label" class="productPrice">
                                    <?php esc_html_e( 'Then', 'north-commerce' ); ?>
                                </span>
                                <span data-type="total-value" class="productPrice">
                                    <?php
                                    echo Settings::formatted_price( $product['base_price'] );
                                    echo esc_html( ' / ' . $product['payment_detail']['payment_frequency']['name'] );
                                    ?>
                                </span>
                            </div>
                            <?php

                        } else {
                            ?>
                            <div class="ProductTotal" data-type="product-total">
                                <span data-type="total-label" class="productPrice">
                                    <?php esc_html_e( 'Price', 'north-commerce' ); ?>
                                </span>
                                <?php
                                echo '<span data-type="total-value" class="productPrice">',
                                    Settings::formatted_price( $product['base_price'] ),
                                    '/',
                                    esc_html( $product['payment_detail']['payment_frequency']['name'] ),
                                '</span>';
                                ?>
                            </div>
                            <?php
                        }

                    }

                    if ( ProductTypes::paymentPlan()->slug === $product_type_slug ) {
                        ?>
                        <div class="ProductTotal" data-type="product-total">
                            <span data-type="total-label" class="productPrice"><?php esc_html_e( 'Price:', 'north-commerce' ); ?></span>
                            <span data-type="total-value" class="productPrice">
                                <?php echo Settings::formatted_price( $product['base_price'] ); ?>
                            </span>
                        </div>
                        <hr class="ProductDivider" />
                        <?php
                        if ( $has_first_payment ) {
                            echo '<div class="ProductInfo" data-type="product-first-payment">',
                                '<span data-type="total-label" class="productPrice">',
                                    esc_html__( 'First payment', 'north-comerce' ),
                                '</span>',
                                '<span data-type="total-period" class="productPrice">',
                                    Settings::formatted_price( $product['payment_detail']['first_payment'] ),
                                '</span>',
                            '</div>';
                        }
                        ?>
                        <div class="ProductInfo" data-type="product-remaining-payments">
							<span data-type="total-label" class="productPrice">
								<?php esc_html_e( 'Remaining payments', 'north-commerce' ); ?>
							</span>
                            <span data-type="total-period" class="productPrice">
                            <?php

                            $payments_counter = $product['payment_detail']['num_payments'];
                            $price = floatval( $product['base_price'] );

                            if ( $has_first_payment ) {
                                $price -= floatval( $product['payment_detail']['first_payment'] );
                            }

                            echo $payments_counter . ' of ' . Settings::formatted_price( $price / $payments_counter );

                            ?>
                            </span>
                        </div>
                        <?php

                    }

                    if ( ProductTypes::oneTime()->slug === $product_type_slug ) {
                        ?>
                        <div class="ProductTotal" data-type="product-total">
                            <span data-type="total-label" class="productPrice">
								<?php esc_html_e( 'Price:', 'north-commerce' ); ?>
							</span>
                            <span data-type="total-value" class="productPrice">
                                <?php echo Settings::formatted_price( $product['base_price'] ); ?>
                            </span>
                        </div>
                        <?php
                    }

                    unset(
                        $product_id,
                        $price,
                        $count,
                    );

                    ?>
                </div>
            </div>
            <?php
        }
    }

    ?>
    <div class="SectionWrapper"class="SectionWrapper" data-type="section">
        <div class="SectionHeader" data-type="section-header">
            <div>
                <h4 class="sectionTitle" data-h-tag-level="level">
                    <?php esc_html_e( 'Contact Information', 'north-commerce' ); ?>
                </h4>
            </div>
        </div>

        <div class="textFieldWrapper" data-type="firstName">
            <div class="textFieldMain" data-type="firstName-input">
                <label class="textFieldLabel"></label>
                <input
                    class="textFieldInput"
                    placeholder="<?php esc_attr_e( 'First Name', 'north-commerce' ); ?>"
                    type="text"
                    required
                >
            </div>
            <div class="textFieldError" data-type="error">
                <span class="ErrorIcon textFieldErrorIcon" data-type="error-icon">
                    <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                </span>
            </div>
        </div>

        <div class="textFieldWrapper" data-type="secondName">
            <div class="textFieldMain" data-type="secondName-input">
                <label class="textFieldLabel"></label>
                <input
                    class="textFieldInput"
                    placeholder="<?php esc_attr_e( 'Last Name', 'north-commerce' ); ?>"
                    type="text"
                    required
                >
            </div>
            <div class="textFieldError" data-type="error">
                <span class="ErrorIcon textFieldErrorIcon" data-type="error-icon">
                    <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                </span>
            </div>
        </div>

        <div class="textFieldWrapper" data-type="email">
            <div class="textFieldMain" data-type="email-input">
                <label class="textFieldLabel"></label>
                <input
                    class="textFieldInput"
                    placeholder="<?php esc_attr_e( 'Email Address', 'north-commerce' ); ?>"
                    type="email"
                    required
                >
            </div>
            <div class="textFieldError" data-type="error">
                <span class="ErrorIcon textFieldErrorIcon" data-type="error-icon">
                    <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                </span>
            </div>
        </div>
        <?php

        if ( $args['password_field'] ) {
            do_action( 'north-commerce-license-accounts/checkout-form/after-email' );
        }

        ?>
        <div class="phoneWrapper" data-type="phone">
            <div class="phoneMain" data-type="firstName-input">
                <label class="phoneLabel"></label>
                <select class="phoneSelect phoneInputFocus"></select>
                <div class="phoneSelectDivider"></div>
                <input
                    class="phoneInput phoneInputFocus"
                    placeholder="<?php echo esc_attr( $args['propertyStates']['inputPlaceholder'] ?? '' ); ?>"
                    required
                >
            </div>
            <div class="phoneError" data-type="error">
                <span class="phoneErrorIcon" data-type="error-icon">
                    <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                </span>
            </div>
        </div>
    </div>

    <div class="SectionWrapper shippingWrapper" data-type="section">
        <div class="SectionHeader" data-type="section-header">
            <div>
                <h4 class="sectionTitle" data-h-tag-level="level">
                    <?php esc_html_e( 'Shipping', 'north-commerce' ); ?>
                </h4>
            </div>
        </div>

        <div class="addressMainWrapper" data-type="address">
            <div class="addressComponent">
                <div class="addressMain">
                    <div class="addressWrapper addressBackground">
                        <label class="addressLabel"></label>
                        <input
                            class="checkout_address addressText addressBackground addressInputJoin"
                            type="text"
                            data-nc-selector="spc-shipping-address"
                            placeholder="<?php esc_attr_e( 'Shipping address', 'north-commerce' ); ?>"
                        >
                    </div>
                    <div class="address_component__error" data-type="error">
                        <span class="ErrorIcon address_component__error" data-type="error-icon">
                            <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                        </span>
                    </div>
                </div>

                <div class="addressMain">
                    <div class="addressWrapper addressBackground">
                        <label class="addressLabel"></label>
                        <input
                            class="checkout_city addressText addressBackground addressInputJoin"
                            type="text"
                            data-nc-selector="spc-shipping-city"
                            placeholder="<?php esc_attr_e( 'City', 'north-commerce' ); ?>"
                        >
                    </div>
                    <div class="address_component__error" data-type="error">
                        <span class="ErrorIcon address_component__error" data-type="error-icon">
                            <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                        </span>
                    </div>
                </div>

                <div class="addressRow">
                    <div class="addressMain addressShortInput">
                        <div class="addressWrapper">
                            <label class="addressLabel"></label>
                            <input
                                class="checkout_state addressText addressBackground addressPaddings"
                                type="text"
                                data-nc-selector="spc-shipping-subunit"
                                placeholder="<?php esc_attr_e( 'State', 'north-commerce' ); ?>"
                            >
                        </div>
                        <div class="address_component__error" data-type="error">
                            <span class="ErrorIcon address_component__error" data-type="error-icon">
                                <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                            </span>
                        </div>
                    </div>
                    <div class="addressMain addressShortInput">
                        <div class="addressWrapper">
                            <label class="addressLabel"></label>
                            <input
                                class="checkout_zip addressText addressBackground addressPaddings"
                                type="text"
                                data-nc-selector="spc-shipping-zip"
                                placeholder="<?php esc_attr_e( 'Zip', 'north-commerce' ); ?>"
                            >
                        </div>
                        <div class="address_component__error" data-type="error">
                            <span class="ErrorIcon address_component__error" data-type="error-icon">
                                <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="addressMain">
                    <div class="addressWrapper addressBackground">
                        <label class="addressLabel"></label>
                        <input
                            class="checkout_country addressText addressBackground addressInputJoin"
                            type="text"
                            data-nc-selector="spc-shipping-country"
                            placeholder="<?php esc_attr_e( 'Country', 'north-commerce' ); ?>"
                        >
                    </div>
                    <div class="address_component__error" data-type="error">
                        <span class="ErrorIcon address_component__error" data-type="error-icon">
                            <?php include NORTH_COMMERCE_PLUGIN_DIR_PATH . 'public/images/error.svg'; ?>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <?php

    if ( ! empty( $args['bumps'] ) && $args['bumps'][0] !== '' ) {
        foreach ( $args['bumps'] as $bump_id ) {
            $id = North_Component::get_formated_id( $bump_id );
            $product_id = $bump_id;
            $product_obj = new North_Commerce_Product( $product_id );
            $product = $product_model->get_by_id( $product_id );
            $price = floatval( $product['base_price'] );

            $inventoried = $product['quantity'];
            $inventoried = $inventoried === '' || intval( $inventoried ) > 0;

            ?>
            <div class="SectionWrapper" data-type="section">
                <div data-type="orderBump" class="OrderBumpWrapper"
                    id=<?php echo esc_attr( $id ); ?>
                    data-product-id="<?php echo esc_attr( $product_id );?>"
                    data-price="<?php echo esc_attr( $price ); ?>"
                >
                    <div class="orderBumpComponent">
                        <div data-type="order-bump-product">
                            <div class="orderBumpTitle">
                                <?php
                                if ( $reload_bump ?? false ) {
                                    $title = 100 - floatval( $bump_price ?? 0 ) * 100 / floatval( $product['base_price'] );
                                    echo esc_html( $title . 'n% off only for you' );
                                }
                                ?>
                            </div>
                            <div>
                                <div data-type="order-bump-preview" class="OrderBumpContainer">
                                    <div class="OrderBumpImgContainer" >
                                        <?php
                                        if ( ! empty( $product['product_images'][0]['image_url'] ) ) {
                                            echo '<img',
                                                ' class="OrderBumpImg orderBumpImgBorder"',
                                                ' alt="Order bump"',
                                                ' src="' . $product['product_images'][0]['image_url'] . '"',
                                            '>';
                                        }
                                        ?>
                                    </div>
                                    <div class="OrderBumpTextBlock">
                                        <div class="orderBumpProductName">
                                            <?php echo esc_html( $product['name'] ); ?>
                                        </div>
                                        <div>
                                            <?php
                                            if ( $reload_bump ?? false ) {
                                                ?>
                                                <span class="orderBumpPrice">
                                                    <?php echo Settings::formatted_price( $bump_price ?? 0 ); ?>
                                                </span>
                                                <s><span class="orderBumpOldPrice"><?php echo Settings::formatted_price( $product['base_price'] ); ?></span> </s>
                                                <?php
                                            } else {
                                                ?>
                                                <span class="orderBumpPrice"><?php echo Settings::formatted_price( $product['base_price'] ); ?></span>
                                                <?php
                                            }
                                            ?>
                                        </div>
                                        <div class="orderBumpDescription">
                                            <?php echo $product['description']; ?>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div data-type="order-bump-button" class="OrderBumpButton">
                            <div class="OrderBumpIconContainer">
                                <?php
                                $bump_id_attr = 'product_' . $product_id . '_bump';

                                echo '<div class="OrderBumpIcon">',
                                    '<input',
                                        ' id="' . esc_attr( $bump_id_attr )  . '"',
                                        ' type="checkbox"',
                                        ' class="BumpRadio BumpRadioCheckedAfter"',
                                        disabled( ! $inventoried, true, false ),
                                        '>',
                                    '<label for="' . esc_attr( $bump_id_attr )  . '" class="BumpRadioLabelBefore"></label>',
                                '</div>';

                            echo '</div>';

                            echo '<div class="orderBumpText">',
                                '<label for="' . esc_attr( $bump_id_attr )  . '">',
                                    esc_html__( 'Yes, add this offer to my order.', 'north-commerce' ),
                                '</label>',
                            '</div>';
                            ?>
                        </div>
                    </div>
                </div>
            </div>
            <?php

            unset(
                $id,
                $product_id,
                $product_obj,
                $price,
                $inventoried,
                $title
            );
        }
    }

    ?>
    <div class="SectionWrapper" data-type="section">
        <div data-type="spc-order" class="spc-order">
            <div data-type="spc-subtotal" class="order__row spc-subtotal">
                <span class="spc-subtotal__label">
                    <?php esc_html_e( 'Subtotal', 'north-commerce' ); ?>
                </span>
                <span class="spc-subtotal__value">
                    <?php echo Settings::formatted_price( 0 ); ?>
                </span>
            </div>
            <div data-type="spc-special-offer" class="order__row spc-special-offer" style="display: none;">
                <span class="spc-special-offer__label">
                    <?php esc_html_e( 'Special offer', 'north-commerce' ); ?>
                </span>
                <span class="spc-special-offer__value">
                    <?php echo Settings::formatted_price( 0 ); ?>
                </span>
            </div>
            <?php
            ( new North_Commerce_Template_Loader() )->get_template_part( 'promo-code' );
            ?>
            <hr class="divider">
            <div data-type="spc-total" class="order__row spc-total">
                <span class="spc-total__label">
                    <?php esc_html_e( 'Total', 'north-commerce' ); ?>
                </span>
                <span class="spc-total__value">
                    <?php echo Settings::formatted_price( 0 ); ?>
                </span>
            </div>
        </div>
    </div>

    <div class="SectionWrapper paymentMethodWrapper" data-type="section">
        <div class="SectionHeader" data-type="section-header">
            <div>
                <h4 class="sectionTitle" data-h-tag-level="level">
                    <?php esc_html_e( 'Payment Method', 'north-commerce' ); ?>
                </h4>
            </div>
        </div>

        <div class="PaymentWrapper" data-type="payment">
            <div id="payment-request-button"></div>
            <?php

			$paypal = new North_Commerce_Paypal();
			if ( $paypal->is_connected() ) {
                ?>
				<div id="paypal-buttons" class="DefaultButton payPal">
					<span class="Icon" data-type="icon"></span>
				</div>
                <?php
			}

			$stripe = new North_Commerce_Stripe();
            if ( $stripe->is_connected() ) {
				?>
				<div>
					<input type="hidden" name="stripe_token" id="stripe_token" value="">
					<input type="hidden" name="card_last_four" id="card_last_four" value="">
					<input type="hidden" name="card_brand" id="card_brand" value="">
                    <input type="hidden" name="card_exp_date" id="card_exp_date" value="">

					<div class="DefaultButton Card CardDebit cardHover stripe">
                        <?php esc_html_e( 'Credit or debit card', 'north-commerce' ); ?>
					</div>
					<div class="cardBody">
						<div class="cardDataMain">
							<div class="CardDataWrapper">
								<label class="cardDataLabel">
                                    <?php esc_html_e( 'Card number', 'north-commerce' ); ?>
								</label>
								<div id="card-element" class="cardDataText"></div>
							</div>
						</div>
					</div>
				</div>
				<?php
			}

			$mollie = new North_Commerce_Mollie();
            if ( $mollie->is_connected() ) {
				include 'template-form-mollie.php';
			}

            ?>
        </div>
    </div>

    <div class="payment-error"></div>

    <button class="CheckoutFormBodySubmitButton" data-type="submit-button">
        <span class="CheckoutFormBodySubmitButtonSpan">
            <?php esc_html_e( 'Place order', 'north-commerce' ); ?>
        </span>
    </button>

</form>
