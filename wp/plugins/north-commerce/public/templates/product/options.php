<?php
/**
 * Template partial for product variations.
 *
 * Displays the variations for a product. Currently supports custom color and size swatches,
 * as well as a dropdown for any unspecified variation types.
 *
 * @category   Templates
 * @package    North_Commerce
 * @subpackage North_Commerce/templates/product
 * @author     Zach Stepek <zach@mightyswarm.com>
 * @license    https://opensource.org/licenses/GPL-3.0 GNU Public License
 * @version    0.0.1
 * @link       https://northcommerce.com
 */


$nc_product = new North_Commerce_Product( $product['id'] );

?>
<div class="nc-variations" data-product-id="<?php echo $product['id'] ?>">
	<?php
	// Filter out options with non-null 'deleted' value
	$filteredOptions = array_filter($product['product_options'], function ($option) {
		return $option['deleted'] === NULL;
	});

	// Loop through filtered options
	foreach ( $filteredOptions as $i => $option ) {
		?>
		<div
			class="nc-variation"
			data-id="<?php echo $option['id']?>"
			data-name="<?php echo $option['name'] ?>"
			data-type="<?php echo $option['product_option_type']['slug'] ?>"
		>
			<?php
			$this->use( "product/option-{$option['product_option_type']['slug']}", [
				'has_stock' => true,
				'option' => $option,
				'product' => $product,
				'index' => $i
			] );
			?>
		</div>
		<?php
	}
	?>
</div>
<?php $this->use('product/options-embed-data', ['product' => $product]); ?>
