<?php

use NorthCommerce\Models\OrderModel;

$product_image         = $line_item['product_variant']['product']['product_images'][0]['image_url'];
$product_variant_image = $line_item['product_variant']['image_url'];
// Looks for a product variant image else, shows first product image
$main_image = ! empty( $product_variant_image ) ? $product_variant_image : $product_image;

$option_values_human_map = OrderModel::getOrderLineItemValuesForHuman( $line_item );

foreach ( $option_values_human_map as $option_name => $option_value ) {
	if ( preg_match( '/\.(?:jpg|jpeg|png|webp|gif|svg])$/m', $option_value ) ) {
		$main_image = $option_value;
	}
}
?>

<div class="nc-account-order-item">
    <div class="nc-account-order-item-image">
        <img src="<?php echo $main_image ?>" alt="<?php echo $line_item['product_variant']['product']['name'] ?>">
    </div>
    <div class="nc-account-order-item-content">
        <div class="nc-account-order-item-title nc-font-h2"><?php echo $line_item['product_variant']['product']['name'] ?></div>
        <div class="nc-account-order-item-specs">
            <div>Quantity: <strong><?php echo $line_item['quantity'] ?></strong></div>
			<?php foreach ($option_values_human_map as $option_name => $option_value ) {
				if ( preg_match( '/\.(?:jpg|jpeg|png|webp|gif|svg])$/m', $option_value ) ) {
					continue;
				}

				if( preg_match('/^#.{3,6}$/', $option_value)) {
					$option_value = '<span class="nc-cart-option-color" style="background-color: ' . $option_value . '"></span>';
				}
                ?>
                <div><?php echo $option_name ?>: <strong><?php echo $option_value ?></strong></div>
			<?php } ?>
        </div>
    </div>
    <div class="nc-account-order-item-additional">
        <div class="nc-account-order-item-price nc-font-h2"><?php echo North_Commerce_settings::get_currency_symbol() . $line_item['amount'] ?></div>
        <!-- TODO - Add quick add to cart function  -->
        <!-- <button class="nc-account-button">Buy It Again</button> -->
    </div>
</div>
