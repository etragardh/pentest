<?php
/*
 * A PHP file for implementing a handler that can be invoked
 * during the template_redirect process
 */

namespace NorthCommerce\Redirects;

define( 'NC_REDIRECT_HANDLER_ACTION_NAME', 'nc_rh_action' );

abstract class RedirectHandler {

	/**
	 * How is this handler identified?
	 * Must be a URL friendly slug.
	 */
	abstract public function slug();

	/**
	* execute this handler. Can return a URL to redirect to
	* or `true` if the page should render as normally.
	*/
	abstract public function handle($params);

	/**
	 * When `handle` throws an exception, what URl
	 * should we redirect to?
	 */
	public function onErrorUrl(\Exception $exception) {
		return false;
	}

	/**
	 * Construct a URL that when invoked will kick off this handler.
	 */
	public function handlerUrl( $params = [] ) {
		$args = [ NC_REDIRECT_HANDLER_ACTION_NAME => $this->slug() ] + $params;
		return home_url() . '?' . http_build_query( $args );
	}

}
