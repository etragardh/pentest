<?php
namespace NorthCommerce\Models;

defined( 'ABSPATH' ) || exit;

/**
 * Webhook trigger model.
 *
 * @package north-commerce/includes/models
 * @link    https://northcommerce.com/
 * @since   0.1.10
 * @version 0.1.19
 */
class WebhookTrigger extends BaseModel {


    /**
     * Undocumented function
     */
    public function __construct() {

        parent::__construct();

        $this->table = "webhook_triggers";
        $this->subtables = [
            'trigger_types' => 'webhook_trigger_types',
            'webhook' => 'webhook'
        ];
    }

    /**
     * Undocumented function
     *
     * @return void
     */
    public function getExpands() {
        return [
            'webhook_trigger_type',
            'webhook'
        ];
    }

    /**
     * Register a trigger for a given webhook id
     */
    public function register( $id, $table, $action ) {

        // Lookup trigger type by slug from webhook_trigger_types table
        try {

            $trigger_type = $this->ea->get('webhook_trigger_types', ['slug' => $action]);

            // Alternate version for managing this - 1. add webhook to webhooks table
            $this->ea->create($this->table,
            [
                "webhook_id" => $id,
                "table_name" => $table,
                "webhook_trigger_type_id" => $trigger_type['id']
            ]);

        } catch(Exception $e) {

            throw $e;

        }

    }

}