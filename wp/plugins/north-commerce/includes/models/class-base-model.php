<?php
namespace NorthCommerce\Models;

use North_Commerce_Db_Entity_Access as Db_Entity_Access;

/**
 * Base model.
 *
 *
 * @package north-commerce/includes/models
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.3
 * @version 0.1.24
 */
class BaseModel {

    public $table;
    protected $subtables = [];
    protected $ea;

	public function __construct() {
        $this->ea = new Db_Entity_Access();
    }

    public function getExpands() {
        return [];
    }

	/**
	 * @since   0.1.3
	 * @version 0.1.24
	 */
    public function list_all( $criteria = [], $options = [] ) {

	    if ( empty( $criteria ) ) {
            $criteria = true;
	    }

        if ( isset( $options['expand'] ) && false === $options['expand'] ) {
            unset( $options['expand'] );
        } else if ( empty( $options['expand'] ) ) {
            $options['expand'] = $this->getExpands();
        }

		return $this->ea->list( $this->table, $criteria, $options );

    }

    public function get( $id, $options = [] ) {
        return $this->ea->get( $this->table, compact( 'id' ), $options );
    }

    public function insert( $record ) {
        return $this->ea->create( $this->table, $record );
    }

    public function update( $id, $record ) {
        return $this->ea->update( $this->table, $this->get( $id ), $record );
    }

    /**
     * @since 0.1.21
     */
    public function store( $data ) {
        return $this->ea->store( $this->table, $data );
    }

    /**
     * @version 0.1.21
     */
    public function get_total_count( $criteria = true, $options = [] ):int {
        if ( empty( $options['columns'] ) ) {
            $options['columns'] = [ 'id' ];
        }

        return count( $this->ea->list( $this->table, $criteria, $options ) );
    }

    /**
	 * @since   0.1.20
	 * @version 0.1.21
     *
     * @param  int|string $t UNIX timestamp
     * @return string        SQL formatted date/time
	 */
	final public static function sql_timestamp( $t = null ):string {
        if ( empty( $t ) ) {
            $t = time();
        }
		return date( 'Y-m-d H:i:s', $t );
	}

}
