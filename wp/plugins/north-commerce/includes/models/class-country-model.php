<?php
namespace NorthCommerce\Models;

defined( 'ABSPATH' ) || exit;

/**
 * Country model.
 *
 * @package north-commerce/includes/models
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.12
 * @version 0.1.24
 */
class CountryModel extends BaseModel {

	private static $cached_countries_list;

    public function __construct() {
        parent::__construct();
        $this->table = 'countries';
    }

	public function get( $criteria, $options = [] ) {
		return $this->ea->get( $this->table, $criteria, $options );
	}

	public function get_by_id( $country_id , $options = [] ) {
		return $this->get( [ 'id' => $country_id ], $options );
	}

	public function get_by_abbreviation( $country_abbr, $options = [] ) {
		return $this->get( [ 'abbreviation' => $country_abbr ], $options );
	}

	/**
	 * @version 0.1.24
	 */
	public function list_all( $criteria = true, $options = [] ) {
		return $this->ea->list( $this->table, $criteria, $options );
	}

	/**
	 * @version 0.1.24
	 */
	public function get_formated_list( $options = [] ) {

		$criteria = true;

		if ( $options ) {
			return $this->list_all( $criteria, $options );
		}

		if ( ! self::$cached_countries_list ) {
			$options['columns'] = $options['columns'] ?? [ 'name', 'abbreviation' ];
			$list = $this->list_all( $criteria, $options );
			foreach ( $list as $country ) {
				self::$cached_countries_list[ $country['abbreviation'] ] = $country['name'];
			}
		}

		return self::$cached_countries_list;

	}

}