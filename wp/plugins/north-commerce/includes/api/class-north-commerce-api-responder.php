<?php
/*
 * A PHP file for implementing the code that will
 * format our responses.
 */
class North_Commerce_Api_Responder
{
	private $pager;

	function __construct()
	{
		$this->pager = new North_Commerce_Api_Pager();
	}

	public function pager()
	{
		return $this->pager;
	}

	public function newRequestCtx($request) {
		return [
			'request' => $request,
			'started' => microtime(true)
		];
	}

	public function prepareResponse($ctx, $value, $options = []) {
		$res = [
			'code' => 'ok',
			'message' => 'ok',
			'meta' => [
				'timing' => round(microtime(true) - $ctx['started'], 4)
			] + nc_g($options, 'meta', []),
			'data' => $value,
		];

		if (nc_g($options, 'paging')) {
			$res = $this->pager->addPaging($ctx['request'], $res);
		}

		return $res;
	}

	public function prepareQueryParams( $names, $validator ) {
		return array_reduce( $names, function( $carry, $name ) use ( $validator ) {
			$carry[ $name ] = [
				'required' => false,
				'validate_callback' => [ $validator, 'validate' . ucfirst( $name ) ]
			];
			return $carry;
		});
	}


}
