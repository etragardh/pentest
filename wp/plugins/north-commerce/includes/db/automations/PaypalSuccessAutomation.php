<?php
/*
 * A PHP file for verifying and updating an order when a paypal
 * transaction is successful.
 */

namespace NorthCommerce\Db\Automations;

use NorthCommerce\Db\Collections\PaymentProviders;
use NorthCommerce\Services\PaypalHelper;

class PaypalSuccessAutomation extends OrderTransactionSuccessAutomation
{

	public function paymentProvider()
	{
		return PaymentProviders::paypal();
	}

	public function isSuccessful($transaction_id)
	{
		$ph = new PaypalHelper();
		$order = $ph->invokeApi([
			'method' => "GET",
			'path' => "/v2/checkout/orders/{$transaction_id}"
		]);

		$oks = [
			'APPROVED', 'COMPLETED'
		];

		return in_array($order['status'], $oks);
	}

}
