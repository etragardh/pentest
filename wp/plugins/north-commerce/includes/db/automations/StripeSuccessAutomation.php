<?php
/*
 * A PHP file for verifying and handling what happens
 * when we take order_transaction associated with a stripe
 * transaction and mark it as successful.
 *
 * We verify this is true by calling back to stripe.
 */

namespace NorthCommerce\Db\Automations;

use NorthCommerce\Db\Collections\PaymentProviders;
use NorthCommerce\Services\StripeHelper;

class StripeSuccessAutomation extends OrderTransactionSuccessAutomation {

	public function paymentProvider() {
		return PaymentProviders::stripe();
	}

	public function isSuccessful( $transaction_id ) {
		$sh = new StripeHelper();
		$client = $sh->stripeClient();
		$pi = $client->paymentIntents->retrieve( $transaction_id );

		return 'succeeded' === $pi->status;
	}

}
