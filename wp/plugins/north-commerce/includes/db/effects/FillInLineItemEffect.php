<?php
/*
 * A PHP file for filling in the remaining details of a line
 * item, like the amount and description
 */

namespace NorthCommerce\Db\Effects;

class FillInLineItemEffect extends PreEffect
{

	protected static function behavior($li)
	{
		$pv = Effect::$ea->get('product_variants', ['id' => $li['product_variant_id']]);
		if(!$pv) {
			throw new \Exception("product_variant: [{$li['product_variant_id']}] not found");
		}

		$p = Effect::$ea->get('products', ['id' => $pv['product_id']]);


		if(!$p) {
			throw new \Exception("product: [{$pv['product_id']}] not found");
		}


		$price = $pv['price'] == null ? $p['base_price'] : $pv['price'];

		$li['amount'] = $li['quantity'] * $price;
		$li['description'] = "{$p['name']}";

		return $li;
	}
}
