<?php
/*
 * A PHP file for making sure that a customer has only one shipping and billing
 * default address
 */

namespace NorthCommerce\Db\Effects;

class EnforceDefaultAddressEffect extends PostEffect
{

	protected static function behavior($address) {

		$all_addresses = Effect::$ea->list('addresses', [
			'customer_id' => $address['customer_id'],
		]);

		foreach(['shipping', 'billing'] as $type) {
			if ( ! $address["is_default_{$type}"] ) {
				continue;
			}

			foreach($all_addresses as $addr) {
				if ( $addr['id'] != $address['id'] ) {
					Effect::$ea->update( 'addresses', $addr, [
						"is_default_$type" => 0
					] );
				}
			}
		}

		return $address;
	}

}
