<?php
namespace NorthCommerce\Db\Coupons;

defined( 'ABSPATH' ) || exit;

/**
 * Usage requirement.
 *
 * @package north-commerce/includes/db/coupons
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.21
 * @version 0.1.21
 */
class Usage_Requirement extends Requirement {

	public function verify( array $coupon, Coupon_Criteria $criteria ) {

		if ( ! isset( $coupon['usage_limit'] ) ) {
			return true;
		}

		return $this->is_valid( $coupon ) ?: $this->error_message();

	}

	protected function is_valid( array $coupon ): bool {
		return intval( $coupon['usage_counter'] ) < intval( $coupon['usage_limit'] );
	}

	protected function error_message(): string {
		return 'This coupon has already been redeemed as many times as it allows.';
	}

}
