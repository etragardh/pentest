<?php
/*
 * A PHP file for querying customers with a name and country.
 * Name is fuzzy matched.
 */
$inputs = ['name', 'country_abbreviation'];

$example = function(North_Commerce_Db_Entity_Access $ea, $name, $country_abbreviation) {
	return $ea->list('customers', [
		'and',
		['=', 'addresses.country.abbreviation', $country_abbreviation],
		['or',
		 ['like', 'first_name', "%{$name}%"],
		 ['like', 'last_name', "%{$name}%"],
		 ['like', 'email', "%{$name}%"]]
	], ['expand' => 'addresses.country']);
};
