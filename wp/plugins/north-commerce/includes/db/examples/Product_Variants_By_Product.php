<?php
/*
 * A PHP file for showing which product variants are associated with
 * a given product
 */

$inputs = ['product_id'];

$example = function(North_Commerce_Db_Entity_Access $ea, $product_id) {
	if($product_id == 'latest') {
		$p = $ea->get('products', true , ['order_by' => 'created DESC']);
		$product_id = $p['id'];
	}

	$product_variant_option_values = $ea->list('product_variant_option_values', [
		'product_variant.product_id' => $product_id,
	], [
		'expand' => 'product_option_value.product_option'
	]);

	$buffer = [];

	foreach($product_variant_option_values  as $pvov) {
		$value = $pvov['product_option_value']['value'];
		$name = $pvov['product_option_value']['product_option']['name'];
		$variant_id = $pvov['product_variant_id'];
		if(!isset($buffer[$variant_id])) {
			$buffer[$variant_id] = [];
		}
		$buffer[$variant_id][$name] = $value;
	}

	return $buffer;
};
