<?php
/*
 * A PHP file for upgrading the schema to v3
 */
?>
-- Table: order_statuses
CREATE TABLE <?= $prefix ?>order_statuses (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  name VARCHAR(128),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('Fulfilled');
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('Scheduled');
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('On Hold');
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('Unfilfilled');
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('Ready for pickup');
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('Picked Up');
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('Out For Delivery');
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('Delivered');
INSERT INTO <?= $prefix ?>order_statuses (name) VALUES ('Abandoned');

-- Table: payment_statuses
CREATE TABLE <?= $prefix ?>payment_statuses (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  name VARCHAR(128),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
INSERT INTO <?= $prefix ?>payment_statuses (name) VALUES ('Paid');
INSERT INTO <?= $prefix ?>payment_statuses (name) VALUES ('Failed');
INSERT INTO <?= $prefix ?>payment_statuses (name) VALUES ('Pending');
INSERT INTO <?= $prefix ?>payment_statuses (name) VALUES ('Void');
INSERT INTO <?= $prefix ?>payment_statuses (name) VALUES ('Unpaid');
INSERT INTO <?= $prefix ?>payment_statuses (name) VALUES ('Failed');
INSERT INTO <?= $prefix ?>payment_statuses (name) VALUES ('Refunded');
INSERT INTO <?= $prefix ?>payment_statuses (name) VALUES ('Partially Refunded');

-- Table: shipping_details
CREATE TABLE <?= $prefix ?>shipping_details (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  carrier_name VARCHAR(128),
  tracking_number VARCHAR(255),
  estimated_delivery TIMESTAMP,
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: orders
CREATE TABLE <?= $prefix ?>orders (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  customer_wp_user_id BIGINT UNSIGNED,
  order_status_id BIGINT,
  FOREIGN KEY(order_status_id) REFERENCES <?= $prefix ?>order_statuses(id),
  payment_status_id BIGINT,
  FOREIGN KEY(payment_status_id) REFERENCES <?= $prefix ?>payment_statuses(id),
  shipping_detail_id BIGINT NULL,
  FOREIGN KEY(shipping_detail_id) REFERENCES <?= $prefix ?>shipping_details(id),
  shipping DECIMAL(13,2),
  tax DECIMAL(13,2),
  total DECIMAL(13,2),
  paid DECIMAL(13,2),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: line_items
CREATE TABLE <?= $prefix ?>line_items (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  order_id BIGINT,
  FOREIGN KEY(order_id) REFERENCES <?= $prefix ?>orders(id),
  product_wp_post_id BIGINT UNSIGNED,
  description VARCHAR(255),
  amount DECIMAL(13,2),
  quantity INT,
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: order_change_types
CREATE TABLE <?= $prefix ?>order_change_types (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  slug VARCHAR(128),
  name VARCHAR(128),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
INSERT INTO <?= $prefix ?>order_change_types (slug, name) VALUES ('order-placed', 'Order Placed');
INSERT INTO <?= $prefix ?>order_change_types (slug, name) VALUES ('payment-processed', 'Payment Processed');
INSERT INTO <?= $prefix ?>order_change_types (slug, name) VALUES ('shipping-calculated', 'Shipping Rate Calculated');


-- Table: order_changes
CREATE TABLE <?= $prefix ?>order_changes (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  order_id BIGINT,
  FOREIGN KEY(order_id) REFERENCES <?= $prefix ?>orders(id),
  order_change_type_id BIGINT,
  FOREIGN KEY(order_change_type_id) REFERENCES <?= $prefix ?>order_change_types(id),
  value DECIMAL(13,2),
  description VARCHAR(255),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
