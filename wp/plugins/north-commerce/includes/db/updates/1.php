<?php
/*
 * Most DB upgrade scripts describe how to get from version N-1 to N.
 *
 * But in this case, 1.php represents our complete first schema.
 */


?>

-- Table: product_types
CREATE TABLE <?= $prefix ?>product_types (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  name VARCHAR(128),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
INSERT INTO <?= $prefix ?>product_types (name) VALUES ('One Time');
INSERT INTO <?= $prefix ?>product_types (name) VALUES ('Subscription');
INSERT INTO <?= $prefix ?>product_types (name) VALUES ('Payment Plan');

-- Table: categories
CREATE TABLE <?= $prefix ?>categories (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  slug VARCHAR(255),
  name VARCHAR(255),
  parent_id BIGINT NULL,
  FOREIGN KEY(parent_id) REFERENCES <?= $prefix ?>categories(id),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: tags
CREATE TABLE <?= $prefix ?>tags (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  slug VARCHAR(255),
  name VARCHAR(255),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: statuses
CREATE TABLE <?= $prefix ?>statuses (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  slug VARCHAR(128),
  name VARCHAR(128),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
INSERT INTO <?= $prefix ?>statuses (slug, name) VALUES ('published', 'Published');
INSERT INTO <?= $prefix ?>statuses (slug, name) VALUES ('draft', 'Draft');
INSERT INTO <?= $prefix ?>statuses (slug, name) VALUES ('archive', 'Archive');
INSERT INTO <?= $prefix ?>statuses (slug, name) VALUES ('schedule', 'Schedule');

-- Table: payment_frequencies
CREATE TABLE <?= $prefix ?>payment_frequencies (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  name VARCHAR(128),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
INSERT INTO <?= $prefix ?>payment_frequencies (name) VALUES ('Weekly');
INSERT INTO <?= $prefix ?>payment_frequencies (name) VALUES ('Monthly');
INSERT INTO <?= $prefix ?>payment_frequencies (name) VALUES ('Yearly');

-- Table: free_trial_types
CREATE TABLE <?= $prefix ?>free_trial_types (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  name VARCHAR(128),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
INSERT INTO <?= $prefix ?>free_trial_types (name) VALUES ('Days');
INSERT INTO <?= $prefix ?>free_trial_types (name) VALUES ('Months');

-- Table: payment_details
CREATE TABLE <?= $prefix ?>payment_details (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  payment_frequency_id BIGINT,
  FOREIGN KEY(payment_frequency_id) REFERENCES <?= $prefix ?>payment_frequencies(id),
  free_trial_frequency INT NULL,
  free_trial_type BIGINT NULL,
  FOREIGN KEY(free_trial_type) REFERENCES <?= $prefix ?>free_trial_types(id),
  first_period_payment DECIMAL(13,2) NULL,
  first_payment DECIMAL(13,2) NULL,
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: bump_details
CREATE TABLE <?= $prefix ?>bump_details (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  price DECIMAL(13,2),
  quantity INT NULL,
  first_payment DECIMAL(13,2),
  number_of_payments DECIMAL(13,2),
  payment_frequency_id BIGINT,
  FOREIGN KEY(payment_frequency_id) REFERENCES <?= $prefix ?>payment_frequencies(id),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: products
CREATE TABLE <?= $prefix ?>products (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  sku VARCHAR(128),
  product_type_id BIGINT,
  FOREIGN KEY(product_type_id) REFERENCES <?= $prefix ?>product_types(id),
  name VARCHAR(255),
  description VARCHAR(1024) NULL,
  permalink VARCHAR(128),
  scheduled TIMESTAMP NULL,
  published TIMESTAMP NULL,
  deleted TIMESTAMP NULL,
  status_id BIGINT,
  FOREIGN KEY(status_id) REFERENCES <?= $prefix ?>statuses(id),
  payment_detail_id BIGINT NULL,
  FOREIGN KEY(payment_detail_id) REFERENCES <?= $prefix ?>payment_details(id),
  bump_detail_id BIGINT NULL,
  FOREIGN KEY(bump_detail_id) REFERENCES <?= $prefix ?>bump_details(id),
  base_price DECIMAL(13,2) NULL,
  compare_price DECIMAL(13,2) NULL,
  cost_of_goods_price DECIMAL(13,2) NULL,
  profit DECIMAL(13,2) NULL,
  quantity INT NULL,
  weight INT NULL,
  is_physical_product BOOLEAN,
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: product_images
CREATE TABLE <?= $prefix ?>product_images (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  product_id BIGINT,
  FOREIGN KEY(product_id) REFERENCES <?= $prefix ?>products(id),
  image_url VARCHAR(255),
  sequence INT,
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: product_option_types
CREATE TABLE <?= $prefix ?>product_option_types (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  name VARCHAR(128),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;
INSERT INTO <?= $prefix ?>product_option_types (name) VALUES ('Text');
INSERT INTO <?= $prefix ?>product_option_types (name) VALUES ('Size');
INSERT INTO <?= $prefix ?>product_option_types (name) VALUES ('Color');
INSERT INTO <?= $prefix ?>product_option_types (name) VALUES ('Image');

-- Table: product_options
CREATE TABLE <?= $prefix ?>product_options (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  product_id BIGINT,
  FOREIGN KEY(product_id) REFERENCES <?= $prefix ?>products(id),
  name VARCHAR(128),
  type BIGINT,
  FOREIGN KEY(type) REFERENCES <?= $prefix ?>product_option_types(id),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: product_option_values
CREATE TABLE <?= $prefix ?>product_option_values (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  deleted TIMESTAMP NULL,
  product_option_id BIGINT,
  FOREIGN KEY(product_option_id) REFERENCES <?= $prefix ?>product_options(id),
  value VARCHAR(128),
  price_offset DECIMAL(13,2),
  sequence INT,
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: product_variants
CREATE TABLE <?= $prefix ?>product_variants (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  deleted TIMESTAMP NULL,
  visible BOOLEAN,
  product_id BIGINT,
  FOREIGN KEY(product_id) REFERENCES <?= $prefix ?>products(id),
  sku VARCHAR(128),
  price DECIMAL(13,2) NULL,
  quantity INT NULL,
  image_url VARCHAR(128) NULL,
  sequence INT,
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: product_variant_option_values
CREATE TABLE <?= $prefix ?>product_variant_option_values (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  product_variant_id BIGINT,
  FOREIGN KEY(product_variant_id) REFERENCES <?= $prefix ?>product_variants(id),
  product_option_value_id BIGINT,
  FOREIGN KEY(product_option_value_id) REFERENCES <?= $prefix ?>product_option_values(id),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: product_categories
CREATE TABLE <?= $prefix ?>product_categories (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  product_id BIGINT,
  FOREIGN KEY(product_id) REFERENCES <?= $prefix ?>products(id),
  category_id BIGINT,
  FOREIGN KEY(category_id) REFERENCES <?= $prefix ?>categories(id),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

-- Table: product_tags
CREATE TABLE <?= $prefix ?>product_tags (
  id   BIGINT NOT NULL AUTO_INCREMENT,
  created TIMESTAMP   NOT NULL  DEFAULT CURRENT_TIMESTAMP,
  product_id BIGINT,
  FOREIGN KEY(product_id) REFERENCES <?= $prefix ?>products(id),
  tag_id BIGINT,
  FOREIGN KEY(tag_id) REFERENCES <?= $prefix ?>tags(id),
  PRIMARY KEY(id),
  INDEX(created)
) Engine=Innodb;

