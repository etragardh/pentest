<?php
/*
 * A PHP file for converting the shema from v18 to v19.
 *
 * We add unique indexes to the customers table.
 */

use NorthCommerce\Db\UpdateSchemaHelper;

$schema_helper = new UpdateSchemaHelper();
$schema_helper->mergeDuplicates($prefix . 'customers', 'email');
$schema_helper->mergeDuplicates($prefix . 'customers', 'wp_user_id');
?>

ALTER TABLE <?= $prefix ?>customers DROP INDEX email;
ALTER TABLE <?= $prefix ?>customers DROP INDEX wp_user_id;

ALTER TABLE <?= $prefix ?>customers ADD UNIQUE(email);
ALTER TABLE <?= $prefix ?>customers ADD UNIQUE(wp_user_id);
