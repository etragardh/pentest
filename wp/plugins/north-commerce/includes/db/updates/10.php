<?php
/*
 * A PHP file for upgrading from version 9 to version 10 of our database.
 * Addressing product related issues
 */
$dbi = new North_Commerce_Db_Introspector();
?>
ALTER TABLE <?= $prefix ?>products  ADD cost_margin DECIMAL(13,2) NULL;
ALTER TABLE <?= $prefix ?>products  ADD INDEX(cost_margin);

<?php if(($constraint = $dbi->foreignKeyConstraintName('payment_details', 'free_trial_type', ['prefix' => $prefix]))) { ?>
	ALTER TABLE <?= $prefix?>payment_details DROP FOREIGN KEY <?= $constraint?>;
<?php } ?>
ALTER TABLE <?= $prefix ?>payment_details CHANGE free_trial_type free_trial_type_id BIGINT NULL;
ALTER TABLE <?= $prefix ?>payment_details ADD FOREIGN KEY(free_trial_type_id) REFERENCES <?= $prefix ?>free_trial_types(id);


ALTER TABLE <?= $prefix ?>payment_details ADD num_payments INT NULL;
