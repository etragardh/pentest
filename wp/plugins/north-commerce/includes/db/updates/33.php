<?php
/**
 * Update DB Schema to version 33.
 *
 * and creating `webhook_events` table to represent a one-to-many relationship with `webhooks`
 *
 * @since 0.1.21
 */

$prefix_table = function ( string $table_name ) use ( $prefix ): string {
	return "{$prefix}{$table_name}";
};

?>
CREATE TABLE IF NOT EXISTS <?php echo $prefix_table( 'webhook_events' ); ?> (
	id BIGINT NOT NULL AUTO_INCREMENT
	, PRIMARY KEY(id)
	, webhook_id BIGINT NOT NULL
	, INDEX(webhook_id)
	, FOREIGN KEY(webhook_id) REFERENCES <?php echo $prefix_table( 'webhooks' ); ?>(id)
	, event VARCHAR(255) NOT NULL
	, created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
	, INDEX(created)
) Engine=Innodb;