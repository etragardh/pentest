<?php
namespace NorthCommerce\Db\Shipping;

/**
 * Shipping Criteria for representing how shipping can be filtered
 *
 *
 * @package north-commerce/includes/db/shipping
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @version 0.1.24
 */
class Shipping_Criteria {

	public $product_variants;
	public $cart_weight;
	public $cart_price;
	public $to_address;

	function __construct(
		$product_variants,
		$cart_weight,
		$cart_price,
		$to_address
	) {
		$this->product_variants = $product_variants;
		$this->cart_weight = $cart_weight;
		$this->cart_price = $cart_price;
		$this->to_address = $to_address;
	}

	public function cacheKey() {
		$pv_ids = implode(
			':',
			array_map(
				function( $pv ) { return $pv['id']; },
				$this->product_variants
			)
		);

		$to_str = '';
		ksort( $this->to_address );
		foreach( $this->to_address as $k => $v ) {
			$to_str .= "$k=$v#";
		}

		return implode( '.', [
			'shipping_criteria',
			$to_str,
			$this->cart_price,
			$this->cart_weight,
			$pv_ids
		] );
	}
}
