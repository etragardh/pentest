<?php
namespace NorthCommerce\Db\Security;

/**
 * Public Perspective class.
 *
 * Showing the database to the general public who is not logged in.
 * They can see things like products, but not orders or customers.
 */
class PublicPerspective extends Perspective {

	public function slug() {
		return 'public';
	}

	public function	customizeSchema( $schema ) {
		$customer_perspective = new CustomerPerspective();
		$customer_schema = $customer_perspective->customizeSchema( $schema );

		$visible_cols = [
			'id',
			'email',
			'marketing_optin',
		];

		foreach ( $customer_schema['customers']['cols'] as $col => $details ) {
			unset( $details );
			if ( ! in_array( $col, $visible_cols ) ) {
				unset( $customer_schema['customers']['cols'][ $col ] );
			}
		}

		return $customer_schema;
	}

	public function appliesTo($wp_user) {
		return !$wp_user || $wp_user->ID == 0;
	}
}
