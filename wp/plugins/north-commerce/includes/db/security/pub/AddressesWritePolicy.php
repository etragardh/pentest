<?php
/*
 * A PHP file for implementing write rules for Addresses
 */

namespace NorthCommerce\Db\Security\Pub;

use NorthCommerce\Db\Effects\EnforceDefaultAddressEffect;
use NorthCommerce\Db\Effects\MaybeUpdateCustomerUsingAddressEffect;
use NorthCommerce\Db\Security\ColumnRules;
use NorthCommerce\Db\Security\WritePolicy;

class AddressesWritePolicy extends WritePolicy
{

	private $optional_cols = [
		'first_name',
		'last_name',
		'phone',
		'addressline1',
		'addressline2',
		'city',
		'state',
		'zipcode',
		'country_id',
		'is_default_shipping',
		'is_default_billing',
	];

	public function createColumnRules($values)
	{
		return new ColumnRules(['customer_id'], $this->optional_cols);
	}

	public function updateColumnRules($address, $changes)
	{
		return new ColumnRules([], $this->optional_cols);
	}

	public function entityUpdated($address)
	{
		return $this->entityCreated($address);
	}

	public function	entityCreated($address)
	{
		$address = MaybeUpdateCustomerUsingAddressEffect::run($address);
		$address = EnforceDefaultAddressEffect::run($address);
		return $address;
	}
}
