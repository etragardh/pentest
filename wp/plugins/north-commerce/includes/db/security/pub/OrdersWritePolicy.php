<?php
namespace NorthCommerce\Db\Security\Pub;

use NorthCommerce\Db\Security\{
	ColumnRules,
	WritePolicy
};
use NorthCommerce\Db\Effects\InitOrderEffect;
use NorthCommerce\Db\Collections\OrderStatuses;

/**
 * Public write rules for Orders.
 *
 * @since   0.1.10
 * @version 0.1.11
 */
class OrdersWritePolicy extends WritePolicy {

	private $optional_cols = [
		'billing_address_id',
		'shipping_address_id',
		'customer_payment_method_id',
		'shipping_detail_id'
	];

	public function createColumnRules( $values ) {
		return new ColumnRules( ['customer_id'], $this->optional_cols );
	}

	/**
	 * @since   0.1.10
	 * @version 0.1.11
	 */
	public function updateColumnRules( $order, $changes ) {
		$optional_cols = [];

		if ( $order['order_status_id'] == OrderStatuses::created()->id ) {
			$optional_cols = $this->optional_cols;
		}

		return new ColumnRules( [], $optional_cols );
	}

	public function	prepareForCreate( $values ) {
		return InitOrderEffect::run( $values );
	}

}
