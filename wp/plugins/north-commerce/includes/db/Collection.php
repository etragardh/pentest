<?php
namespace NorthCommerce\Db;

/**
 * A PHP file for representing a collection of rows in a database.
 * This is a base class for autogenerated collection code.
 *
 * This code does the work, while the child classes know the details about the
 * tables and slugs that we're working with.
 */

use North_Commerce_Db_Agent;

abstract class Collection {

	private static $agent = null;

	public static function lookupByColumn( $table, $column, $value ) {
		if ( Collection::$agent == null ) {
			Collection::$agent = North_Commerce_Db_Agent::instance();
		}

		$cache = Collection::$agent->cache();

		return $cache->value(
			"collection.$table.$column.$value",
			function() use( $table, $column, $value ) {
				$row = Collection::$agent->entityAccess()->get( $table, [ $column => $value ] );
				if ( $row == null ) {
					throw new \NcNotFoundException( "Can't find: $table.$column = $value" );
				}
				return (object) $row;
		});
	}

}
