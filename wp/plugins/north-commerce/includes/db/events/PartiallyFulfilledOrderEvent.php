<?php
namespace NorthCommerce\Db\Events;

use NorthCommerce\Db\Collections\{
	PaymentStatuses,
	OrderStatuses
};
use NorthCommerce\Models\OrderModel;

/**
 * Partially Fulfilled order event.
 *
 *
 * @package north-commerce/includes/db/events
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.24
 */
class PartiallyFulfilledOrderEvent extends Event
{
	function name() {
		return "An order is partially fulfilled";
	}

	function key() {
		return 'order.partiallyFulfilled';
	}

	function description() {
		return "This event is triggered when an order's status is updated to `Partially Fulfilled`.";
	}

	function applies($table)
	{
		return $table == 'orders';
	}

	function shouldTrigger($table, $old, $new)
	{
		return (!$old || $old['order_status_id'] != $new['order_status_id']) &&
			   $new['order_status_id'] == OrderStatuses::partiallyFulfilled()->id &&
			   $new['payment_status_id'] == PaymentStatuses::paid()->id;
	}

	function process($data) {

		$orderModel = new OrderModel;
		$newData = $orderModel->get($data);

		return $newData;

	}

}
