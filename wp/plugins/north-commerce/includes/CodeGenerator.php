<?php
/*
 * A PHP file for generating PHP code. Used for things like
 * generating our entity classes. Not used by the plugin during
 * execution
 */

namespace NorthCommerce;

class CodeGenerator {

	public function build( $what, $path, $env, $options = [] ) {
		$dest_path = nc_g( $options, 'dest_dir', __DIR__ . "/../" ) . $path;
		$template_path = __DIR__ . "/codegen/$what.php";

		if ( ! file_exists( $template_path ) ) {
			throw new \Exception( "Can't generate: $what $path:  $template_path doesn't exist" );
		}

		if ( ! is_dir( dirname( $dest_path ) ) ) {
			throw new \Exception( "Destination directory does not exist: $dest_path" );
		}

		$code = $this->fromTemplate( $template_path, $env );
		file_put_contents( $dest_path, $code );
	}

	private function fromTemplate( $template_path, $env ) {
		ob_start();
		extract( $env );
		require $template_path;
		return ob_get_clean();
	}

}
