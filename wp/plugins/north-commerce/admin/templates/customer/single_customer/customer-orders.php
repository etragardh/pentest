<?php

use NorthCommerce\Db\Collections\OrderStatuses;
use North_Commerce_Settings as Settings;

/**
 * Customer orders history template.
 *
 *
 * @package north-commerce/admin/templates/customer
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.25
 */


?>
<div class="wrapper-box order-box">
    <h4>
        <?php esc_html_e( 'Orders History', 'north-commerce' ); ?>
    </h4>
    <?php
    foreach ( $single_customer['orders'] as $order ) {
        $order_status_image = OrderStatuses::fulfilled()->id === $order['order_status']['id']
            ? NORTH_COMMERCE_PLUGIN_DIR_URL . '/admin/images/check.svg'
            : null;

        ?>
        <div class="order-item">
            <div class="order-itemupper">
                <div class="orderitem-upperleft">
                    <h5>
                        <?php echo esc_html( 'Order #' . $order['order_number'] ); ?>
                    </h5>
                    <span>
                        <img
                            src="<?php echo $order_status_image; ?>"
                            alt=""
                        >
                        <?php echo $order['order_status']['name'] ?>
                    </span>
                </div>
                <p>
                    <?php echo Settings::formatted_datetime( $order['created'] ); ?>
                </p>
            </div>
            <?php
            foreach ( $order['line_items'] as $line_item ) {
                ?>
                <div class="order-itemdesc">
                    <div class="order-descleft">
                        <img src="<?php $line_item['product_variant']['image_url'] ?>" alt="">
                        <div class="order-descinner">
                            <p>
                                <?php echo $line_item['product_variant']['product']['product_type']['name']; ?>
                            </p>
                            <h6>
                                <?php echo $line_item['product_variant']['product']['name']; ?>
                            </h6>
                            <?php
                            foreach ( $line_item['product_variant']['product']['product_options'] as $product_options ) {
                                ?>
                                <div class="product-variant-options"> <?php echo $product_options['name'] . ' - ' ?>
                                    <?php
                                    if ( 'Size' == $product_options['name'] ) {
                                        $this->template(
                                            'size-option',
                                            'customer/single_customer/product_options',
                                            [ 'product_options' => $product_options ]
                                        );
                                    } else if ( 'Text' == $product_options['name'] ) {
                                        $this->template(
                                            'text-option',
                                            'customer/single_customer/product_options',
                                            [ 'product_options' => $product_options ]
                                        );
                                    } else if ( 'Color' == $product_options['name'] ) {
                                        $this->template(
                                            'color-option',
                                            'customer/single_customer/product_options',
                                            [ 'product_options' => $product_options ]
                                        );
                                    } else if ( 'Image' == $product_options['name'] ) {
                                        $this->template(
                                            'image-option',
                                            'customer/single_customer/product_options',
                                            [ 'product_options' => $product_options ]
                                        );
                                    }
                                    ?>
                                </div>
                                <?php
                            }
                            ?>
                        </div>
                    </div>
                    <div class="order-descright">
                        <p><?php echo 'x' . $line_item['quantity'] ?></p>
                        <?php echo North_Commerce_Settings::formatted_price( $line_item['quantity'] * $line_item['amount'] ); ?>
                    </div>
                </div>
                <?php
            }
            ?>
        </div>
    <?php } ?>
    <div class="order-totalcnt">
        <h2>Lifetime Value</h2>
        <?php
        $total_spent = 0;
        foreach ( $single_customer['orders'] as $order_total ) {
            $total_spent += $order_total['total'];
        }
        ?>
        <p><?php echo North_Commerce_Settings::formatted_price( $total_spent ); ?></p>

    </div>
</div>
