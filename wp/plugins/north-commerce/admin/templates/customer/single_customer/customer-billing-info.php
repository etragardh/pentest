<?php $template_dir = 'customer/single_customer'; ?>
<div class="wrapper-box contact-box hover-box">
    <div class="billing-address-title-container card__action">
        <h4>
            <?php esc_html_e( 'Billing Address', 'north-commerce' ); ?>
        </h4>
        <a data-form-type="customer-billing" class="btn-edit" href="#"><img src="<?php echo NORTH_COMMERCE_PLUGIN_DIR_URL . '/admin/images/order-edit.svg' ?>"></a>
    </div>
    <?php
    $has_default_shipping = false;
    $has_default_billing = false;
    $default_shipping_address = null;
    $default_billing_address = null;

    // Identify default shipping and billing addresses
    foreach ($single_customer['addresses'] as $address) {
        if ($address['is_default_shipping'] == '1') {
            $has_default_shipping = true;
            $default_shipping_address = $address;
        }
        if ($address['is_default_billing'] == '1') {
            $has_default_billing = true;
            $default_billing_address = $address;
        }
    }

    // Decision logic for rendering addresses
    if ($has_default_shipping || $has_default_billing) {
        if ($has_default_billing) {
            // Show default billing address
            ?>
            <div class="customer-shipping-address-name-container">
                <img src="<?php echo NORTH_COMMERCE_PLUGIN_DIR_URL . '/admin/images/location.svg' ?>" alt="">
                <p class="customer-name-text billing-address-name"><?php echo $default_billing_address['first_name'] . ' ' . $default_billing_address['last_name']; ?></p>
            </div>
            <p class="customer-address-text billing-address-address"><?php echo $default_billing_address['addressline1'] . ' ' . $default_billing_address['addressline2']; ?></p>
            <p class="customer-address-text billing-address-city-state-zipcode"><?php echo $default_billing_address['city'] . ', ' . $default_billing_address['state'] . ' ' . $default_billing_address['zipcode']; ?></p>
            <p class="customer-address-text billing-address-country"><?php echo $default_billing_address['country']['name']; ?></p>
            <?php
        } elseif ($has_default_shipping) { ?>
            <p>Same as shipping address</p>
      <?php  }
    }
    ?>
</div>
<?php

$this->template( 'edit-address-info', $template_dir, [
    'current_address' => $default_shipping_address ?? null,
    'type' => 'customer-billing',
    'title' => 'Billing'
] );
