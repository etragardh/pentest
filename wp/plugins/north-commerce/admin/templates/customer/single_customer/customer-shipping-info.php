<?php

/**
 * Customer Shipping Address section.
 *
 *
 * @package north-commerce/admin/templates/customer
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.23
 */

$template_dir = 'customer/single_customer';

?>
<div class="wrapper-box contact-box hover-box">
    <div class="shipping-address-title-container card__action">
        <h4>
            <?php esc_html_e( 'Shipping Address', 'north-commerce' ); ?>
        </h4>
        <a data-form-type="customer-shipping" class="btn-edit" href="#">
            <img src="<?php echo NORTH_COMMERCE_PLUGIN_DIR_URL . '/admin/images/order-edit.svg' ?>">
        </a>
    </div>
    <?php
    $has_default_shipping = false;
    $has_default_billing = false;
    $default_shipping_address = null;
    $default_billing_address = null;

    // Identify default shipping and billing addresses
    foreach ($single_customer['addresses'] as $address) {
        if ($address['is_default_shipping'] == '1') {
            $has_default_shipping = true;
            $default_shipping_address = $address;
        }
        if ($address['is_default_billing'] == '1') {
            $has_default_billing = true;
            $default_billing_address = $address;
        }
    }

    // Decision logic for rendering addresses
    if ($has_default_shipping || $has_default_billing) {
        if ($has_default_shipping) {
            // Show default billing address
            ?>
            <div class="customer-shipping-address-name-container">
                <img src="<?php echo NORTH_COMMERCE_PLUGIN_DIR_URL . '/admin/images/location.svg' ?>" alt="">
                <p class="customer-name-text billing-address-name"><?php echo $default_shipping_address['first_name'] . ' ' . $default_shipping_address['last_name']; ?></p>
            </div>
            <p class="customer-address-text billing-address-address"><?php echo $default_shipping_address['addressline1'] . ' ' . $default_shipping_address['addressline2']; ?></p>
            <p class="customer-address-text billing-address-city-state-zipcode"><?php echo $default_shipping_address['city'] . ', ' . $default_shipping_address['state'] . ' ' . $default_shipping_address['zipcode']; ?></p>
            <p class="customer-address-text billing-address-country"><?php echo $default_shipping_address['country']['name']; ?></p>
            <?php
        }
    }
    ?>
</div>
<?php

$this->template( 'edit-address-info', $template_dir, [
    'current_address' => $default_shipping_address ?? null,
    'type' => 'customer-shipping',
    'title' => 'Shipping'
] );
