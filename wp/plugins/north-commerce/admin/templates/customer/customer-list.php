<?php
/**
 * Customers list template.
 *
 * @package north-commerce/admin/templates/customer
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.24
 */


$current_page = sanitize_text_field( $_POST['paged'] ?? 1 );
$customers_per_page = sanitize_text_field( $_POST['customers_per_page'] ?? 10 );
$customer_model = new \NorthCommerce\Models\CustomerModel();

$options = [
	'order_by' => 'created DESC',
	'limit' => $customers_per_page,
	'offset' => $customers_per_page * ($current_page - 1),
];
$customers = $customer_model->list_all( true, $options);

$customers_total = $customer_model->count();
$pagination = $customers_total
    ? ( $options['offset'] + 1 ) . '-' .  $options['limit']  . ' of ' . $customers_total
    : esc_html__( '0-0 of 0', 'north-commerce' );
?>
<div class="north-tab-wrapper">
	<?php $this->plugin_tabs(); ?>
</div>
<?php

do_action( 'north_commerce_notices' );

?>
<div id="wpmdb-main">
    <div class="content-tab">
        <div class="settings-tab__head">
            <div class="head__wrapper">
                <h2>
                    <?php esc_html_e( 'Customers', 'north-commerce' ); ?>
                </h2>
                <p>
                    <?php esc_html_e( 'You can manage and customize your customers.', 'north-commerce' ); ?>
                </p>
            </div>
            <a
                href="<?php echo admin_url( 'admin.php?page=north-commerce-customers&amp;action=add' ); ?>"
                class="btn submit-btn activate customer-add"
                data-nc-custom-popup="#customer-create-modal"
            >
                <?php esc_html_e( 'Add customer', 'north-commerce' ); ?>
            </a>
        </div>
        <div class="settings-tab__body customers">
			<div class="customers__status">
				<a href="javascript:void(0);" class="status__filter status__filter-customer active" data-status-filter="any">
					<?php esc_html_e( 'All', 'north-commerce' ); ?>
					<span>
                        <?php echo '(' . count( $customers ) . ')'; ?>
					</span>
				</a>
				<a href="javascript:void(0);" class="status__filter status__filter-customer" data-status-filter="new">
                    <?php esc_html_e( 'New', 'north-commerce' ); ?>
					<span>(0)</span>
				</a>
				<a href="javascript:void(0);" class="status__filter status__filter-customer" data-status-filter="returning">
                    <?php esc_html_e( 'Returning', 'north-commerce' ); ?>
					<span>(0)</span>
				</a>
				<a href="javascript:void(0);" class="status__filter status__filter-customer" data-status-filter="abandoned-checkout">
					<?php esc_html_e( 'Abandoned checkouts', 'north-commerce' ); ?>
					<span>(0)</span>
				</a>
				<a href="javascript:void(0);" class="status__filter status__filter-customer" data-status-filter="member">
					<?php esc_html_e( 'Members', 'north-commerce' ); ?>
					<span>(0)</span>
				</a>
				<a href="javascript:void(0);" class="status__filter status__filter-customer" data-status-filter="subscription">
					<?php esc_html_e( 'Subscriptions', 'north-commerce' ); ?>
					<span>(0)</span>
				</a>
				<a href="javascript:void(0);" class="status__filter status__filter-customer" data-status-filter="email-subscriber">
					<?php esc_html_e( 'Email Subscribers', 'north-commerce' ); ?>
					<span>(0)</span>
				</a>
			</div>

            <div class="board customers__board">
                <div class="board__header">
                    <form class="board__form board__form-customers">
                        <a href="javascript:void(0);" class="filters__toggle">
                            <span>Show filters</span>
                        </a>
                        <div class="filters__body">
                            <div class="filter__item">
                                <label for="customer-data-sort">Sort by</label>
                                <select
                                    name="customer-data-sort"
                                    class="north-single-select select2-hidden-accessible"
                                    data-dropdown-css-class="rounded"
                                    data-minimum-results-for-search="Infinity"
                                    id="customer-data-sort"
                                >
                                    <option value="DESC" checked>Newest to oldest</option>
                                    <option value="ASC">Oldest to newest</option>
                                </select>
                            </div>
                            <div class="filter__item">
                                <label for="customer-total-spent-sort">Total Spent</label>
                                <select
                                    name="customer-total-spent-sort"
                                    class="north-single-select select2-hidden-accessible"
                                    data-dropdown-css-class="rounded"
                                    data-minimum-results-for-search="Infinity"
                                    id="customer-total-spent-sort"
                                >
                                    <option value="">None</option>
                                    <option value="DESC">Most amount spent</option>
                                    <option value="ASC">Least amount spent</option>
                                    <option value="new">Most recent purchase</option>
                                </select>
                            </div>
                            <div class="filter__item">
                                <button type="button" class="more-filter-toggle">
                                    More filters
                                </button>
                            </div>
                        </div>
                        <div class="search-wrapper">
                            <input type="submit" value="">
                            <input
                                name="customer-search"
                                type="text"
                                placeholder="Search by customer name, email, id or phone number"
                            >
                        </div>

                        <div class="filters-drawer">
                            <div class="filters-drawer__header">
                                <p class="filters-drawer__header__title">
                                    More filters
                                </p>
                                <button type="button" class="filters-drawer__header__toggle">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill="#00073F" d="M16.192 6.34399L11.949 10.586L7.70697 6.34399L6.29297 7.75799L10.535 12L6.29297 16.242L7.70697 17.656L11.949 13.414L16.192 17.656L17.606 16.242L13.364 12L17.606 7.75799L16.192 6.34399Z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="filters-drawer__body">
                                <div class="drawer-filter-item">
                                    <div class="drawer-filter-item__header">
                                        <label for="customer-purchased-products-filter">
                                            Product Purchased
                                        </label>
                                        <div role="button" class="drawer-filter-item__toggle">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M11.9998 15.7131L18.0098 9.70209L16.5958 8.28809L11.9958 12.8881L7.40277 8.28809L5.98878 9.70209L11.9998 15.7131Z" fill="black"/>
                                            </svg>
                                        </div>
                                    </div>

                                    <div class="drawer-filter-item__input">
                                        <select
                                            name="customer-purchased-products-filter"
                                            data-placeholder="Select product"
                                            data-allow_clear="true"
                                            class="north-filter-wrapper-multiple-select"
                                            data-dropdown-css-class="rounded"
                                            data-multipe="true"
                                            data-minimum-results-for-search="Infinity"
                                            id="customer-purchased-products-filter"
                                        >
                                        </select>
                                    </div>

                                </div>

                                <div class="drawer-filter-item">
                                    <div class="drawer-filter-item__header">
                                        <label for="customer-country-filter">
                                            Country
                                        </label>
                                        <div role="button" class="drawer-filter-item__toggle">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M11.9998 15.7131L18.0098 9.70209L16.5958 8.28809L11.9958 12.8881L7.40277 8.28809L5.98878 9.70209L11.9998 15.7131Z" fill="black"/>
                                            </svg>
                                        </div>
                                    </div>

                                    <div class="drawer-filter-item__input">
                                        <select
                                            name="customer-country-filter"
                                            class="north-filter-wrapper-single-select "
                                            data-placeholder="Select country"
                                            data-allow_clear="true"
                                            data-dropdown-css-class="rounded"
                                            data-multipe="true"
                                            data-minimum-results-for-search="Infinity"
                                            id="customer-country-filter"
                                        >
                                            <option value="">None</option>
                                            <option value="DESC">Most amount spent</option>
                                            <option value="ASC">Least amount spent</option>
                                            <option value="new">Most recent purchase</option>
                                        </select>
                                    </div>

                                </div>

                                <div class="drawer-filter-item">
                                    <div class="drawer-filter-item__header">
                                        <label for="customer-city-filter">
                                            City
                                        </label>
                                        <div role="button" class="drawer-filter-item__toggle">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M11.9998 15.7131L18.0098 9.70209L16.5958 8.28809L11.9958 12.8881L7.40277 8.28809L5.98878 9.70209L11.9998 15.7131Z" fill="black"/>
                                            </svg>
                                        </div>
                                    </div>

                                    <div class="drawer-filter-item__input">
                                        <select
                                            name="customer-city-filter"
                                            class="north-filter-wrapper-single-select "
                                            data-placeholder="Select city"
                                            data-allow_clear="true"
                                            data-dropdown-css-class="rounded"
                                            data-multipe="true"
                                            data-minimum-results-for-search="Infinity"
                                            id="customer-city-filter"
                                        >
                                            <option value="">None</option>
                                            <option value="DESC">Most amount spent</option>
                                            <option value="ASC">Least amount spent</option>
                                            <option value="new">Most recent purchase</option>
                                        </select>
                                    </div>

                                </div>

                                <div class="drawer-filter-item">
                                    <div class="drawer-filter-item__header">
                                        <label for="customer-state-filter">
                                            State
                                        </label>
                                        <div role="button" class="drawer-filter-item__toggle">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M11.9998 15.7131L18.0098 9.70209L16.5958 8.28809L11.9958 12.8881L7.40277 8.28809L5.98878 9.70209L11.9998 15.7131Z" fill="black"/>
                                            </svg>
                                        </div>
                                    </div>

                                    <div class="drawer-filter-item__input">
                                        <select
                                            name="customer-state-filter"
                                            class="north-filter-wrapper-single-select"
                                            data-placeholder="Select state"
                                            data-allow_clear="true"
                                            data-dropdown-css-class="rounded"
                                            data-multipe="true"
                                            data-minimum-results-for-search="Infinity"
                                            id="customer-state-filter"
                                        >
                                            <option value="">None</option>
                                            <option value="DESC">Most amount spent</option>
                                            <option value="ASC" >Least amount spent</option>
                                            <option value="new" >Most recent purchase</option>
                                        </select>
                                    </div>

                                </div>

                                <div class="drawer-filter-item">
                                    <div class="drawer-filter-item__header">
                                        <label for="customer-tagged-with-filter">
                                            Customers tagged with
                                        </label>
                                        <div role="button" class="drawer-filter-item__toggle">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M11.9998 15.7131L18.0098 9.70209L16.5958 8.28809L11.9958 12.8881L7.40277 8.28809L5.98878 9.70209L11.9998 15.7131Z" fill="black"/>
                                            </svg>
                                        </div>
                                    </div>

                                    <div class="drawer-filter-item__input">
                                        <select
                                            name="customer-tagged-with-filter"
                                            class="north-filter-wrapper-multiple-select "
                                            data-placeholder="Select customer tags"
                                            data-allow_clear="true"
                                            multiple
                                            data-dropdown-css-class="rounded"
                                            data-multipe="true"
                                            data-minimum-results-for-search="Infinity"
                                            id="customer-tagged-with-filter"
                                        >
                                        </select>
                                    </div>

                                </div>

                            </div>

                        </div>
                    </form>
                    <div class="board__actions">
                        <div class="action__result">
                            <span><?php echo $pagination ?? ''; ?></span>
                        </div>
                        <div class="action__buttons">
                            <a class="btn btn-prev customer-prev" href="javascript:void(0);"></a>
                            <a class="btn btn-next customer-next" href="javascript:void(0);"></a>
                        </div>
                    </div>
                </div>
                <div class="board__result">
                    <div class="result__labels">
                        <div class="result-col-1">
                            <div class="result__select">
                                <label for="all"></label>
                                <input type="checkbox" name="all-customer" id="all-customer"/>
                            </div>
                            <div class="bump">
                                <div class="bump__count-selecting">
                                    <p><span>1 </span>selected</p>
                                </div>
                                <div class="bump__action">
                                    <a href="#" class="action__trash customer-bump-trash">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <path fill="#747E94" d="M6 7C5.447 7 5 7 5 7V20C5 21.104 5.896 22 7 22H17C18.104 22 19 21.104 19 20V7C19 7 18.553 7 18 7H6ZM10 19H8V10H10V19ZM16 19H14V10H16V19ZM16.618 4L15 2H9L7.382 4H3V6H8H16H21V4H16.618Z"></path>
                                        </svg>
                                        <div class="action__hint"><p>Move to Trash</p></div>
                                    </a>
                                    <a href="#" class="action__archive customer-bump-archive">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path fill="#747E94" d="M18.0865 4.40817L15.589 1.91067C15.5118 1.83314 15.4199 1.77165 15.3188 1.72974C15.2177 1.68784 15.1093 1.66635 14.9998 1.6665H4.99984C4.89039 1.66635 4.78198 1.68784 4.68087 1.72974C4.57975 1.77165 4.48793 1.83314 4.41067 1.91067L1.91317 4.40817C1.83491 4.48536 1.77279 4.57735 1.73045 4.67879C1.6881 4.78023 1.66636 4.88908 1.6665 4.999V15.8332C1.6665 16.2752 1.8421 16.6991 2.15466 17.0117C2.46722 17.3242 2.89114 17.4998 3.33317 17.4998H16.6665C17.1085 17.4998 17.5325 17.3242 17.845 17.0117C18.1576 16.6991 18.3332 16.2752 18.3332 15.8332V4.999C18.3333 4.88908 18.3116 4.78023 18.2692 4.67879C18.2269 4.57735 18.1648 4.48536 18.0865 4.40817ZM5.34484 3.33317H14.6548L15.4882 4.1665H4.51151L5.34484 3.33317ZM14.1665 10.8332V11.6665H5.83317V8.33317H7.49984V9.99984H12.4998V8.33317H14.1665V10.8332Z"/>
                                        </svg>
                                        <div class="action__hint"><p>Archive</p></div>
                                    </a>
                                    <a href="#" class="action__publish customer-bump-publish">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path fill="#747E94" d="M18.0884 4.40984L15.5893 1.91067C15.512 1.83314 15.4202 1.77165 15.3191 1.72974C15.2179 1.68784 15.1095 1.66635 15.0001 1.6665H5.00008C4.89063 1.66635 4.78223 1.68784 4.68111 1.72974C4.58 1.77165 4.48817 1.83314 4.41092 1.91067L1.91175 4.40984C1.83389 4.48707 1.77214 4.57899 1.73008 4.68027C1.68803 4.78155 1.6665 4.89017 1.66675 4.99984V15.8332C1.66675 16.7523 2.41425 17.4998 3.33342 17.4998H16.6667C17.5859 17.4998 18.3334 16.7523 18.3334 15.8332V4.99984C18.3337 4.89017 18.3121 4.78155 18.2701 4.68027C18.228 4.57899 18.1663 4.48707 18.0884 4.40984ZM5.34508 3.33317H14.6551L15.4884 4.1665H4.51175L5.34508 3.33317ZM11.6668 11.6665V14.1665H8.33342V11.6665H5.83342L10.0001 7.49984L14.1668 11.6665H11.6668Z"/>
                                        </svg>
                                        <div class="action__hint"><p>Publish</p></div>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="result-col-5">Name</div>
                        <div class="result-col-2">Total Orders</div>
                        <div class="result-col-2">Total Spent</div>
                        <div class="result-col-2">Type of user</div>
                    </div>
                    <div
                        class="result__customers"
                        data-current-page="<?php echo esc_attr( $current_page ?? '' ); ?>"
                        data-max-page="<?php echo esc_attr( $customers_total ?? '' ); ?>"
                    >
                        <?php
						foreach ( $customers as $i => $customer ) {
							$this->template( 'customer-item', 'customer', [
								'customer' => $customer,
								'index' => $i
							] );
						}
						?>
                    </div>
                    <div class="board__overlay">
                        <div class="loader-spinner"></div>
                    </div>
                </div>
                <div class="board__footer">
                    <div class="board__actions">
                        <div class="action__result">
                            <span><?php echo $pagination ?? ''; ?></span>
                        </div>
                        <div class="action__buttons">
                            <a class="btn btn-prev customer-prev" href="javascript:void(0);"></a>
                            <a class="btn btn-next customer-next" href="javascript:void(0);"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<?php
// Popup Form
$this->template( 'popup-customer-create-template', 'customer' );
