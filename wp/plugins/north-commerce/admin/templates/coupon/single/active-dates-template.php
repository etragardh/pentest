<?php

defined( 'ABSPATH' ) || exit;

use North_Commerce_Settings as Settings;
use North_Commerce_Coupon as Coupon;

/**
 * Active Dates section
 *
 *
 * @package north-commerce/admin/templates/coupon/single
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.21
 * @version 0.1.24
 */


$coupon_date_start = Coupon::convert_sql_timestamp_into_date( $sql_time_start );
$coupon_time_start = Coupon::convert_sql_timestamp_into_time( $sql_time_start );

$coupon_date_end = Coupon::convert_sql_timestamp_into_date( $sql_time_end );
$coupon_time_end = Coupon::convert_sql_timestamp_into_time( $sql_time_end );

?>
<h3>
    <?php esc_html_e( 'Active Dates', 'north-commerce' ); ?>
</h3>

<div id="date_picker_start" class="date_picker date_start">
    <div class="picker__item date">
        <label for="coupon_date_start">
            <?php esc_html_e( 'Start Date', 'north-commerce' ); ?>
        </label>
        <div class="date__wrapper">
            <input
                type="text"
                id="coupon_date_start"
                name="coupon_date_start"
                data-time-zone="<?php echo Settings::get_current_time_zone(); ?>"
                value="<?php echo esc_attr( $coupon_date_start ); ?>"
            >
        </div>
    </div>
    <div class="picker__item time">
        <label for="publishing_time">
            <?php esc_html_e( 'Start Time', 'north-commerce' ); ?>
        </label>
        <input
            type="text"
            id="coupon_time_start"
            name="coupon_time_start"
            class="coupon_time"
            value="<?php echo esc_attr( $coupon_time_start ); ?>"
        >
        <select
            class="north-single-select coupon-select-time-start"
            data-minimum-results-for-search="Infinity"
        >
            <?php

            $time_select_options = '<option value="12:00 am" selected="selected">12:00 am' . esc_html__( ' (start of day)', 'north-commerce' ) . '</option>';
            $time_select_options .= '<option value="12:30 am">12:30 am</option>';
            for ( $i = 1; $i < 12; $i++ ) {
                $hour = str_pad( $i, 2, '0', STR_PAD_LEFT );
                $period = $period ?? 'am';

                $time_select_options .= '<option value="' . esc_attr( $hour . ':00 ' . $period ) . '">' . esc_html( $hour . ':00 ' . $period ) . '</option>';
                $time_select_options .= '<option value="' . esc_attr( $hour . ':30 ' . $period ) . '">' . esc_html( $hour . ':30 ' . $period ) . '</option>';

                if ( 11 === $i && 'am' === $period ) {
                    $period = 'pm';

                    $time_select_options .= '<option value="' . esc_attr( '12:00 ' . $period ) . '">' . esc_html( '12:00 ' . $period ) . '</option>';
                    $time_select_options .= '<option value="' . esc_attr( '12:30 ' . $period ) . '">' . esc_html( '12:30 ' . $period ) . '</option>';

                    $i = 0;
                }
            }

            echo $time_select_options;

            ?>
        </select>
    </div>
</div>

<div class="toggle-line end-date-toggle">
    <div class="toggle-line__toggle">
        <div class="switch">
            <input
                type="checkbox"
                name="coupon_date_end_toggle"
                id="coupon_date_end_toggle"
                <?php checked( (bool) $sql_time_end ); ?>
            >
            <label class="switch-service-label" for="coupon_date_end_toggle">
                <span class="switch-dot"></span>
            </label>
        </div>
    </div>
    <label for="coupon_date_end_toggle" class="toggle-line__name">
        <?php esc_html_e( 'Set end date', 'north-commerce' ); ?>
    </label>
</div>
<?php

$class_active = (bool) $sql_time_end ? ' active' : '';

?>
<div class="optional-container end-date<?php echo esc_attr( $class_active ); ?>">
    <div id="date_picker_end" class="date_picker date_end">
        <div class="picker__item date">
            <label for="coupon_date_end">
                <?php esc_html_e( 'End Date', 'north-commerce' ); ?>
            </label>
            <div class="date__wrapper">
                <input
                    type="text"
                    id="coupon_date_end"
                    name="coupon_date_end"
                    data-time-zone="<?php echo Settings::get_current_time_zone(); ?>"
                    value="<?php echo esc_attr( $coupon_date_end ); ?>"
                >
            </div>
        </div>

        <div class="picker__item time">
            <label for="coupon_time_end">
                <?php esc_html_e( 'End Time', 'north-commerce' ); ?>
            </label>
            <input
                type="text"
                id="coupon_time_end"
                name="coupon_time_end"
                class="coupon_time"
                value="<?php echo esc_attr( $coupon_time_end ); ?>"
            >
            <select
                class="north-single-select coupon-select-time-end"
                data-minimum-results-for-search="Infinity"
            >
                <?php
                echo $time_select_options;
                ?>
            </select>
        </div>
    </div>
</div>
