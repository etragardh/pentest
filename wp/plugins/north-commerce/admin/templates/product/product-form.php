<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Db\Collections\ProductTypes;
use NorthCommerce\Models\{
	ProductModel,
	CountryModel
};
use North_Commerce_Settings as Settings;

/**
 * Product form template.
 *
 * @package north-commerce/admin/templates/product
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.25
 */


$product_model = new ProductModel();
$country_model = new CountryModel();

if ( isset( $_GET['action'], $_GET['id'] ) ) {
	$product_id = sanitize_text_field( $_GET['id'] ); // phpcs:ignore WordPress.Security.NonceVerification.Recommended
	$product_obj = new North_Commerce_Product( $product_id );
    $product = $product_model->get_by_id( $product_id );
}

$currency_symbol = Settings::get_currency_symbol();
$permalink_base = North_Commerce_Product::get_permalink_base();

$product_type = $product['product_type'] ?? (array) ProductTypes::oneTime();
$product_custom_info = $product['customs_detail'] ?? null;

$product_id = $product['id'] ?? null;
$adjacent_products = $product_model->get_adjacent_products_id( $product_id );
$product_option_types = $product_model->list_option_types();

$product_images = $product['product_images'] ?? [];

$product_status_slug = $product['product_status']['slug'] ?? '';
$is_product_draft = 'draft' === $product_status_slug;
$is_product_scheduled = 'schedule' === $product_status_slug;
$is_product_archived = 'archive' === $product_status_slug;

if ( isset( $product['id'] ) ) {
    $publishing_timestamp = $is_product_scheduled ? $product['scheduled'] : $product['published'];
}
$product_published = date_create( $publishing_timestamp ?? null );
$publishing_date = date_format( $product_published, 'F d, Y' ) ?: '';
$publishing_time = date_format( $product_published, 'h:i a' ) ?: '';

$is_physical = boolval( $product['is_physical_product'] ?? null );
$has_product_variants = boolval( $product['has_product_variants'] ?? null );

$payment_detail = $product['payment_detail'] ?? null;
$has_free_trial = boolval( $payment_detail['has_free_trial'] ?? null );
$has_first_payment = boolval( $payment_detail['has_first_payment'] ?? null );


?>
<div class="single-product">

	<div class="product__header">

		<div class="header__wrapper">
			<a href="<?php echo admin_url( 'admin.php?page=north-commerce-products' ); ?>" class="btn btn-back"></a>
			<h2>
				<?php echo $product['name'] ?? esc_html__( 'Add product', 'north-commerce' ); ?>
			</h2>
		</div>
		<?php

        if ( $product_id ) {
            ?>
			<div class="header__nav">
				<a
					class="btn btn-preview"
					href="<?php echo $permalink_base . $product['slug']; ?>"
					title="<?php esc_attr_e( 'Preview', 'north-commerce' ); ?>"
					target="_blank"
				>
					<svg width="24" height="24" viewBox="0 0 24 24">
						<path fill="#00073F" d="M11.9993 5C4.36631 5 2.07231 11.617 2.05131 11.684L1.94531 12L2.05031 12.316C2.07231 12.383 4.36631 19 11.9993 19C19.6323 19 21.9263 12.383 21.9473 12.316L22.0533 12L21.9483 11.684C21.9263 11.617 19.6323 5 11.9993 5ZM11.9993 16C9.79331 16 7.99931 14.206 7.99931 12C7.99931 9.794 9.79331 8 11.9993 8C14.2053 8 15.9993 9.794 15.9993 12C15.9993 14.206 14.2053 16 11.9993 16Z"/>
						<path fill="#00073F" d="M12 10C10.916 10 10 10.916 10 12C10 13.084 10.916 14 12 14C13.084 14 14 13.084 14 12C14 10.916 13.084 10 12 10Z"/>
					</svg>
				</a>
				<a
					class="btn product-duplicate"
					title="<?php esc_attr_e( 'Duplicate', 'north-commerce' ); ?>"
					href="javascript:void(0);"
					data-product-id="<?php echo esc_attr( $product_id ); ?>"
				>
					<svg width="24" height="24" viewBox="0 0 24 24">
						<path fill="#222222" d="M4 22H16C17.103 22 18 21.103 18 20V8C18 6.897 17.103 6 16 6H4C2.897 6 2 6.897 2 8V20C2 21.103 2.897 22 4 22ZM4 8H16L16.002 20H4V8Z"/>
						<path fill="#222222" d="M20 2H8V4H20V16H22V4C22 2.897 21.103 2 20 2Z"/>
					</svg>
				</a>
				<a
					class="btn btn-prev product-single-prev<?php echo ! $adjacent_products['prev_id'] ? ' disabled' : ''; ?>"
					href="<?php echo admin_url( 'admin.php?page=north-commerce-products&action=edit&id=' . $adjacent_products['prev_id'] ); ?>"
					title="<?php esc_attr_e( 'Previous product', 'north-commerce' ); ?>"
				>
				</a>
				<a
					class="btn btn-next product-single-next<?php echo ! $adjacent_products['next_id'] ? ' disabled' : ''; ?>"
					href="<?php echo admin_url( 'admin.php?page=north-commerce-products&action=edit&id=' . $adjacent_products['next_id'] ); ?>"
					title="<?php esc_attr_e( 'Next product', 'north-commerce' ); ?>"
				>
				</a>
			</div>
			<?php
        }

		?>
    </div>
	<?php

	if ( $product_id ) {
		?>
		<form class="product__permalink">
			<div class="product__permalink__left">
				<div class="product__permalink__input-wrapper">
					<a
						class="permalink__base"
						href="<?php echo $permalink_base . $product['slug']; ?>"
						target="_blank"
						title="<?php esc_attr_e( 'Product Single page', 'north-commerce' );; ?>"
					>
						<?php echo $permalink_base; ?>
					</a>
					<input
						id="permalink_slug"
						type="text"
						name="product_slug"
						value="<?php echo esc_attr( $product['slug'] ); ?>"
					>
				</div>
				<?php wp_nonce_field( 'permalink', 'permalink_nonce' ); ?>
				<input type="hidden" name="product_id" value="<?php echo esc_attr( $product_id ); ?>">
				<input
					type="submit"
					class="product__permalink__save"
					value="<?php esc_attr_e( 'Update permalink', 'north-commerce' ); ?>"
					disabled
				>
			</div>
			<div class="product__permalink__right"></div>
		</form>
		<?php
	}

    ?>
    <div class="product__content content" data-product-type="<?php echo esc_attr( $product_type['slug'] ); ?>">

        <form id="product-form" class="content__form form" method="POST" enctype="multipart/form-data">
			<?php
            wp_nonce_field( 'product', 'product_nonce' );

            if ( $product_id ) {
				?>
                <input type="hidden" name="product_id" value="<?php echo esc_attr( $product_id ); ?>">
				<?php
            }

            ?>
            <div class="form-wrapper">
                <div id="product-type" class="settings-card form__product-type">

                    <h3>
                        <?php esc_html_e( 'Product type', 'north-commerce' ); ?>
                    </h3>

                    <p>
                        <?php
						printf(
							'%s <span>%s</span>.',
							__( 'The product available as', 'north-commerce' ),
							esc_html( $product_type['name'] )
						);
						?>
                    </p>
					<?php

                    foreach ( $product_model->list_types() as $type ) {
                        $type_name = $type['name'] ?? '';
                        $type_slug = $type['slug'] ?? '';

                        echo '<label class="radio-container">',
                            esc_html( $type_name ),
                            '<input',
                                ' type="radio"',
                                ' name="product_type"',
                                ' id="' . esc_attr( str_replace( '-', '_', $type_slug ) ) . '_type"',
                                ' data-product-type-label="' . esc_attr( $type_slug ) . ' product"',
                                ' data-product-type="' . esc_attr( $type_slug ) . '"',
                                ' value="' . esc_attr( $type_slug ) . '"',
                                checked( $type_slug, $product_type['slug'], false ),
							'>',
                            '<span class="checkmark"></span>',
                        '</label>';
                    }

					?>
                </div>

                <div id="product-general" class="settings-card form__product-general">

                    <h3>
                        <?php esc_html_e( 'General information', 'north-commerce' ); ?>
                    </h3>

                    <label for="product_name">
                        <?php esc_html_e( 'Title', 'north-commerce' ); ?>
                    </label>

                    <input
                        type="text"
                        name="product_name"
                        value="<?php echo esc_attr( $product['name'] ?? '' ); ?>"
					>

                    <label for="product_content">
                        <?php esc_html_e( 'Description', 'north-commerce' ); ?>
                    </label>
					<?php

					$mce_teeny = [
						'bold',
						'italic',
						'underline',
						'|',
						'alignleft',
						'aligncenter',
						'alignright',
						'alignjustify',
						'|',
						'bullist',
						'numlist',
						'outdent',
						'indent',
						'link'
					];
					wp_editor( $product['description'] ?? '', 'product_content', [
						'wpautop'          => 1,
						'media_buttons'    => 0,
						'textarea_name'    => 'product_content',
						'dfw'              => 0,
						'textarea_rows'    => 10,
						'teeny'            => 1,
						'statusbar'        => 0,
						'tinymce'          => [
							'toolbar1' => implode( ',', $mce_teeny ),
						],
						'quicktags'        => 0,
						'drag_drop_upload' => false,
					] );
					?>
                </div>

                <div id="product-images" class="settings-card form__product-media">

                    <h3>
                        <?php esc_html_e( 'Product images', 'north-commerce' ); ?>
                    </h3>

                    <p>
                        <?php esc_html_e( 'The first image will be set as a cover image for this product.', 'north-commerce' ); ?>
                    </p>

                    <div class="media__images images<?php echo $product_images ? ' images-contains' : ''; ?>">

                        <div class="images__empty">
                            <a class="product-load-img load-media" href="javascript:void(0);">
                                <img
                                    src="<?php echo esc_url( NORTH_COMMERCE_PLUGIN_DIR_URL . 'admin/images/load-product-img.png' ); ?>"
                                    alt=""
                                    >
                                <h3>
									<?php
									printf(
										'%s <span>%s</span>',
										__( 'Upload your product images - ', 'north-commerce' ),
										__( 'browse', 'north-commerce' )
									);
									?>
                                </h3>
                                <p>
                                    <?php esc_html_e( 'Supports: JPG, JPEG, PNG, GIF, WEBP', 'north-commerce' ); ?>
								</p>
                            </a>
                        </div>

                        <ul class="images__items">
							<?php

                            foreach ( $product_images as $attachment ) {
								?>
                                <li class="image image-product active">
                                    <input class="image-rotate" type="hidden" value="0">
                                    <input class="image-id" type="hidden" value="">
                                    <input class="image-url" type="hidden" value="<?php echo esc_attr( $attachment['image_url'] ); ?>">
                                    <div class="image__wrapper">
                                        <div class="image__content">
                                            <img src="<?php echo esc_url( $attachment['image_url'] ); ?>" alt="">
                                            <div class="image__overlay">
                                                <a href="javascript:void(0);" class="image__rotate" title="<?php esc_attr_e( 'Rotate', 'north-commerce' ); ?>"></a>
                                                <a href="javascript:void(0);" class="image__remove" title="<?php esc_attr_e( 'Remove', 'north-commerce' ); ?>"></a>
                                            </div>
                                        </div>
                                    </div>
                                </li>
								<?php
                            }

							?>
                            <li class="image image-product template">
                                <input class="image-rotate" type="hidden" value="0">
                                <input class="image-id" type="hidden" value="">
                                <input class="image-url" type="hidden" value="">
                                <div class="image__wrapper">
                                    <div class="image__content">
                                        <img src="" alt="">
                                        <div class="image__overlay">
                                            <a href="javascript:void(0);" class="image__rotate" title="<?php esc_attr_e( 'Rotate', 'north-commerce' ); ?>"></a>
                                            <a href="javascript:void(0);" class="image__remove" title="<?php esc_attr_e( 'Remove', 'north-commerce' ); ?>"></a>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="image image-add">
                                <div class="image__wrapper">
                                    <div class="image__content">
                                        <a href="javascript:void(0);" class="image-add-btn load-media">
                                            <span class="plus"></span>
                                            <p>
												<?php esc_html_e( 'Add image', 'north-commerce' ); ?>
											</p>
                                        </a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>

                </div>

                <div id="product-inventory" class="settings-card form__product-inventory">
                    <h3>
						<?php esc_html__( 'Inventory', 'north-commerce' ); ?>
                    </h3>

                    <div class="inventory">
                        <div class="inventory__item option-type option-type-one-time">
                            <label for="product_sku">
                                <?php esc_html_e( 'SKU (stock keeping unit)', 'north-commerce' ); ?>
                            </label>
                            <input
                                type="text"
                                name="product_sku"
                                value="<?php echo esc_attr( $product['sku'] ?? '' ); ?>"
							>
                        </div>

                        <div class="inventory__item">
                            <label for="product_quantity">
                                <?php esc_html_e( 'Quantity', 'north-commerce' ); ?>
                            </label>
                            <input
                                type="number"
                                name="product_quantity"
                                value="<?php echo esc_attr( $product['quantity'] ?? '' ); ?>"
                                placeholder="∞"
                                min="0"
							>
                        </div>

                    </div>
                </div>

                <div id="product-shipping" class="settings-card form__product-shipping option-type option-type-one-time">
                    <h3>
						<?php esc_html_e( 'Shipping', 'north-commerce' ); ?>
					</h3>
                    <div class="shipping optional">

                        <div class="optional__header<?php echo $is_physical ? ' active' : ''; ?>">

							<div class="header__title">
                                <h4>
                                    <?php esc_html_e( 'Physical product', 'north-commerce' ); ?>
                                </h4>
                                <p>
									<?php esc_html_e( 'Used to calculate shipping rates at checkout and label prices during fulfillment.', 'north-commerce' ); ?>
                                </p>
                            </div>

                            <div class="switch">
                                <input
                                    type="checkbox"
                                    name="is_physical"
                                    id="is_physical"
                                    <?php checked( $is_physical ); ?>
								>
                                <label class="switch-service-label" for="is_physical">
                                    <span class="switch-dot"></span>
                                </label>
                            </div>

                        </div>

                        <div class="optional__body">
                            <div class="optional-item">
                                <label for="shipping_weight">
                                    <?php esc_html_e( 'Weight', 'north-commerce' ); ?>
                                </label>
                                <div class="currency-wrapper">
									<?php $weight_unit = Settings::get_weight_unit(); ?>
                                    <span class="currency-symbol weight <?php echo esc_attr( strtolower( $weight_unit ) );?>">
                                        <?php echo esc_html( $weight_unit ); ?>
                                    </span>
                                    <input
                                        type="number"
                                        name="shipping_weight"
                                        placeholder="0.000"
                                        value="<?php echo isset( $product['weight'] ) ? floatval( $product['weight'] ) :  ''; ?>"
                                        min="0"
                                        step="0.001"
									>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

				<div id="product-pricing" class="settings-card form__product-pricing pricing">
					<h3>
						<?php esc_html_e( 'Pricing', 'north-commerce' ); ?>
					</h3>

					<p></p>

					<div class="pricing__general">

						<div class="general__item">
							<label for="product-price">
								<?php esc_html_e( 'Price', 'north-commerce' ); ?>
							</label>
							<div class="currency-wrapper">
								<span class="currency-symbol">
									<?php echo esc_html( $currency_symbol ); ?>
								</span>
								<input
									type="number"
									name="product_price"
									placeholder="0.00"
									min="0"
									step="0.01"
									value="<?php echo esc_attr( $product['base_price'] ?? '' ); ?>"
								>
							</div>
						</div>

						<div class="general__item">
							<label for="product-price-compare">
								<?php esc_html_e( 'Compare at price', 'north-commerce' ); ?>
							</label>
							<div class="currency-wrapper">
								<span class="currency-symbol">
									<?php echo esc_html( $currency_symbol ); ?>
								</span>
								<input
									type="number"
									name="product-price-compare"
									placeholder="0.00"
									min="0"
									step="0.01"
									value="<?php echo esc_attr( $product['compare_price'] ?? '' ); ?>"
								>
							</div>
						</div>

                        <div class="general__item option-type option-type-payment-plan">
                            <label for="product_payment_number">
                                <?php esc_html_e( 'Number of payments', 'north-commerce' ); ?>
                            </label>
                            <input
                                type="number"
                                name="product_payment_number"
                                min="0"
                                value="<?php echo esc_attr( $product['payment_detail']['num_payments'] ?? '' ); ?>"
							>
                        </div>

						<div class="general__item option-type option-type-payment-plan option-type-subscription">

							<label for="product_frequency">
								<?php esc_html_e( 'Payment frequency', 'north-commerce' ); ?>
							</label>
							<?php

							echo '<select',
								' id="product_frequency"',
								' name="product_frequency"',
								' class="north-single-select"',
								' data-minimum-results-for-search="Infinity"',
							'>';

								foreach ( $product_model->list_payment_frequencies() as $frequency ) {
									echo '<option',
										' value="' . esc_attr( $frequency['slug'] ) . '"',
										selected( $frequency['slug'], $product['payment_detail']['payment_frequency']['slug'] ?? '', false ),
										'>',
										esc_html( $frequency['name'] ),
									'</option>';
								}

							echo '</select>';

							?>
						</div>

						<div class="general__item">
							<label for="product-cost">
								<?php esc_html_e( 'Cost per item', 'north-commerce' ); ?>
							</label>
							<div class="currency-wrapper">
								<span class="currency-symbol">
									<?php echo esc_html( $currency_symbol ); ?>
								</span>
								<input
									type="number"
									name="product-cost"
									placeholder="0.00"
									min="0"
									step="0.01"
									value="<?php echo esc_attr( $product['cost_of_goods_price'] ?? '' ); ?>"
								>
							</div>
						</div>

						<div class="general__item cost-calculations">
							<div class="cost__margin">
								<label>
									<?php esc_html_e( 'Margin', 'north-commerce' ); ?>
								</label>
								<div class="value margin-value">
									<?php echo esc_html( $product['cost_margin'] ?? '-' ); ?>
								</div>
							</div>
							<div class="cost__profit">
								<label>
									<?php esc_html_e( 'Profit', 'north-commerce' ); ?>
								</label>
								<div class="value profit-value">
									<?php echo isset( $product['profit'] ) ? esc_html( $currency_symbol . $product['profit'] ) : '-'; ?>
								</div>
							</div>
						</div>

					</div>

					<div class="pricing-optional">

						<div class="optional option-type option-type-payment-plan">

							<div class="optional__header<?php echo $has_first_payment ? ' active' : ''; ?>">

								<div class="header__title">
									<h4>
										<?php esc_html_e( 'First payment (optional)', 'north-commerce' ); ?>
									</h4>
									<p>
										<?php esc_html_e( 'Set up a special price for the first usage period.', 'north-commerce' ); ?>
									</p>
								</div>

								<div class="switch">
									<input
										type="checkbox"
										name="is-first-payment"
										id="is-first-payment"
										<?php checked( $has_first_payment ); ?>
									>
									<label class="switch-service-label" for="is-first-payment">
										<span class="switch-dot"></span>
									</label>
								</div>

                            </div>

							<div class="optional__body">
								<div class="optional-item">
									<label for="product_start_price">
										<?php esc_html_e( 'First payment', 'north-commerce' ); ?>
									</label>
									<div class="currency-wrapper">
										<span class="currency-symbol">
											<?php echo esc_html( $currency_symbol ); ?>
										</span>
										<input
											type="number"
											name="product_start_price"
											placeholder="0.00"
											min="0"
											step="0.01"
											value="<?php echo $payment_detail['first_payment'] ?? ''; ?>"
										>
									</div>
								</div>
							</div>

						</div>

                        <div class="optional option-type option-type-subscription">

							<div class="optional__header<?php echo $has_free_trial ? ' active' : ''; ?>">

								<div class="header__title">
									<h4>
										<?php esc_html_e( 'Free trial (optional)', 'north-commerce' ); ?>
									</h4>
									<p>
										<?php esc_html_e( 'Set up a trial version.', 'north-commerce' ); ?>
									</p>
								</div>

								<div class="switch">
									<input
										type="checkbox"
										name="is-free-trial"
										id="is-free-trial"
										<?php checked( $has_free_trial ); ?>
									>
									<label class="switch-service-label" for="is-free-trial">
										<span class="switch-dot"></span>
									</label>
								</div>

							</div>

							<div class="optional__body">

								<div class="optional-item">
									<label for="product_trial_count">
										<?php esc_html_e( 'Frequency', 'north-commerce' ); ?>
									</label>
									<input
										type="number"
										name="product_trial_count"
										value="<?php echo esc_attr( $payment_detail['free_trial_frequency'] ?? '' ); ?>"
										min="0"
									>
								</div>

								<div class="optional-item">
									<label for="product_trial_type">Type</label>
									<select
										name="product_trial_type"
										class="north-single-select"
										data-minimum-results-for-search="Infinity"
									>
                                        <?php
                                        foreach ( $product_model->list_free_trial_types() as $type ) {
                                            echo '<option',
                                                ' value="' . esc_attr( $type['slug'] ) . '"',
                                                selected( $type['slug'], $payment_detail['free_trial_type']['slug'] ?? '', false ),
											'>',
                                                esc_html( $type['name'] ),
                                            '</option>';
                                        }
                                        ?>
                                    </select>
                                </div>

                            </div>
                        </div>
                        <div class="optional option-type option-type-subscription">
                            <?php

                            $has_first_period_payment = $payment_detail['has_first_period_payment'] ?? null;

							?>
                            <div class="optional__header<?php echo $has_first_period_payment ? ' active' : ''; ?>">

                                <div class="header__title">
                                    <h4>
                                        <?php esc_html_e( 'Price for first period (optional)', 'north-commerce' ); ?>
                                    </h4>
                                    <p>
                                        <?php esc_html_e( 'Set up varying price for the first period of use.', 'north-commerce' ); ?>
                                    </p>
                                </div>

                                <div class="switch">
                                    <input
                                        type="checkbox"
                                        name="is-first-period"
                                        id="is-first-period"
                                        <?php checked( (bool) $has_first_period_payment ); ?>
									>
                                    <label class="switch-service-label" for="subscription-price-first-period">
                                        <span class="switch-dot"></span>
                                    </label>
                                </div>

                            </div>

                            <div class="optional__body">
                                <div class="optional-item">
                                    <label for="subscription-price-first-period-value">
                                        <?php esc_html_e( 'Price for first period', 'north-commerce' ); ?>
                                    </label>
                                    <div class="currency-wrapper">
                                        <span class="currency-symbol">
                                            <?php echo esc_html( $currency_symbol ); ?>
                                        </span>
                                        <input
                                            type="number"
                                            name="product_start_price_sub"
                                            placeholder="0.00"
                                            value="<?php echo $payment_detail['first_period_payment'] ?? ''; ?>"
                                            min="0"
                                            step="0.01"
										>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="optional optional-bump">
                            <div class="optional__header <?php echo ( $is_bump ?? false ) ? 'active' : ''; ?>">
                                <div class="header__title">
                                    <h4>Bump pricing</h4>
                                    <p>Attach this product as an order bump.</p>
                                </div>
                                <div class="switch">
                                    <input
										type="checkbox"
										name="reload_bump"
                                        id="reload_bump"
										<?php echo ( $is_bump ?? false ) ? 'checked' : ''; ?>
									>
                                    <label class="switch-service-label" for="reload_bump">
                                        <span class="switch-dot"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="optional__body">
                                <div class="pricing__general">

									<div class="general__item">
										<label for="bump_price">
											<?php esc_html_e( 'Bump Price', 'north-commerce' ); ?>
										</label>
										<div class="currency-wrapper">
											<span class="currency-symbol">
												<?php echo Settings::get_currency_symbol(); ?>
											</span>
											<input
												type="number"
												name="bump_price"
												placeholder="0.00"
												min="0"
												step="0.01"
												value=""
											>
										</div>
									</div>

									<div class="general__item">
										<label for="bump_quantity">
											<?php esc_html_e( 'Quantity', 'north-commerce' ); ?>
										</label>
										<input
											type="number"
											name="bump_quantity"
											min="0"
											placeholder="∞"
											value=""
										>
									</div>

									<div class="general__item option-type option-type-subscription">',
										<label for="bump_trial_count">
											<?php esc_html_e( 'Free Trial', 'north-commerce' ); ?>
										</label>
										<input
											type="number"
											name="bump_trial_count"
											min="0"
											value=""
										>
									</div>
									<?php

                                    echo '<div class="general__item option-type option-type-subscription">',
                                        '<label for="bump_trial_type">',
                                            esc_html__( 'Type', 'north-commerce' ),
                                        '</label>',
                                        '<select name="bump_trial_type" class="north-single-select" data-minimum-results-for-search="Infinity">',
                                            '<option value="Days" ' . ( ( $bump_trial_type ?? null ) === 'Days' ? 'selected' : '' ) . '>',
                                                esc_html__( 'Days', 'north-commerce' ),
                                            '</option>',
                                            '<option value="Month" ' . ( ( $bump_trial_type ?? null ) === 'Month' ? 'selected' : '' ) . '>',
                                                esc_html__( 'Month', 'north-commerce' ),
                                            '</option>',
                                        '</select>',
                                    '</div>';

									?>
									<div class="general__item option-type option-type-payment-plan">
										<label for="bump_start_price">
											<?php esc_html_e( 'First payment', 'north-commerce' ); ?>
										</label>
										<div class="currency-wrapper">
											<span class="currency-symbol">
												<?php echo Settings::get_currency_symbol(); ?>
											</span>
											<input
												type="number"
												name="bump_start_price"
												placeholder="0.00"
												min="0"
												step="0.01"
												value=""
											>
										</div>
									</div>

									<div class="general__item option-type option-type-payment-plan">
										<label for="bump_payment_number">
											<?php esc_html_e( 'Number of payments', 'north-commerce' ); ?>
										</label>
										<input
											type="number"
											name="bump_payment_number"
											min="0"
											value=""
										>
									</div>

									<div class="general__item option-type option-type-subscription">
										<label for="bump_start_price_sub">
											<?php esc_html_e( 'Price for first period', 'north-commerce' ); ?>
										</label>
										<div class="currency-wrapper">
											<span class="currency-symbol">
												<?php echo Settings::get_currency_symbol(); ?>
											</span>
											<input
												type="number"
												name="bump_start_price_sub"
												placeholder="0.00"
												min="0"
												step="0.01"
												value=""
											>
										</div>
									</div>

                                    <div class="general__item option-type option-type-payment-plan option-type-subscription">
                                        <label for="bump_frequency">Payment frequency</label>
                                        <select id="bump_frequency" name="bump_frequency" class="north-single-select"
                                                data-minimum-results-for-search="Infinity">
                                            <option value="week" <?php echo ( $bump_frequency ?? null ) === 'week' ? 'selected' : ''; ?>>
                                                Weekly
                                            </option>
                                            <option value="month" <?php echo ( $bump_frequency ?? null ) === 'month' ? 'selected' : ''; ?>>
                                                Monthly
                                            </option>
                                            <option value="year" <?php echo ( $bump_frequency ?? null ) === 'year' ? 'selected' : ''; ?>>
                                                Yearly
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
				<?php

				$this->template( 'variants', 'product/form', [
					'has_product_variants' => $has_product_variants,
					'product' => $product ?? [],
					'product_option_types' => $product_option_types,
					'product_model' => $product_model
				] );

				?>
                <div id="product-custom-info" class="settings-card form__product-custom-info">
					<?php

                    $has_custom_details = (bool) ( $product['has_customs_details'] ?? null );
					$has_custom_details = $has_custom_details && $is_physical; // available for physical products only

					?>
					<div class="optional__header<?php echo $has_custom_details ? ' active' : ''; ?>">
						<div class="header__title">
							<h3>
								<?php esc_html_e( 'Custom information', 'north-commerce' ); ?>
							</h3>
							<p>
								<?php esc_html_e( 'Add custom information if this is a physical product.', 'north-commerce' ); ?>
							</p>
						</div>
						<div class="switch">
							<input
								type="checkbox"
								name="has_custom_info"
								<?php checked( $has_custom_details ); ?>
							>
							<label class="switch-service-label">
								<span class="switch-dot"></span>
							</label>
						</div>
					</div>

                    <div class="optional__body custom-info">

                        <div class="input-wrapper content-type">
                            <label for="product_custom_type">
                                <?php esc_html_e( 'Content type', 'north-commerce' ); ?>
                            </label>

                            <select
								id="product_custom_type"
								name="product_custom_type"
								class="north-single-select"
								data-minimum-results-for-search="Infinity"
							>
								<?php
								foreach ( $product_model->list_custom_content_types() as $type ) {
									?>
                                    <option
                                        value="<?php echo esc_attr( $type['slug'] ); ?>"
                                        <?php selected( $product_custom_info['content_type']['slug'] ?? '', $type['slug'] ); ?>
                                        >
                                        <?php echo esc_html( $type['name'] ); ?>
                                    </option>
									<?php
                                }
								?>
                            </select>
                        </div>

                        <div class="input-wrapper country-origin">
                            <label for="product_custom_region">
                                <?php esc_html_e( 'Country/Region of origin', 'north-commerce' ); ?>
                            </label>

                            <select
								id="product_custom_region"
								name="product_custom_region"
								class="north-single-select"
								data-minimum-results-for-search="Infinity"
							>
                                <option value="">
                                    <?php esc_html_e( 'Select country/region', 'north-commerce' ); ?>
                                </option>
								<?php

                                foreach ( $country_model->get_formated_list() as $country_code => $country_name ) {
									?>
                                    <option
                                        value="<?php echo esc_attr( $country_code ); ?>"
                                        <?php selected( $product_custom_info['country']['abbreviation'] ?? '', $country_code ); ?>
                                        >
                                        <?php echo esc_html( $country_name ); ?>
                                    </option>
									<?php
                                }

								?>
                            </select>

                        </div>

                        <div class="input-wrapper country-origin">
                            <label for="product_custom_hs_code">
                                <?php esc_html_e( 'HS (Harmonized System) code', 'north-commerce' ); ?>
                            </label>
                            <input
                                id="product_custom_hs_code"
                                type="text"
                                name="product_custom_hs_code"
                                placeholder="<?php esc_attr_e( 'HS code', 'north-commerce' ); ?>"
                                value="<?php echo esc_attr( $product_custom_info['hs_code'] ?? '' ); ?>"
							>
                            </input>
                        </div>

                    </div>
                </div>

                <div id="product-publishing" class="settings-card form__product-publishing">
                    <h3>
						<?php esc_html_e( 'Publishing', 'north-commerce' ); ?>
                    </h3>

                    <p>
                        <?php esc_html_e( 'Set up publishing preferences to publish product in time.', 'north-commerce' ); ?>
					</p>

                    <div class="publishing__item">
                        <label class="radio-container">
                            <?php esc_html_e( 'Immediately', 'north-commerce' ); ?>
                            <input
                                id="publishing_immediately"
                                type="radio"
                                name="product_status"
                                value="published"
                                <?php checked( ! $product_status_slug || ( ! $is_product_scheduled && ! $is_product_draft ) ); ?>
							>
                            <span class="checkmark"></span>
                        </label>
                    </div>

                    <div class="publishing__item">

                        <label class="radio-container">
                            <?php esc_html_e( 'Scheduled', 'north-commerce' ); ?>
                            <input
                                id="publishing_scheduled"
                                type="radio"
                                name="product_status"
                                value="schedule"
                                <?php checked( $is_product_scheduled ); ?>
							>
                            <span class="checkmark"></span>
                        </label>

                        <div id="publishing_date_picker" class="scheduled<?php echo ! $is_product_scheduled ? '' : ' active'; ?>">
                            <div class="scheduled__item">
								<label for="publishing_date">
									<?php esc_html_e( 'Date', 'north-commerce' ); ?>
								</label>
								<div class="date__wrapper">
									<input
										type="text"
										id="publishing_date"
										name="publishing_date"
										data-time-zone="<?php echo Settings::get_current_time_zone(); ?>"
										class=""
										value="<?php echo esc_attr( $publishing_date ); ?>"
									>
								</div>
                            </div>
                            <div class="scheduled__item scheduled__item-time">
                                <label for="publishing_time">
									<?php esc_html_e( 'Time', 'north-commerce' ); ?>
								</label>
                                <input
									type="text"
									id="publishing_time"
									name="publishing_time"
									class=""
                                    value="<?php echo esc_attr( $publishing_time ); ?>"
								>
                                <select
									class="north-single-select publishing-time-select"
                                    data-minimum-results-for-search="Infinity"
								>
                                    <option value="12:00 am" selected="selected"><?php echo '12:00 am' . esc_html__( ' (start of day)', 'north-commerce' ); ?></option>
                                    <option value="12:30 am"><?php echo '12:30 am'; ?></option>
									<?php
                                    for ( $i = 1; $i < 12; $i++ ) {

                                        $hour = str_pad( $i, 2, '0', STR_PAD_LEFT );
                                        $period = $period ?? 'am';
										?>
                                        <option value="<?php echo esc_attr( $hour . ':00 ' . $period ); ?>"><?php echo esc_html( $hour . ':00 ' . $period ); ?></option>
                                        <option value="<?php echo esc_attr( $hour . ':30 ' . $period ); ?>"><?php echo esc_html( $hour . ':30 ' . $period ); ?></option>
										<?php
                                        if ( 11 === $i && 'am' === $period ) {
                                            $period = 'pm';
											?>
                                            <option value="<?php echo esc_attr( '12:00 ' . $period ); ?>"><?php echo esc_html( '12:00 ' . $period ); ?></option>
                                            <option value="<?php echo esc_attr( '12:30 ' . $period ); ?>"><?php echo esc_html( '12:30 ' . $period ); ?></option>
											<?php
                                            $i = 0;
                                        }

                                    }
                                    ?>
                                </select>
                            </div>
                        </div>
                    </div>

					<div class="publishing__item">
						<label class="radio-container">
							<?php esc_html_e( 'Don’t publish (save as Draft)', 'north-commerce' ); ?>
							<input
								id="publishing_draft"
								type="radio"
								name="product_status"
								value="draft"
								<?php checked( $is_product_draft ); ?>
							>
							<span class="checkmark"></span>
						</label>
					</div>
				</div>
				<div class="form__overlay product-wait"></div>
            </div>

            <div id="errors" class="form__product-errors"></div>

            <div class="product__action product__action-footer">
				<?php

                if ( isset( $product['id'] )  ) {
					?>
                    <a
                        href="javascript:void(0);"
                        class="btn action action-delete"
                        data-product-id="<?php echo esc_attr( $product['id'] ); ?>"
						>
                        <?php esc_html_e( 'Delete', 'north-commerce' ); ?>
                    </a>
					<?php
                } else {
					?>
                    <a
                        href="<?php echo admin_url( 'admin.php?page=north-commerce-products' ); ?>"
                        class="btn action action-cancel"
                        >
                        <?php esc_html_e( 'Cancel', 'north-commerce' ); ?>
                    </a>
					<?php
                }
				?>

                <div class="wrapper">
					<?php

                    if ( isset( $product['id'] ) ) {
						?>
                        <a
                            href="javascript:void(0);"
                            class="btn action action-archive<?php echo $is_product_archived ? ' disabled' : ''; ?>"
                            data-product-id="<?php echo esc_attr( $product['id'] ); ?>"
                            >
                            <?php esc_html_e( 'Archive', 'north-commerce' ); ?>
                        </a>
						<?php
                    }

					$action_value = isset( $product['id'] )
						? __( 'Update Product', 'north-commerce' )
						: __( 'Save Product', 'north-commerce' );
					?>
                    <input
                        type="submit"
                        class="btn action action-save"
                        data-product-form-type="<?php echo isset( $product['id'] ) ? 'update' : 'create'; ?>"
                        value="<?php echo esc_attr( $action_value ); ?>"
					>

                </div>

            </div>

        </form>

        <div id="sidebar" class="content__sidebar sidebar">
            <div class="theiaStickySidebar">
                <ul class="settings-card sidebar__nav">
                    <li>
                        <a class="nc-smooth-scroll-nav" href="#product-type"><?php esc_html_e( 'Product type', 'north-commerce' ); ?></a>
                    </li>
                    <li>
                        <a class="nc-smooth-scroll-nav" href="#product-general"><?php esc_html_e( 'General information', 'north-commerce' ); ?></a>
                    </li>
                    <li>
                        <a class="nc-smooth-scroll-nav" href="#product-images"><?php esc_html_e( 'Images', 'north-commerce' ); ?></a>
                    </li>
                    <li>
                        <a class="nc-smooth-scroll-nav" href="#product-inventory"><?php esc_html_e( 'Inventory', 'north-commerce' ); ?></a>
                    </li>
                    <li class="option-type option-type-one-time">
                        <a class="nc-smooth-scroll-nav" href="#product-shipping"><?php esc_html_e( 'Shipping', 'north-commerce' ); ?></a>
                    </li>
                    <li>
                        <a class="nc-smooth-scroll-nav" href="#product-pricing"><?php esc_html_e( 'Pricing', 'north-commerce' ); ?></a>
                    </li>
                    <li class="option-type option-type-one-time">
                        <a class="nc-smooth-scroll-nav" href="#product-variants"><?php esc_html_e( 'Variants', 'north-commerce' ); ?></a>
                    </li>
                    <li>
                        <a class="nc-smooth-scroll-nav" href="#product-publishing"><?php esc_html_e( 'Publishing', 'north-commerce' ); ?></a>
                    </li>
                </ul>

				<div class="settings-card categories">
					<div class="card__header">
						<span class="header__text">
							<?php esc_html_e( 'Categories', 'north-commerce' ); ?>
						</span>
						<span class="header__icon">
							<svg width="16" height="16" viewBox="0 0 16 16" role="img">
								<path fill="#B3B9C4" d="M15.4002 5.12853C15.7871 4.74082 16 4.22591 16 3.67818C16 3.13046 15.7871 2.61555 15.4002 2.22783L13.7767 0.601064C13.3898 0.213347 12.876 0 12.3293 0C11.7827 0 11.2689 0.213347 10.883 0.600038L0 11.4715V16H4.51718L15.4002 5.12853ZM12.3293 2.05141L13.9538 3.67716L12.3263 5.30188L10.7028 3.67613L12.3293 2.05141ZM2.04721 13.9486V12.3228L9.25341 5.12443L10.8768 6.7512L3.67168 13.9486H2.04721Z"/>
							</svg>
						</span>
					</div>

					<div class="card__description">
						<?php esc_html_e( 'If you only want the product to be applied to these categories', 'north-commerce' ); ?>
					</div>

					<div class="categories__input-wrapper">

						<span class="token category_token template" data-category="">
							<span class="category_name"></span>
							<button class="btn-close" title="<?php esc_attr_e( 'Remove', 'north-commerce' ); ?>">
								<svg width="24" height="24" viewBox="0 0 24 24" role="img">
									<path d="M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"></path>
								</svg>
							</button>
						</span>

						<input
							id="product_category"
							type="text"
							name="product_category"
							placeholder="<?php esc_attr_e( 'Choose category', 'north-commerce' ); ?>"
						>

						<ul class="promt promt-categories" data-promt-type="product-categories">
							<?php

							$all_categories = $product_model->list_categories();
							foreach ( $all_categories as $cat ) {
								?>
								<li
									class="promt__item category"
									data-category="<?php echo esc_attr( $cat['slug'] ); ?>"
									>
									<?php echo esc_html( $cat['name'] ); ?>
								</li>
								<?php
							}

							?>
						</ul>

                        <button class="button add-new">
                            <svg class="button__icon" width="10" height="10" viewBox="0 0 10 10">
                               <path d="M4 4H0V6H4V10H6V6H10V4H6V0H4V4Z" fill="#ffffff">
                            </svg>
                            <span class="button__text">
                                <?php esc_html_e( 'Add new category', 'north-commerce' ); ?>
                            </span>
                        </button>

                        <div class="categories active">
							<?php

							$product_cats = isset( $product['id'] ) ? $product_model->list_product_categories( $product['id'] ) : [];
							foreach ( $product_cats as $cat ) {
								?>
								<span
									class="token category_token"
									data-category="<?php echo esc_attr( $cat['category']['slug'] ); ?>"
									>
									<span class="category_name">
										<?php echo esc_html( $cat['category']['name'] ); ?>
									</span>
									<button class="btn-close" title="<?php esc_attr_e( 'Remove', 'north-commerce' ); ?>">
										<svg width="24" height="24" viewBox="0 0 24 24" role="img">
											<path d="M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"></path>
										</svg>
									</button>
								</span>
								<?php
							}

							?>
						</div>

					</div>

				</div>

				<div class="settings-card tags">
					<div class="card__header">

						<span class="header__text">
							<?php esc_html_e( 'Tags', 'north-commerce' ); ?>
						</span>

						<span class="header__icon">
							<svg width="16" height="16" viewBox="0 0 16 16" role="img">
								<path fill="#B3B9C4" d="M15.4002 5.12853C15.7871 4.74082 16 4.22591 16 3.67818C16 3.13046 15.7871 2.61555 15.4002 2.22783L13.7767 0.601064C13.3898 0.213347 12.876 0 12.3293 0C11.7827 0 11.2689 0.213347 10.883 0.600038L0 11.4715V16H4.51718L15.4002 5.12853ZM12.3293 2.05141L13.9538 3.67716L12.3263 5.30188L10.7028 3.67613L12.3293 2.05141ZM2.04721 13.9486V12.3228L9.25341 5.12443L10.8768 6.7512L3.67168 13.9486H2.04721Z"/>
							</svg>
						</span>

					</div>

					<div class="tags__input-wrapper">

						<span class="token tag_token template" data-tag="">
							<span class="tag_name"></span>
							<button class="btn-close" title="<?php esc_attr_e( 'Remove', 'north-commerce' ); ?>">
								<svg width="24" height="24" viewBox="0 0 24 24" role="img">
									<path d="M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"></path>
								</svg>
							</button>
						</span>

                        <input id="product_tag" type="text" name="product_tag" placeholder="<?php esc_attr_e( 'Choose tag', 'north-commerce' ); ?>">
                        <ul class="promt promt-tags" data-promt-type="product-tags">
							<?php

                            $all_tags = $product_model->list_tags();
                            foreach ( $all_tags as $tag ) {
								?>
                                <li class="promt__item tag" data-tag="<?php echo esc_attr( $tag['slug'] ); ?>">
                                    <?php echo esc_html( $tag['name'] ); ?>
                                </li>
								<?php
                            }

							?>
                        </ul>

						<button class="button add-new">
							<svg class="button__icon" width="10" height="10" viewBox="0 0 10 10">
								<path d="M4 4H0V6H4V10H6V6H10V4H6V0H4V4Z" fill="#ffffff">
							</svg>
							<span class="button__text">
								<?php esc_html_e( 'Add new tag', 'north-commerce' ); ?>
							</span>
						</button>

						<div class="tags active">
							<?php

							$product_tags = isset( $product['id'] ) ? $product_model->list_product_tags( $product['id'] ) : [];
							foreach ( $product_tags as $tag ) {
								?>
								<span class="token tag_token" data-tag="<?php echo esc_attr( $tag['tag']['slug'] ); ?>">
									<span class="tag_name">
										<?php echo esc_html( $tag['tag']['name'] ); ?>
									</span>
									<button class="btn-close" title="<?php esc_attr_e( 'Remove', 'north-commerce' ); ?>">
										<svg width="24" height="24" viewBox="0 0 24 24" role="img">
											<path d="M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"></path>
										</svg>
									</button>
								</span>
								<?php
							}

							?>
						</div>

					</div>

				</div>

			</div>
		</div>
	</div>
</div>
