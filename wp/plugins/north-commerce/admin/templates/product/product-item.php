<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Db\Collections\ProductTypes;
use North_Commerce_Settings as Settings;

/**
 * Provide a admin area view for the Product item within list
 *
 *
 * @package north-commerce/admin/templates/product
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.24
 */


if ( empty( $product['id'] ) ) {
    // Bailout.
    return;
}

$product_id = $product['id'];
$product_price = Settings::formatted_price( $product['base_price'] );
$product_quantity = $product['quantity'];
$product_type = $product['product_type'];
$product_status = $product['product_status'];

?>
<div class="product" data-product-id="<?php echo esc_attr( $product_id ); ?>" data-product-url="<?php echo esc_url( site_url() ) . '/wp-admin/admin.php?page=north-commerce-products&action=edit&id=' . $product_id ?>">

    <div class="product__select result-col-1">

        <label for="<?php echo esc_attr( 'product-' . $product_id ); ?>"></label>
        <input type="checkbox" name="<?php echo esc_attr( 'product-' . $product_id ); ?>" id="<?php echo esc_attr( 'product-' . $product_id ); ?>">

    </div>

    <div class="product__title result-col-5">
        <?php
        $product_image = $product['product_images'][0]['image_url'] ?? NORTH_COMMERCE_PLUGIN_DIR_URL . 'admin/images/product-empty-img.png';
        echo '<img src="', esc_url( $product_image ), '">';

        echo '<a href="', esc_url( site_url() ) . '/wp-admin/admin.php?page=north-commerce-products&action=edit&id=' . $product_id, '">',
            esc_html( $product['name'] . ' - ' . '#' . $product_id ),
        '</a>';
        ?>
    </div>

    <div class="product__price result-col-2">
        <?php

        if (
            in_array( $product_type['id'], [
                ProductTypes::paymentPlan()->id,
                ProductTypes::subscription()->id
            ] )
        ) {
            $payment_frequency = $product['payment_detail']['payment_frequency']['name'] ?? '';
            $payment_frequency = 'ly' === substr( $payment_frequency, -2 ) ? substr( $payment_frequency, 0, -2 ) : $payment_frequency;
            $payment_frequency = lcfirst( $payment_frequency );

            if ( ProductTypes::paymentPlan()->id === $product_type['id'] ) {
                $payments_count = $product['payment_detail']['num_payments'] ?? 1;

                ?>
                <div class="price__wrapper">
                    <p>
                        <?php echo $product_price . ' Total'; ?>
                    </p>
                    <p>
                        <?php
                        echo Settings::formatted_price( $product['base_price'] / $payments_count );
                        echo ' / ' . $payment_frequency . ' for ' . $payments_count . ' ' . $payment_frequency . 's';
                        ?>
                    </p>
                </div>
                <?php
            }

            if ( ProductTypes::subscription()->id === $product_type['id'] ) {
                echo $product_price . ' / ' .  $payment_frequency;
            }
        }

        if ( ProductTypes::oneTime()->id === $product_type['id'] ) {
            echo $product_price;
        }

        ?>
    </div>
    <?php

    if ( null === $product_quantity ) {
        $quantity_text = esc_html__( 'Unlimited', 'north-commerce' );
    } else {
        $quantity_text = $product_quantity ? esc_html( $product_quantity . ' in stock' ) : esc_html__( 'Out of stock', 'north-commerce' );
    }
    echo '<div class="product__inventory result-col-2">',
        $quantity_text,
    '</div>';

    ?>
    <div class="product__type result-col-3">
        <?php echo esc_html( $product_type['name'] . ' product' ); ?>
    </div>
    <?php

    echo '<div class="product__status product__status-' . esc_html( $product_status['slug'] ) . ' result-col-2">';
        ?>
        <span>
            <?php echo esc_html( $product_status['name'] ); ?>
        </span>
        <?php

        echo '<div class="product__actions">';

            echo '<a',
                ' href="javascript:void(0);"',
                ' class="product-duplicate"',
                ' title="' . esc_attr__( 'Duplicate', 'north-commerce' ) . '"',
                ' data-product-id="' . esc_attr( $product_id ) . '"',
                '>',
                '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">',
                    '<path fill="#747E94" d="M4 22H16C17.104 22 18 21.104 18 20V8C18 6.896 17.104 6 16 6H4C2.896 6 2 6.896 2 8V20C2 21.104 2.896 22 4 22Z"/>',
                    '<path fill="#747E94" d="M20 2H8V4H20V16H22V4C22 2.897 21.103 2 20 2Z"/>',
                '</svg>',
            '</a>';

            echo '<a',
                ' href="' . esc_url( site_url() ) . '/wp-admin/admin.php?page=north-commerce-products&action=edit&id=' . $product_id . '"',
                ' class="product-edit"',
                ' title="' . esc_attr__( 'Edit', 'north-commerce' ) . '"',
                ' data-product-id="' . esc_attr( $product_id ) . '"',
                '>',
                '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">',
                    '<path fill="#747E94" d="M8.707 19.7068L18 10.4138L13.586 5.99981L4.293 15.2928C4.165 15.4208 4.074 15.5818 4.03 15.7568L3 20.9998L8.242 19.9698C8.418 19.9258 8.579 19.8348 8.707 19.7068ZM21 7.41381C21.781 6.63281 21.781 5.36681 21 4.58581L19.414 2.99981C18.633 2.21881 17.367 2.21881 16.586 2.99981L15 4.58581L19.414 8.99981L21 7.41381Z">',
                '</svg>',
            '</a>';

            echo '<a',
                ' href="javascript:void(0);"',
                ' class="product-remove"',
                ' title="' . esc_attr__( 'Trash', 'north-commerce' ) . '"',
                ' data-product-id="' . esc_attr( $product_id ) . '"',
                '>',
                '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">',
                    '<path fill="#747E94" d="M6 7C5.447 7 5 7 5 7V20C5 21.104 5.896 22 7 22H17C18.104 22 19 21.104 19 20V7C19 7 18.553 7 18 7H6ZM10 19H8V10H10V19ZM16 19H14V10H16V19ZM16.618 4L15 2H9L7.382 4H3V6H8H16H21V4H16.618Z">',
                '</svg>',
            '</a>';

        echo '</div>'; // product__actions

    echo '</div>'; // product__status

echo '</div>';
