<?php

defined( 'ABSPATH' ) || exit;

/**
 * Orders List template
 *
 * @package north-commerce/admin/templates/order
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.25
 */

$current_page = sanitize_text_field( $_POST['paged'] ?? 1 );
$orders_per_page = sanitize_text_field( $_POST['orders_per_page'] ?? 10 );
$orders_per_page_db = get_option('nc_orders_per_page');
if(!empty($orders_per_page_db)) $orders_per_page = $orders_per_page_db;
if(!empty($_GET['ipp'])){
	update_option('nc_orders_per_page', (int)$_GET['ipp']);
	$orders_per_page = (int)$_GET['ipp'];
}
if($orders_per_page === 'All'){
	$orders_per_page = 0;
}

$order_model = new \NorthCommerce\Models\OrderModel();

$options = [
    'limit' => $orders_per_page,
    'offset' => $orders_per_page * ( $current_page - 1 ),
    'order_by' => 'order_number DESC',
];

$orders = $order_model->list_all( $criteria = true, $options );
$orders_total = $order_model->count();

$pagination_text = function () use ( $orders_total, $options ) {
    if ( ! $orders_total ) {
        return esc_html__( '0-0 of 0', 'north-commerce' );
    }
    $first = $options['offset'] + 1;
    $last = $orders_total < $options['limit'] ? $orders_total : $options['limit'];
    return $first . '-' . $last  . ' of ' . $orders_total;
};

$order_list_dir = 'order/list';


?>
<div class="north-tab-wrapper">
    <?php $this->plugin_tabs(); ?>
</div>
<?php

do_action( 'north_commerce_notices' );

?>
<div id="wpmdb-main">
    <div class="content-tab">
        <div class="settings-tab__head">
            <div class="head__wrapper">
                <h2>
                    <?php esc_html_e( 'Orders', 'north-commerce' ); ?>
                </h2>
                <p>
                    <?php esc_html_e( 'You can manage and customize your orders.', 'north-commerce' ); ?>
                </p>
            </div>
            <button
                class="btn submit-btn activate order-add"
                data-nc-custom-popup="#customers-modal"
                disabled
            >
                <?php esc_html_e( 'Create New Order', 'north-commerce' ); ?>
            </button>
        </div>

        <div class="settings-tab__body orders">
            <?php
            $this->template( 'statuses-template', $order_list_dir, compact(
                'order_model',
                'orders_total',
            ) );

            ?>
            <div class="orders__board board">
                <?php

                $this->template( 'board-header-template', $order_list_dir, [
                    'pagination' => $pagination_text(),
					'per_page'=> $orders_per_page,
                ] );

                ?>
                <div class="board__result">
                    <div class="result__labels">
                        <div class="result-col-1">
                            <div class="result__select">
                                <label for="all"></label>
                                <input type="checkbox" name="all" id="all" />
                            </div>
                            <div class="bump">
                                <div class="bump__count-selecting">
                                    <p><span>1 </span>selected</p>
                                </div>
                                <div class="bump__action">
                                    <a
                                        href="#"
                                        class="action__fulfilled product-bump-fulfilled"
                                    >
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M9.99935 18.3332C5.39697 18.3332 1.66602 14.6022 1.66602 9.99984C1.66602 5.39746 5.39697 1.6665 9.99935 1.6665C14.6017 1.6665 18.3327 5.39746 18.3327 9.99984C18.3276 14.6001 14.5996 18.3281 9.99935 18.3332ZM9.99935 3.33317C6.31745 3.33317 3.33268 6.31794 3.33268 9.99984C3.33268 13.6818 6.31745 16.6665 9.99935 16.6665C13.6813 16.6665 16.666 13.6818 16.666 9.99984C16.6618 6.31965 13.6795 3.3373 9.99935 3.33317ZM9.99935 14.9998C8.68268 15.0221 7.43818 14.3998 6.66602 13.3332C6.29108 12.8318 6.00886 12.2673 5.83268 11.6665H14.166C14.166 11.6665 14.166 11.6665 14.166 11.6732C13.9871 12.2708 13.7051 12.8327 13.3327 13.3332C12.5604 14.3998 11.3159 15.022 9.99935 14.9998ZM7.08268 9.99984C6.39232 9.99984 5.83268 9.44017 5.83268 8.74984C5.83268 8.05948 6.39232 7.49984 7.08268 7.49984C7.77304 7.49984 8.33268 8.05948 8.33268 8.74984C8.33268 9.44017 7.77304 9.99984 7.08268 9.99984ZM12.9102 9.98817C12.223 9.98817 11.666 9.43117 11.666 8.744C11.666 8.05687 12.223 7.49984 12.9102 7.49984C13.5973 7.49984 14.1543 8.05687 14.1543 8.744C14.1534 9.43075 13.5969 9.98725 12.9102 9.98817Z" fill="#747E94"/>
                                        </svg>
                                        <div class="action__hint">
                                            <p><?php esc_html_e( 'Mark as Fullfilled', 'north-commerce' ); ?></p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="result-col-2"><?php esc_html_e( 'Order ID', 'north-commerce' ); ?></div>
                        <div class="result-col-2"><?php esc_html_e( 'Status', 'north-commerce' ); ?></div>
                        <div class="result-col-4"><?php esc_html_e( 'Customer', 'north-commerce' ); ?></div>
                        <div class="result-col-2"><?php esc_html_e( 'Items', 'north-commerce' ); ?></div>
                        <div class="result-col-2"><?php esc_html_e( 'Total', 'north-commerce' ); ?></div>
                        <div class="result-col-3"><?php esc_html_e( 'Payment', 'north-commerce' ); ?></div>
                        <div class="result-col-3"><?php esc_html_e( 'Date', 'north-commerce' ); ?></div>
                    </div>

                    <div
                        class="result__orders"
                        data-current-page="<?php echo esc_attr( $current_page ); ?>"
                        data-max-page="<?php echo esc_attr( $orders_total ); ?>"
						data-per-page="<?php echo esc_attr( $orders_per_page ); ?>"
                    >
                        <?php

                        foreach ( $orders as $order ) {
                            $this->template( 'order-item-template', $order_list_dir, compact( 'order' ) );
                        }

                        ?>
                    </div>

                    <div class="board__overlay">
                        <div class="loader-spinner"></div>
                    </div>
                </div>

                <div class="board__footer">
                    <div class="board__actions">
                        <div class="action__result">
                            <span>
                                <?php echo esc_html( $pagination_text() ); ?>
                            </span>
                        </div>

                        <div class="action__buttons">
                            <a class="btn btn-prev order-prev" href="javascript:void(0);"></a>
                            <a class="btn btn-next order-next" href="javascript:void(0);"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<?php
$this->template( 'popup-customers-list-template', 'order/draft' );
