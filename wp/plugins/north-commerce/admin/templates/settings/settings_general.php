<?php

use North_Commerce_Settings as Settings;

$settings = new Settings();

if ( isset( $_POST['update_settings'] ) ) {

    $errors = [];

	if ( isset( $_POST['base_location'] ) ) {
		Settings::set_warehouse_country( $_POST['base_location'] );
	}

	if (isset($_POST['sale_restriction'])) {
		Settings::set_sale_restriction($_POST['sale_restriction']);

		if ('except' === $_POST['sale_restriction']) {
			$except = array();
			if (!empty($_POST['sale_restriction__except'])) {
				foreach ($_POST['sale_restriction__except'] as $key => $value) {
					$except[] = sanitize_text_field($value);
				}
			}
			Settings::set_countries_excepted_for_sale($except);
		}

		if ('specific' === $_POST['sale_restriction']) {
			$specific = array();
			if (!empty($_POST['sale_restriction__specific'])) {
				foreach ($_POST['sale_restriction__specific'] as $key => $value) {
					$specific[] = sanitize_text_field($value);
				}
			}
			Settings::set_countries_specific_for_sale($specific);
		}
	}

	if (isset($_POST['shipping_restriction'])) {
		Settings::set_shipping_restriction($_POST['shipping_restriction']);

		if ('specific' === $_POST['shipping_restriction']) {
			$specific = array();
			if (!empty($_POST['shipping_location__specific'])) {
				foreach ($_POST['shipping_location__specific'] as $key => $value) {
					$specific[] = sanitize_text_field($value);
				}
			}

			Settings::set_countries_specific_for_shipping($specific);
		}
	}

	if (isset($_POST['default_location'])) {
		Settings::set_customer_location_determination($_POST['default_location']);
	}

	if (isset($_POST['time_zone'])) {
		Settings::set_time_zone($_POST['time_zone']);
	}

	if (isset($_POST['unit_system'])) {
		Settings::set_current_unit_system(sanitize_text_field($_POST['unit_system']));
	}

	if (isset($_POST['weight_unit'])) {
		Settings::set_weight_unit($_POST['weight_unit']);
	}

	if (isset($_POST['currency'])) {
		if (Settings::get_currency_code() != $_POST['currency']) {
			Settings::set_currency_code($_POST['currency']);
			$stripe = new North_Commerce_Stripe();
			$paypal = new North_Commerce_Paypal();
			$stripe->recreate_plans();
			$paypal->recreate_plans();
		}
	}

	if (isset($_POST['thousands_separator'])) {
		Settings::set_thousands_separator($_POST['thousands_separator']);
	}

	if (isset($_POST['decimal_operator'])) {
		Settings::set_decimal_separator($_POST['decimal_operator']);
	}

	if (isset($_POST['currency_position'])) {
		Settings::set_currency_position($_POST['currency_position']);
	}

	if (isset($_POST['decimal_number'])) {
		Settings::set_number_of_decimals($_POST['decimal_number']);
	}

	if ( isset( $_POST['cart_drawer_display_status'] ) ) {
		Settings::set_cart_drawer_display_status( $_POST['cart_drawer_display_status'] );
	} else {
		Settings::set_cart_drawer_display_status('disabled');
	}

	foreach (['checkout', 'product', 'collections', 'cart', 'checkout_thank_you'] as $target) {
		if (!empty($_POST["north_commerce_{$target}_page_id"])) {
			Settings::nc_set_page_id($target, absint($_POST["north_commerce_{$target}_page_id"]));
		}
	}

	if (isset($_POST['menu-cart-icon'])) {
		$settings->set_menu_cart_icon_name(sanitize_text_field($_POST['menu-cart-icon']));
	}

	if (isset($_POST['cart-icon-color'])) {
		$icon_color = sanitize_text_field($_POST['cart-icon-color']);
		$counter_color = sanitize_text_field($_POST['cart-icon-counter-color']);
		$counter_bg = sanitize_text_field($_POST['cart-icon-counter-bg']);
		$settings->set_menu_cart_icon_colors(compact('icon_color', 'counter_color', 'counter_bg'));
	}

	if ( isset( $_POST['tax_percentage'] ) ) {

		if(!$_POST['tax_percentage']) {
			$_POST['tax_percentage'] = 0;
		}

		if (
			!is_numeric($_POST['tax_percentage']) || $_POST['tax_percentage'] < 0 || $_POST['tax_percentage'] > 100
		) {
			$errors[] = 'Tax percentage must be between 0 and 100';
		} else {
			Settings::set_tax_percentage(sanitize_text_field($_POST['tax_percentage']));
		}
	}

	if ( isset( $_POST['tax_is_vat'] ) ) {
		Settings::set_tax_is_vat( $_POST['tax_is_vat'] );
	} else {
		Settings::set_tax_is_vat( 'disabled' );
	}

	if ( isset( $_POST['vat_is_incl'] ) ) {
		Settings::set_vat_is_incl( $_POST['vat_is_incl'] );
	} else {
		Settings::set_vat_is_incl( 'disabled' );
	}

	if ( isset( $_POST['sales_tax_is_visible'] ) ) {
		Settings::set_sales_tax_is_visible( $_POST['sales_tax_is_visible'] );
	} else {
		Settings::set_sales_tax_is_visible( 'disabled' );
	}

	if ( isset( $_POST['company_name'] ) ) {
		Settings::set_company_name( stripslashes( sanitize_text_field( $_POST['company_name'] ) ) );
	}

	if(isset($_POST['delete-company-logo-image'])) {
		Settings::delete_company_logo();
	} elseif(isset($_FILES['company-logo-image'])) {
		Settings::upload_company_logo();
	}

	if (isset($_POST['company-logo-image'])) {
		$settings->set_company_logo_name(sanitize_text_field($_POST['company-logo-image']));
	}

    if (empty($errors)) {
        echo '<div class="north-success" style="display: block;">'
            . esc_html__('Settings updated successfully!', 'north-commerce')
            . '</div>';
    } else {
        foreach ($errors as $error) {
            echo '<div class="north-error" style="display: block;">'
                . esc_html__($error, 'north-commerce')
                . '</div>';
        }
    }
}

$countries_list = (new \NorthCommerce\Models\CountryModel())->get_formated_list();

$sale_restriction     = Settings::get_sale_restriction();
$shipping_restriction = Settings::get_shipping_restriction();
$unit_system          = Settings::get_current_unit_system();
$weight_unit          = Settings::get_weight_unit();

?>
<div class="wrap north-settings">
	<div class="north-tab-wrapper">
		<?php $this->plugin_tabs(); ?>
	</div>
	<?php do_action('north_commerce_notices'); ?>
	<div id="wpmdb-main">
		<div id="settings-tab" class="settings-tab settings-general">
			<div class="settings-tab__head">
				<div class="head__wrapper">
					<h2><?php esc_html_e('Settings', 'north-commerce'); ?></h2>
					<p><?php esc_html_e('You can manage and customize your settings.', 'north-commerce'); ?></p>
				</div>
			</div>
			<div class="settings-tab__body settings">
				<sidebar class="settings__sidebar settings-card">
					<?= $this->template('nav', 'settings/components'); ?>
				</sidebar>
				<div class="settings__content">
					<section class="general">
						<form method="POST" id="general_settings" enctype="multipart/form-data">

							<div class="settings-card">
								<h3>
									<?php esc_html_e('Company', 'north-commerce'); ?>
								</h3>
								<p class="title-info loader-message">
									<?php esc_html_e('Configure your company main parameters', 'north-commerce'); ?>
								</p>

								<?php echo $this->template( 'input', 'settings/components', [
									'label' => 'Name',
									'info' => 'Specify the name of your company.',
									'setting_slug' => 'company_name'
								] ) ?>

								<div class="setting-field icon-selector">
                                    <?php $icon_url = Settings::get_company_logo_name() ?>

									<label for="add-company-logo">
										<?php esc_html_e('Logo', 'north-commerce'); ?>
									</label>
									<p class="title-info">
										<?php esc_html_e('Add logo image, which will be used at Thank You page and in Notifications emails', 'north-commerce'); ?>
									</p>

									<input type="hidden" id="input-company-logo-image" name="company-logo-image" accept="image/*" value="<?php echo $icon_url ?>">
									<input type='checkbox' value='1' id="delete-company-logo-image" name='delete-company-logo-image' />

									<?php
									if($icon_url) { ?>

										<div id="imagePreview"><img style='width: 200px;' src='<?= $icon_url ?>' /></div>
										<span class="custom-file-input company-add-logo" style="display:none";>Add logo</span>
										<span class="custom-file-input company-delete-logo"> Delete image </span>

										<?php
									} else { ?>
										<div id="imagePreview"></div>
										<span class="custom-file-input company-add-logo">Add logo</span>
										<span class="custom-file-input company-delete-logo" style="display:none";> Delete image </span>
									<?php } ?>

								</div>

							</div>

							<div class="settings-card">
								<h3><?php esc_html_e('Location', 'north-commerce'); ?></h3>
								<p class="title-info loader-message"><?php esc_html_e('Select where your products are sold from.', 'north-commerce'); ?></p>
								<div class="location-form-wrapper">
									<label for="base_location"><?php esc_html_e('Base location', 'north-commerce'); ?></label>
									<select name="base_location" id="base_location" class="north-single-select">
										<?php

										$warehouse_country = $settings::get_warehouse_country();
										foreach ($countries_list as $country_code => $country_name) {
											echo '<option ',
											' value="' . esc_attr($country_code) . '"',
											selected($warehouse_country == $country_code, true, false),
											'>',
											esc_html($country_name),
											'</option>';
										}

										?>
									</select>

									<label for="sale_restriction">
										<?php esc_html_e('Selling location', 'north-commerce'); ?>
									</label>
									<select name="sale_restriction" id="sale_restriction" class="north-single-select" data-minimum-results-for-search="Infinity">
										<?php
										foreach (list_sale_restrictions_for_countries() as $restriction_key => $restriction_description) {
											echo '<option',
											' value="' . esc_attr($restriction_key) . '"',
											selected($sale_restriction == $restriction_key, true, false),
											'>',
											esc_html($restriction_description),
											'</option>';
										}
										?>
									</select>

									<div class="selling__specifig-wrapper" <?php echo 'specific' === $sale_restriction ? ' style="display: block;"' : ''; ?>>
										<label for="sale_restriction__specific[]">Sell to specific countries</label>
										<select name="sale_restriction__specific[]" id="sale_restriction__specific" class="north-single-select" data-placeholder="Choose countries" data-minimum-results-for-search="Infinity" multiple>
											<?php

											$countries_specific_for_sale = $settings->list_countries_specific_for_sale();
											foreach ($countries_list as $country_code => $country_name) {
												echo '<option',
												' value="' . esc_attr($country_code) . '"',
												selected(in_array($country_code, $countries_specific_for_sale), true, false),
												'>',
												esc_html($country_name),
												'</option>';
											}

											?>
										</select>

										<div class="select-action">
											<a href="#" class="select__all submit-btn" data-select-id="sale_restriction__specific">
												<?php esc_html_e('Select all', 'north-commerce'); ?>
											</a>
											<a href="#" class="select__none submit-btn" data-select-id="sale_restriction__specific">
												<?php esc_html_e('Select none', 'north-commerce'); ?>
											</a>
										</div>

									</div>

									<div class="selling__except-wrapper" <?php echo 'except' === $sale_restriction ? ' style="display: block;"' : ''; ?>>
										<label for="sale_restriction__except[]">
											<?php esc_html_e('Sell to all countries, except forâ€¦', 'north-commerce'); ?>
										</label>
										<select name="sale_restriction__except[]" id="sale_restriction__except" class="north-single-select" data-placeholder="Choose countries" data-minimum-results-for-search="Infinity" multiple>
											<?php
											$countries_excepted_for_sale = $settings->list_countries_excepted_for_sale();
											foreach ($countries_list as $country_code => $country_name) {
												echo '<option',
												' value="' . esc_attr($country_code) . '"',
												selected(in_array($country_code, $countries_excepted_for_sale), true, false),
												'>',
												esc_html($country_name),
												'</option>';
											}
											?>
										</select>
										<div class="select-action">
											<a href="#" class="select__all submit-btn" data-select-id="sale_restriction__except"><?php esc_html_e('Select all', 'north-commerce'); ?></a>
											<a href="#" class="select__none submit-btn" data-select-id="sale_restriction__except"><?php esc_html_e('Select none', 'north-commerce'); ?></a>
										</div>
									</div>
									<label for="shipping_restriction"><?php esc_html_e('Shipping location', 'north-commerce'); ?></label>
									<select name="shipping_restriction" id="shipping_restriction" class="north-single-select" data-minimum-results-for-search="Infinity">
										<?php
										foreach (list_shipping_restrictions_for_countries() as $restriction_key => $restriction_description) {
											echo '<option ',
											' value="' . esc_attr($restriction_key) . '"',
											selected($shipping_restriction === $restriction_key, true, false),
											'>',
											esc_html($restriction_description),
											'</option>';
										}
										?>
									</select>

									<div class="shipping__specific-wrapper" <?php echo 'specific' === $shipping_restriction ? ' style="display: block;"' : ''; ?>>
										<label for="shipping_location__specific[]"><?php esc_html_e('Ship to specific countries', 'north-commerce'); ?></label>
										<select name="shipping_location__specific[]" id="shipping_location__specific" class="north-single-select" data-placeholder="Choose countries" data-minimum-results-for-search="Infinity" multiple>
											<?php

											$countries_specific_for_shipping = $settings->list_countries_specific_for_shipping();
											foreach ( $countries_list as $country_code => $country_name ) {
												echo '<option',
												' value="' . esc_attr($country_code) . '"',
												selected( in_array( $country_code, $countries_specific_for_shipping ), true, false ),
												'>',
												esc_html( $country_name ),
												'</option>';
											}

											?>
										</select>
										<div class="select-action">
											<a
												href="#"
												class="select__all submit-btn"
												data-select-id="shipping_location__specific"
											>
												<?php esc_html_e( 'Select all', 'north-commerce' ); ?>
											</a>
											<a
												href="#"
												class="select__none submit-btn"
												data-select-id="shipping_location__specific"
											>
												<?php esc_html_e('Select none', 'north-commerce'); ?>
											</a>
										</div>
									</div>
									<label for="default_location">
										<?php esc_html_e( 'Default customer location', 'north-commerce' ); ?>
									</label>
									<select
										name="default_location"
										id="default_location"
										class="north-single-select"
										data-minimum-results-for-search="Infinity"
									>
										<?php

										$customer_location_determination = $settings->get_customer_location_determination();
										foreach ( list_determination_options_of_customer_location() as $option_key => $option_description ) {
											?>
											<option
												value="<?php echo esc_attr( $option_key ); ?>"
												<?php selected( $customer_location_determination == $option_key ); ?>
											>
												<?php echo esc_html( $option_description ); ?>
											</option>
											<?php
										}

										?>
									</select>
								</div>
							</div>

							<!-- <div class="settings-card">
								<?php $this->template( 'store_metadata', '/settings/general' ); ?>
							</div> -->

							<div class="settings-card">
								<h3>
									<?php esc_html_e( 'Standards and Format', 'north-commerce' ); ?>
								</h3>
								<!-- <p class="title-info loader-message">The product available as one-time product.</p> -->
								<label for="time_zone">
									<?php esc_html_e( 'Time zone', 'north-commerce' ); ?>
								</label>
								<select
									name="time_zone"
									id="time_zone"
									class="north-single-select"
									data-minimum-results-for-search="Infinity"
								>
									<?php
									$time_zone = $settings::get_current_time_zone();
									foreach ( nc_list_time_zones() as $key => $value ) {
										?>
										<option
											value="<?php echo esc_attr( $key ); ?>"
											<?php selected( $time_zone == $key ); ?>
										>
											<?php echo esc_html( $value ); ?>
										</option>
										<?php
									}
									?>
								</select>
								<div class="select-wrapper">
									<div class="select__half">
										<label for="unit_system">
											<?php esc_html_e( 'Unit system', 'north-commerce' ); ?>
										</label>
										<select
											name="unit_system"
											id="unit_system"
											class="north-single-select"
											data-minimum-results-for-search="Infinity"
										>
											<?php
											foreach ( nc_list_unit_systems() as $key => $value ) {
												?>
												<option
													value="<?php echo esc_attr( $key ); ?>"
													<?php selected( $unit_system == $key ); ?>
												>
													<?php echo esc_html( $value ); ?>
												</option>
												<?php
											}
											?>
										</select>
									</div>
									<div class="select__half">
										<label for="weight_unit">
											<?php esc_html_e( 'Default weight unit', 'north-commerce' ); ?>
										</label>
										<select
											name="weight_unit"
											id="weight_unit"
											class="north-single-select"
											data-minimum-results-for-search="Infinity"
										>
											<?php
											foreach ( nc_list_weight_units() as $key => $value ) {
												?>
												<option
													value="<?php echo esc_attr( $key ); ?>"
													<?php selected( $weight_unit == $key ); ?>
												>
													<?php echo esc_html( $value ); ?>
												</option>
												<?php
											}
											?>
										</select>
									</div>
								</div>
							</div>

							<div class="settings-card">
								<h3>
									<?php esc_html_e( 'Store currency', 'north-commerce' ); ?>
								</h3>
								<!-- <p class="title-info loader-message">The product available as one-time product.</p> -->
								<label for="currency">
									<?php esc_html_e( 'Currency', 'north-commerce' ); ?>
								</label>
								<select
									name="currency"
									id="currency"
									class="north-single-select"
									data-minimum-results-for-search="Infinity"
								>
									<?php

									$currency_code = Settings::get_currency_code();
									foreach ( nc_list_currencies() as $key => $value ) {
										?>
										<option
											value="<?php echo esc_attr( $key ); ?>"
											<?php selected( $currency_code === $key ); ?>
										>
											<?php echo esc_html( $value ); ?>
										</option>
										<?php
									}

									?>
								</select>
								<div class="select-wrapper">
									<div class="select__half">
										<label for="thousands_separator">
											<?php esc_html_e( 'Thousands separator', 'north-commerce' ); ?>
										</label>
										<input
											type="text"
											name="thousands_separator"
											id="thousands_separator"
											value="<?php echo Settings::get_thousands_separator(); ?>"
										>
									</div>
									<div class="select__half">
										<label for="decimal_operator">
											<?php esc_html_e( 'Decimal separator', 'north-commerce' ); ?>
										</label>
										<input
											type="text"
											name="decimal_operator"
											id="decimal_operator"
											value="<?php echo Settings::get_decimal_separator(); ?>"
										>
									</div>
								</div>
								<div class="select-wrapper">
									<div class="select__half">
										<label for="currency_position">
											<?php esc_html_e('Currency position', 'north-commerce'); ?>
										</label>
										<select
											name="currency_position"
											id="currency_position"
											class="north-single-select"
											data-minimum-results-for-search="Infinity"
										>
											<?php

											$currency_position = Settings::get_currency_position();
											foreach ( nc_list_currency_positions() as $key => $value ) {
												?>
												<option
													value="<?php echo esc_attr( $key ); ?>"
													<?php selected( $currency_position === $key ); ?>
												>
													<?php echo esc_html( $value ); ?>
												</option>
												<?php
											}

											?>
										</select>
									</div>
									<div class="select__half">
										<label for="decimal_number">
											<?php esc_html_e('Number of decimals', 'north-commerce'); ?>
										</label>
										<input
											type="number"
											name="decimal_number"
											id="decimal_number"
											value="<?php echo Settings::get_number_of_decimals() ?>"
										>
									</div>
								</div>
							</div>

							<div class="settings-card">
								<h3>Products</h3>
								<p class="title-info loader-message">
									<?php esc_html_e('Configure product settings. This will be the template for all of your products.', 'north-commerce'); ?>
								</p>
								<div class="setting-field">
									<div class="setting-field__left setting-field__left--half-width">
										<label for="north_commerce_product_page_id">
											<?php esc_html_e('Product detail page', 'north-commerce'); ?>
										</label>
										<p class="title-info">
											<?php esc_html_e('The product detail page should contain the shortcode ', 'north-commerce'); ?>
											<span class="inline-block">[nc-product]</span>
										</p>
									</div>
									<div class="setting-field__right setting-field__right--half-width">
										<select name="north_commerce_product_page_id" id="north_commerce_product_page_id" class="north-single-select">
											<?php

											$product_page_id = Settings::nc_get_page_id('product');
											foreach (nc_list_published_pages() as $published_page) {
												echo '<option',
												' value="' . $published_page->ID . '"',
												selected($product_page_id === $published_page->ID, true, false),
												'>',
												$published_page->post_title . ' (ID: ' . $published_page->ID . ')',
												'</option>';
											}

											?>
										</select>
									</div>
								</div>

								<div class="setting-field">
									<div class="setting-field__left setting-field__left--half-width">
										<label for="north_commerce_product_page_id">
											<?php esc_html_e('Collection Page', 'north-commerce'); ?>
										</label>
										<p class="title-info">
											<?php esc_html_e('The product detail page should contain the shortcode ', 'north-commerce'); ?>
											<span class="inline-block">[nc-collection]</span>
										</p>
									</div>
									<div class="setting-field__right setting-field__right--half-width">
										<select name="north_commerce_collections_page_id" id="north_commerce_collections_page_id" class="north-single-select">
											<?php

											$collections_page_id = Settings::nc_get_page_id('collections');
											foreach (nc_list_published_pages() as $published_page) {
												echo '<option',
												' value="' . $published_page->ID . '"',
												selected($collections_page_id === $published_page->ID, true, false),
												'>',
												$published_page->post_title . ' (ID: ' . $published_page->ID . ')',
												'</option>';
											}

											?>
										</select>
									</div>
								</div>


							</div>

							<div class="settings-card">
								<h3>
									<?php esc_html_e('Cart', 'north-commerce'); ?>
								</h3>
								<p class="title-info loader-message">
									<?php esc_html_e('Configuring the cart settings', 'north-commerce'); ?>
								</p>
								<?php echo $this->template( 'switch', 'settings/components', [
									'label' => 'Enable Cart Drawer',
									'info' => 'Showing the cart drawer after adding new items to the cart',
									'setting_slug' => 'cart_drawer_display_status',
								] ) ?>
								<?php
								$cart_icon_colors = Settings::get_menu_cart_icon_colors();
								?>

								<div class="setting-field icon-selector">

									<label for="add-cart-svg">
										<?php esc_html_e('Cart Icon', 'north-commerce'); ?>
									</label>

									<div class="selector__options">
										<p class="tooltip">
											<span class="tooltip__icon">!</span>
											<span class="tooltip__text">
												<?php esc_html_e('Recomended icon dimensions is 20px x 20px. Format is SVG.', 'north-commerce'); ?>
											</span>
										</p>
										<span class="image-uploader">
											<label class="uploader__icon" title="<?php esc_attr_e('Upload cart SVG', 'north-commerce'); ?>">
												<input id="add-cart-svg" type="file" name="add-cart-svg" accept="image/svg+xml">
											</label>
											<label class="uploader__name" for="add-cart-svg"></label>
											<button class="uploader__submit" data-type="cart">
												<?php esc_html_e('Upload file', 'north-commerce'); ?>
											</button>
											<span class="uploader__error"></span>
											<?php wp_nonce_field('svg_uploader', 'svg_uploader_nonce', false); ?>
										</span>
										<?php echo $this->template('cart-icon-list', 'settings/cart-icons'); ?>
									</div>

									<div class="selector__colors">
										<div class="colors__row">
											<span class="row__label">
												<?php esc_html_e('Cart Icon Color', 'north-commerce'); ?>
											</span>
											<input name="cart-icon-color" type="text" class="color-picker" data-alpha="true" value="<?php echo esc_attr($cart_icon_colors['icon_color'] ?? ''); ?>">
										</div>
										<div class="colors__row color">
											<span class="row__label">
												<?php esc_html_e('Product Counter Text Color', 'north-commerce'); ?>
											</span>
											<input name="cart-icon-counter-color" type="text" class="color-picker" data-alpha="true" value="<?php echo esc_attr($cart_icon_colors['counter_color'] ?? ''); ?>">
										</div>
										<div class="colors__row">
											<span class="row__label">
												<?php esc_html_e('Product Counter Background Color', 'north-commerce'); ?>
											</span>
											<input name="cart-icon-counter-bg" type="text" class="color-picker" data-alpha="true" value="<?php echo esc_attr($cart_icon_colors['counter_bg'] ?? ''); ?>">
										</div>
									</div>

								</div>

								<?php
								echo $this->template( 'input', 'settings/components', [
									'label' => Settings::get_tax_is_vat() === 'enabled' ? 'VAT Percentage' : 'Tax Percentage',
									'info' => 'Set tax percentage, set to zero to disable tax',
									'setting_slug' => 'tax_percentage',
									'type' => 'number',
									'attributes' => [ 'min' => 0, 'max' => 100, 'step' => '0.01' ]
								] );

								echo $this->template( 'switch', 'settings/components', [
									'label' => 'Tax is VAT',
									'info' => 'Tax Percentage is Value Added Tax rather than sales tax',
									'setting_slug' => 'tax_is_vat',
									'attributes' => [ 'onchange' => '

										document.querySelector("label[for=tax_percentage]").innerText = this.checked ? "VAT Percentage" : "Tax Percentage";

										let el = document.querySelector("label[for=vat_is_incl]");
										let container = el.closest(".setting-field");
										container.className = this.checked ? "setting-field" : "setting-field hidden";


										']
								] );

								echo $this->template( 'switch', 'settings/components', [
									'label' => 'VAT is inclusive',
									'class' => Settings::get_tax_is_vat() === "enabled" ? "" : "hidden",
									'info' => 'Display VAT Incl or Excl on your product and collection pages',
									'setting_slug' => 'vat_is_incl',
								] );

								echo $this->template( 'switch', 'settings/components', [
									'label' => 'Show tax on product & collection pages',
									'info' => 'Display Sales Tax (or VAT) on your product and collection pages',
									'setting_slug' => 'sales_tax_is_visible',
								] );

								echo $this->template('page_selector', 'settings/components', [
									'page_name' => 'Cart',
									'setting_slug' => 'cart'
								]);

								echo $this->template('page_selector', 'settings/components', [
									'page_name' => 'Checkout',
									'setting_slug' => 'checkout'
								]);

								echo $this->template('page_selector', 'settings/components', [
									'page_name' => 'Checkout Thank You',
									'setting_slug' => 'checkout_thank_you'
								]);

								?>
							</div>

							<div class="general-actions">
								<a href="#" class="btn submit-btn cancel" name="general-cancel">
									<?php esc_html_e('Cancel', 'north-commerce'); ?>
								</a>
								<input type="submit" class="btn submit-btn activate" name="update_settings" value="<?php esc_attr_e('Save settings', 'north-commerce'); ?>">
							</div>

						</form>
					</section>
				</div>
			</div>
		</div>
	</div>
</div>
