<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Models\{
	ShippingProfileModel
};

/**
 * Pickup zones template
 *
 *
 * @package north-commerce/admin/templates/settings/local-pickup
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.24
 * @version 0.1.24
 */


$profile_model = new ShippingProfileModel();
$profiles_list = $profile_model->list();
$pickup_zones = $pickup_profile['shipping_zones'];

$pickup_zone = array_pop( $pickup_zones ); // single zone support

$pickup_zone['pickup_addresses'] = $pickup_zone['shipping_countries'] ?? [];
unset( $pickup_zone['shipping_countries'] );

list(
    $first_pickup_address
) = [
    reset( $pickup_zone['pickup_addresses'] )[0] ?? null,
    key( $pickup_zone['pickup_addresses'] ) ?? null
];

$pickup_address_id = $first_pickup_address['id'] ?? null;

?>
<div class="shipping-profile-list-container">
    <p class="profile-card__sub-title">
        <?php esc_html_e( 'Choose your pickup location', 'north-commerce' ); ?>
    </p>
    <select
        class="pickup-zone-address"
        id="pickup-zone-address"
        name="pickup_zone_address"
    >
        <?php
        foreach ( $profiles_list as $profile ) {
            $address = $profile['shipping_address'] ?? null;

            if ( empty( $address['preformatted_line'] ) ) {
                continue;
            }

            ?>
            <option
                data-address-id="<?php echo esc_attr( $address['id'] ); ?>"
                value="<?php echo esc_attr( $address['preformatted_line'] ); ?>"
                <?php selected( $address['id'] === $pickup_address_id ); ?>
            >
                <?php
                echo esc_html( $address['preformatted_line'] );
                ?>
            </option>
            <?php
        }
        ?>
    </select>
</div>