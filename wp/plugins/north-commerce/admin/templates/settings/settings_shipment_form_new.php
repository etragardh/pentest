<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Models\{
	ShippingProfileModel,
	CountryModel
};

/**
 * @package north-commerce/admin/templates/settings
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.24
 */

$profile_model = new ShippingProfileModel();

$default_shipping_address = $profile_model->get_default_shipping_address();
$uncovered_countries = ( new CountryModel() )->get_formated_list();

$shipment_tab_url = admin_url( 'admin.php?page=north-commerce-settings&tab=shipment' );
$subtemplates_dir = 'shipment';

?>
<div class="north-plugin north-settings shipment">
	<div class="shipping-profile">
		<form class="shipping-profile__container shipping-form shipping-form-new-page">
			<input type="hidden" id="shipping_profile_data" value="">
			<input type="hidden" name="redirect_url" value="<?php echo $shipment_tab_url; ?>">
			<input type="hidden" name="all_variants_included" value="0">

			<div class="shipping-profile__header">
				<a
					href="<?php echo $shipment_tab_url; ?>"
					class="btn btn--back"
				>
					<svg width="20" height="10" viewBox="0 0 20 10" fill="none">
						<path fill="#00073F" d="M3.83 4L6.41 1.41L5 0L0 5L5 10L6.41 8.59L3.83 6H20V4H3.83Z"/>
					</svg>
				</a>
				<h1 class="shipping-profile__title">
					<span class="shipping-profile-name">
						<?php esc_html_e( 'New', 'north-commerce' ); ?>
					</span>
					<?php esc_html_e( 'Shipping Profile', 'north-commerce' ); ?>
				</h1>
			</div>

			<div class="admin-popup__notice">
				<div class="north-error"></div>
			</div>

			<div class="profile-card">
				<div class="profile-card__header">
					<div class="profile-card__title">
						<?php esc_html_e( 'Name', 'north-commerce' ); ?>
					</div>
				</div>

				<div class="popup-field-new">
					<label class="popup-field-new__label" for="shipping_profile_name">
						<?php esc_html_e( 'Title', 'north-commerce' ); ?>
					</label>

					<div class="popup-field-new__input-wrapper">
						<input
							type="text"
							name="shipping_profile_name"
							id="shipping_profile_name"
							data-field-name="shipping_profile_name"
							class="shipping_profile_name popup-field-new__text-input"
							placeholder=""
							value=""
						>
					</div>

					<span class="popup-field-new__info">
						<?php esc_html_e( 'Customers won’t see this.', 'north-commerce' ); ?>
					</span>
				</div>
			</div>
			<?php

			$this->template( 'shipment-product-list', $subtemplates_dir );

			?>
			<div class="profile-card">
				<div class="profile-card__header">
					<div class="profile-card__title">
						<?php esc_html_e( 'Shipping from', 'north-commerce' ); ?>
					</div>
				</div>
				<?php

				$this->template( 'template-address-dropdown', $subtemplates_dir, [
					'shipping_address' => $default_shipping_address,
				] );

				?>
				<div class="shipping-zones">

					<div class="shipping-zones__header">
						<div class="profile-card__title">
							<?php esc_html_e( 'Shipping to', 'north-commerce' ); ?>
						</div>
						<button type="button" class="add-button create_shipping_zone__handler">
						<span class="add-button__icon"></span>
						<span class="add-button__label">
							<?php esc_html_e( 'Create shipping zone', 'north-commerce' ); ?>
						</span>
					</button>
					</div>

					<div class="shipping-zone-list">
						<?php
						$this->template( 'shipment-zone-item', $subtemplates_dir );
						?>
					</div>

					<div class="shipping-zone-list__empty has-no-data hide">
						<p class="title">
							<?php esc_html_e( 'No zones or rates', 'north-commerce' ); ?>
						</p>
						<p class="description">
							<?php esc_html_e( 'Add zones to create rates for places you want to ship to.', 'north-commerce' ); ?>
						</p>
					</div>

				</div>

				<hr class="full-width">

				<div class="not-covered">
					<input type="checkbox" id="not-covered-checkbox" class="not-covered__checkbox-input">

					<?php $this->template( 'planet', 'icons' ); ?>

					<span class="not-covered__title">
						<?php esc_html_e( 'Not covered by your shipping zones', 'north-commerce' ); ?>
					</span>

					<label class="not-covered__info" for="not-covered-checkbox">

						<span class="not-covered__info__label">
							<?php
							printf(
								'<span class="%1$s">%2$s</span> countries',
								'not-covered__info__label__number',
								count( $uncovered_countries ),
							);
							?>
						</span>

						<span class="not-covered__info__expander_icon">
							<svg width="12" height="8" viewBox="0 0 12 8" fill="none">
								<path fill="#747E94" d="M5.99955 7.09419L11.0079 2.08584L9.83039 0.906677L5.99955 4.74002L2.16954 0.906677L0.991211 2.08501L5.99955 7.09419Z"/>
							</svg>
						</span>

					</label>

					<div
						class="not-covered__countries"
						data-list="<?php echo htmlspecialchars( json_encode( $uncovered_countries ), ENT_QUOTES, 'UTF-8' ); ?>"
					>
						<?php echo implode( ', ', $uncovered_countries ); ?>
					</div>
				</div>
			</div>

			<div class="actions">
				<div></div>
				<div class="actions__group">
					<div class="loader shipping-profile-wait"></div>

					<a
						href="<?php echo $shipment_tab_url; ?>"
						class="btn btn--cancel"
					>
						<?php esc_html_e( 'Discard', 'north-commerce' ); ?>
					</a>

					<input
						type="submit"
						class="btn btn--submit shipping-form__submit-button"
						value="<?php esc_attr_e( 'Add', 'north-commerce' ); ?>"
					>
				</div>
			</div>
		</form>
	</div>
</div>
<?php

// Popup Forms

$this->template( 'popup-shipping-zone-manager', "$subtemplates_dir/popups" );
$this->template( 'popup-shipping-zone-rate-manager', "$subtemplates_dir/popups" );
$this->template( 'popup-shipment-address-manager', "$subtemplates_dir/popups" );
$this->template( 'popup-shipping-profile-products-manager', "$subtemplates_dir/popups" );

$this->template( 'popup-shippinng-profile-delete', "$subtemplates_dir/popups", [
	'options' => [
		'identifier' => [
			'input_name' => 'address_id',
			'input_value' => '',
			'form_class' => 'shipping-address-delete-popup'
		],
		'title' => __( 'Are you sure you want to delete this address?', 'north-commerce' ),
		'description' => __( 'This address will be deleted immediately. You can’t undo this action.', 'north-commerce' ),
        'submit' => __( 'Delete Shipping Address', 'north-commerce' ),
	]
] );
