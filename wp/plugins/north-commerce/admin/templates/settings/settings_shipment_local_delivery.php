<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Models\ShippingProfileModel;

/**
 * Local delivery settings
 *
 *
 * @package north-commerce/admin/templates/settings/
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.24
 * @version 0.1.24
 */


$profile_id = $_GET['local-delivery'] ?? null;
$profile_model = new ShippingProfileModel();
$local_profile = $profile_model->get_local_profile_by_id( $profile_id );

if ( ! $local_profile ) {
    return $this->template( 'settings_shipment', 'settings' );
}

$shipment_tab_url = admin_url( 'admin.php?page=north-commerce-settings&tab=shipment' );
$subtemplates_dir = 'settings/local-delivery';

?>
<div class="north-plugin north-settings shipment shipping-profile local-delivery-profile">
    <div class="shipping-profile">
        <form class="shipping-profile__container">

			<input
				type="hidden"
				id="shipping_profile_data"
				value="<?php echo htmlspecialchars( json_encode( $local_profile ), ENT_QUOTES, 'UTF-8' ); ?>"
			>

            <div class="shipping-profile__header">
                <a
                    href="<?php echo esc_url( $shipment_tab_url ); ?>"
                    class="btn btn--back"
                >
                    <svg width="20" height="10" viewBox="0 0 20 10" fill="none">
                        <path fill="#00073F" d="M3.83 4L6.41 1.41L5 0L0 5L5 10L6.41 8.59L3.83 6H20V4H3.83Z"/>
                    </svg>
                </a>
                <h1 class="shipping-profile__title">
                    <?php esc_html_e( 'Local Delivery Zones', 'north-commerce' ); ?>
                </h1>
            </div>

            <div class="profile-card">
                <?php
                $this->template( 'template-delivery-header', $subtemplates_dir );
                $this->template( 'template-delivery-warehouse', $subtemplates_dir, compact(
                    'profile_model',
                ) );
                $this->template( 'template-delivery-zones', $subtemplates_dir, compact(
                    'local_profile',
                ) );
                ?>
            </div>

            <div class="admin-popup__notice">
                <div class="north-error"></div>
            </div>

            <div class="actions">
                <div></div>
                <div class="actions__group">
                    <div class="loader shipping-profile-wait"></div>
                    <a
                        class="btn btn--cancel cancel-changes"
                        href="<?php echo esc_url( $shipment_tab_url ); ?>"
                    >
                        <?php esc_html_e( 'Cancel', 'north-commerce' ); ?>
                    </a>
                    <input
                        type="submit"
                        class="btn btn--submit"
                        value="<?php esc_attr_e( 'Save', 'north-commerce' ); ?>"
                        disabled
                    >
                </div>
            </div>
        </form>
    </div>
</div>
<?php

$this->template( 'popup-delivery-zone-manager', $subtemplates_dir . '/popups' );
$this->template( 'popup-shipping-zone-rate-manager', 'shipment/popups' );