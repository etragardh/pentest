<?php

defined( 'ABSPATH' ) || exit;

/**
 * Zone manager modal window
 *
 *
 * @package north-commerce/admin/templates/settings/local-delivery/popups
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.23
 * @version 0.1.24
 */

$profile_class = new North_Commerce_Shipping_Profile();
$subtemplates_dir = 'settings/local-delivery';

?>
<div class="nc-custom-popup" id="delivery-zone-manager-modal">
	<form class="popup-create-shipping-zone local-delivery-zone popup-new-countries admin-popup nc-custom-popup__window">

		<input type="hidden" name="shipping_zone_id">

		<div class="admin-popup__header">
			<div class="admin-popup__left-side">
				<h3
					class="integration-popup-name"
					data-create-title="<?php esc_attr_e( 'Select the country you deliver in', 'north-commerce' ); ?>"
					data-edit-title="<?php esc_attr_e( 'Edit the country you deliver in', 'north-commerce' ); ?>"
				></h3>
				<div class="loader"></div>
			</div>
			<a
				href="javascript:void(0);"
				data-nc-custom-popup-close class="admin-popup__close"
			></a>
		</div>

		<div class="admin-popup__body">
			<div class="admin-popup__notice"></div>

			<div class="admin-popup__content">
				<?php $this->template( 'template-delivery-zone-name', $subtemplates_dir ); ?>

				<div class="search-input-wrapper">
					<input
						type="text"
						name="country-filter-name"
						class="search-input country-filter-name"
						id="delivery-country-filter-name"
						placeholder="<?php esc_attr_e( 'Filter by country name', 'north-commerce' ); ?>"
					>
					<label
						for="delivery-country-filter-name"
						class="search-icon"
					></label>
				</div>

				<div class="empty-list hide">
					<?php esc_html_e( 'No results for: ', 'north-commerce' ); ?>
					<span class="search-query"></span>
				</div>

				<div class="popup-list popup-countries-list">
					<?php

					$regions = $profile_class->get_shipping_regions_for_countries();
					foreach ( $regions as $region_code => $region_data ) {
						?>
						<div
							class="local-delivery__region <?php echo esc_attr( 'region-' . $region_code ); ?>"
							id="<?php echo esc_attr( 'region-' . $region_code ); ?>"
							data-level="region"
							data-region="<?php echo esc_attr( $region_code ) ?>"
						>
							<div
								class="region__header"
								data-region="<?php echo esc_attr( $region_code ) ?>"
							>
								<p class="header__title">
									<?php echo esc_html( $region_data['name'] ); ?>
								</p>
								<div class="header__dropdown">
									<svg width="24" height="24" viewBox="0 0 24 24" fill="#00073F">
										<path d="M12.0002 15.713L18.0102 9.70299L16.5972 8.28799L12.0002 12.888L7.40423 8.28799L5.99023 9.70199L12.0002 15.713Z"/>
									</svg>
								</div>
							</div>
							<div class="region__countries">
								<?php
								foreach ( $region_data['countries'] as $country_slug => $country ) {
									?>
									<div
										class="country__item <?php echo esc_attr( 'country-' . $country_slug ); ?>"
										data-level="country"
										data-country-slug="<?php echo esc_attr( $country_slug ); ?>"
										data-country-name="<?php echo esc_attr( $country['name'] ); ?>"
									>
										<div class="local__delivery-country-wrapper">
											<div class="country__checkbox">
												<input
													type="checkbox"
													id="<?php echo esc_attr( 'country-' . $country_slug ); ?>"
													class="north-checkbox__handler"
													name="applied_countries[]"
													value="<?php echo esc_attr( $country_slug ); ?>"
													<?php checked( isset( $applied_countries[ $country_slug ] ) ); ?>
												>
												<label
													for="<?php echo esc_attr( 'country-' . $country_slug ); ?>"
													class="north-checkbox"
												></label>
												<label
													for="<?php echo esc_attr( 'country-' . $country_slug ); ?>"
													class="country__label local-delivery__country-label"
												>
													<?php echo esc_html( $country['name'] ); ?>
												</label>
											</div>
										</div>
										<?php $this->template( 'template-delivery-zone-zipcodes', $subtemplates_dir ); ?>
									</div>
									<?php
								}
								?>
							</div>
						</div>
						<?php
					}
					?>

					<div class="loader-wrap">
						<div class="loader"></div>
					</div>
				</div>

				<div class="admin-popup__actions">
					<a
						href="javascript:void(0);"
						class="btn btn--cancel admin-popup-cancel"
						data-nc-custom-popup-close
					>
						<?php esc_html_e( 'Cancel', 'north-commerce' ); ?>
					</a>
					<input
						type="submit"
						class="btn btn--submit admin-popup-submit local-delivery-submit"
						data-nc-value-create="<?php esc_attr_e( 'Create Delivery Zone', 'north-commerce' ); ?>"
						data-nc-value-edit="<?php esc_attr_e( 'Edit Delivery Zone', 'north-commerce' ); ?>"
						disabled
					>
				</div>
			</div>
		</div>
	</form>
</div>
