<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Models\NotificationModel;

/**
 * Notifcations tab.
 *
 *
 * @package north-commerce/admin/templates/settings
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.24
 */

$notification_model = new NotificationModel();

$configured_notification_slugs = [
    'order_confirmation',
    'payment_error',
    'shipping_confirmation',
    'new_order',
    'order_out_for_delivery',
    'order_ready_for_pickup'
];

?>
<div class="wrap north-settings">
    <div class="north-tab-wrapper">
        <?php $this->plugin_tabs(); ?>
    </div>

    <?php do_action('north_commerce_notices'); ?>

    <div id="wpmdb-main">
        <div id="settings-tab" class="settings-tab content-tab">
            <div class="settings-tab__head">
                <div class="head__wrapper">
                    <h2>
                        <?php esc_html_e( 'Settings', 'north-commerce' ); ?>
                    </h2>
                    <p>
                        <?php esc_html_e( 'You can manage and customize your notifications.', 'north-commerce' ); ?>
                    </p>
                </div>
            </div>

            <div class="settings-tab__body settings">
                <sidebar class="settings__sidebar settings-card">
                    <?php $this->template( 'nav', 'settings/components' ); ?>
                </sidebar>
                <div class="settings__content">
                    <section class="notification-section">
                        <?php
                        $notifications_types_list = $notification_model->list_types();
                        foreach ( $notifications_types_list as $notification_type ) {
                            ?>
                            <div class="notification-section__card card">
                                <h2 class="notification-section__label">
                                    <?php echo esc_html( $notification_type['title'] ); ?>
                                </h2>
                                <p class="notification-section__description">
                                    <?php echo esc_html( $notification_type['description'] ); ?>
                                </p>
                                <ul class="notification-section__list">
                                    <?php
                                    $notifications_list = $notification_model->list_by_type_id( $notification_type['id'] );
                                    foreach ( $notifications_list as $notification ) {
                                        if ( ! in_array( $notification['slug'], $configured_notification_slugs ) ) {
                                            /**
                                             * Temporarily disable all notifications,
                                             * except for those that have the HTML code of the email added by default.
                                             */
                                            continue;
                                        }

                                        ?>
                                        <li
                                            class="notification-section__item notification"
                                            data-notification-id="<?php echo esc_attr( $notification['slug'] ); ?>"
                                            title="<?php esc_attr_e( 'Edit template', 'north-commerce' ); ?>"
                                        >
                                            <div class="notification__header">
                                                <div class="notification__column">
                                                    <h3 class="notification__name">
                                                        <?php echo esc_html( $notification['title'] ); ?>
                                                    </h3>
                                                    <p class="notification__description">
                                                        <?php echo esc_html( $notification['description'] ); ?>
                                                    </p>
                                                </div>
                                                <div class="notification__row">
                                                    <a
                                                        href="<?php echo site_url( '/wp-admin/admin.php?page=north-commerce-settings&tab=notifications&notification=' . $notification['slug'] ); ?>"
                                                        class="notification__setting"
                                                        data-notification-id="<?php echo esc_attr( $notification['slug'] ); ?>"
                                                    >
                                                    </a>
                                                    <a href="javascript:void(0);" class="notification__dropdown"></a>
                                                </div>
                                            </div>
                                            <div class="notification__body">
                                                <div class="notification__line toggle-line">
                                                    <div class="toggle-line__name"><?php esc_html_e('Email notifications', 'north-commerce'); ?></div>
                                                    <div class="toggle-line__toggle">
                                                        <div class="switch">
                                                            <input
                                                                type="checkbox"
                                                                data-notification-id="<?php echo esc_attr( $notification['slug'] ); ?>"
                                                                class="notification-email"
                                                                name="<?php echo esc_attr( 'notification-email-' . $notification['slug'] ); ?>"
                                                                id="<?php echo esc_attr( 'notification-' . $notification['slug'] ); ?>"
                                                                <?php checked( $notification['email_enabled'] ); ?>
                                                            >
                                                            <label
                                                                class="switch-service-label"
                                                                for="<?php echo esc_attr( 'notification-' . $notification['slug'] ); ?>"
                                                            >
                                                                <span class="switch-dot"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="notification__line toggle-line">
                                                    <div class="toggle-line__name">
                                                        <?php esc_html_e( 'SMS', 'north-commerce' ); ?>
                                                    </div>
                                                    <div class="toggle-line__toggle">
                                                        <div class="switch">
                                                            <input
                                                                type="checkbox"
                                                                data-notification-id="<?php echo esc_attr( $notification['slug'] ); ?>"
                                                                class="notification-sms"
                                                                name="<?php echo esc_attr( 'notification-sms' . $notification['slug'] ); ?>"
                                                                id="<?php echo esc_attr( 'notification-sms' . $notification['slug'] ); ?>"
                                                                <?php checked( $notification['sms_enabled'] ); ?>
                                                            >
                                                            <label
                                                                class="switch-service-label"
                                                                for="<?php echo esc_attr( 'notification-sms' . $notification['slug'] ); ?>"
                                                            >
                                                                <span class="switch-dot"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <?php
                                    }
                                    ?>
                                </ul>
                                <?php

                                if ( 'admin' === $notification_type['slug'] ) {
                                    ?>
                                    <div class="toggle-line toggle-line_top-border">
                                        <div class="toggle-line__wrapper">
                                            <div class="toggle-line__name">
                                                <?php esc_html_e( 'Desktop notifications', 'north-commerce' ); ?>
                                            </div>
                                            <div class="toggle-line__description">
                                                <?php esc_html_e( 'Get desktop notifications when you receive a new order. This setting only applies to your current browser - you must have the North open in this browser to receive desktop notifications.', 'north-commerce' ); ?>
                                            </div>
                                        </div>
                                        <div class="toggle-line__toggle">
                                            <div class="switch">
                                                <input
                                                    type="checkbox"
                                                    name="desktop_notification"
                                                    id="desktop_notification"
                                                    <?php checked( $notification_type['desktop_enabled'] ); ?>
                                                >
                                                <label class="switch-service-label" for="desktop_notification">
                                                    <span class="switch-dot"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <?php
                                }

                                ?>
                            </div>
                            <?php
                        }
                        ?>
                        <div class="notification__overlay notification-wait"></div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>
