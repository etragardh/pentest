<?php
/*
 * A PHP file for defining our entity
 */
$agent = North_Commerce_Db_Agent::instance();
$schema = $agent->schema();
$entity_name = $agent->tableToEntityName($table_name);
?>
<div class="entity-def">
	<div class="entity-name"><?= $entity_name?> { </div>
	<div class="entity-attrs">
		<div class="entity-attr-comment">
			// Core Attributes
		</div>
		<?php foreach($table_info['cols'] as $col_name => $col_info) { ?>
			<div class="entity-attr">
				<?= $col_name ?> :
				<?= $col_info['type'] == 'REF' ? 'BIGINT' : $col_info['type'] ?>;
				<?php if(!nc_g($col_info, 'null', false)) { ?>
					<small>[required]</small>
				<?php } ?>
			</div>
		<?php  } ?>

		<div class="entity-attr-comment leading">
			// Expandable References
		</div>
		<?php foreach($table_info['cols'] as $col_name => $col_info) { ?>
			<?php if($col_info['type'] == 'REF') { ?>
				<div class="entity-attr">
					<?php $attr_name = $agent->tableToEntityName(str_replace('_id', '', $col_name)) ?>
					<?= $attr_name ?> : <a href="#<?= $col_info['ref_table']?>"><?= $agent->tableToEntityName($col_info['ref_table'])?></a>;
				</div>

			<?php  } ?>
		<?php }  ?>

		<?php foreach($schema->getTables() as $child_table_name => $child_table_info) { ?>
			<?php foreach($child_table_info['cols'] as $col_name => $col_info)  { ?>
				<?php if($col_info['type'] == 'REF' && $col_info['ref_table'] == $table_name) {  ?>
					<div class="entity-attr">
						<?= $agent->tableToEntityName($child_table_name) ?> : [
						<a href="#<?= $child_table_name?>"><?= $agent->tableToEntityName($child_table_name)?></a>,
						...
						];
					</div>
				<?php } ?>
			<?php } ?>
		<?php } ?>

	</div>
	<div class="entity-close">}</div>
</div>
