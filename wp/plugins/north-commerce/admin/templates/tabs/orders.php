<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Db\Collections\OrderStatuses;

/**
 * Orders tab template.
 *
 *
 * @package north-commerce/admin/templates/tabs
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.25
 */


$get_order = function () {
    if ( empty( $_GET['id'] ) ) {
        return;
    }

    $ea = North_Commerce_Db_Agent::instance()->entityAccess();
    try {
        return $ea->ref( $_GET['id'] );
    } catch ( Exception $e ) {
    }
};


$is_draft = function ( $order ): bool {
    return isset( $order['id'] )
        && OrderStatuses::draft()->id === $order['order_status_id'];
};

$order = $get_order();

$template = 'order-list';
if ( isset( $_GET['id'] ) ) {
    $template = $is_draft( $order )
        ? 'order-draft'
        : 'order-single';
}

?>
<div id="orders-tab" class="north-settings orders-tab">
    <?php $this->template( $template, 'order', compact( 'order' ) ); ?>
</div>
