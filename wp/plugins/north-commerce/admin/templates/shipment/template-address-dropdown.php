<?php

defined( 'ABSPATH' ) || exit;

/**
 * Address dropdown template
 *
 * @package north-commerce/admin/templates/shipment
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.1
 * @version 0.1.24
 */


$profile_model = $profile_model ?? new NorthCommerce\Models\ShippingProfileModel();
$profile_class = $profile_class ?? new North_Commerce_Shipping_Profile();

$profile_address_id = $shipping_profile['shipping_address']['id'] ?? null;
$profile_address_line = $shipping_profile['shipping_address']['preformatted_line'] ?? '';

$button_create_new_address = function () {
	?>
	<button type="button" class="add-button add-new-address-button">
		<span class="add-button__icon"></span>
		<span class="add-button__label">
			<?php esc_html_e( 'Add new ship from address', 'north-commerce' ); ?>
		</span>
	</button>
	<?php
};

?>
<div class="store-address-section">

	<div class="north-dropdown address-dropdown">
		<?php

		if ( ! $profile_address_id ) {
			$button_create_new_address();
		}

		?>
		<div class="north-dropdown__header<?php echo ! $profile_address_id ? ' hide' : ''; ?>">
			<span class="address<?php echo ! $profile_address_line ? ' empty' : ''; ?>">
				<span class="address__icon"></span>
				<span class="address__title">
					<?php echo esc_html( $profile_address_line ) ?: esc_html__( 'Add a "Ship From" Address.', 'north-commerce' ); ?>
				</span>
				<span class="address__country">
					<?php echo esc_html( $shipping_profile['shipping_address']['country']['name'] ?? '' ); ?>
				</span>
			</span>
			<div class="north-dropdown__header__toggle">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none">
					<path fill="#222222" d="M11.99 15.425L18 9.414L16.586 8L11.986 12.6L7.39301 8L5.97901 9.414L11.99 15.425Z"/>
				</svg>
			</div>
		</div>

		<div class="north-dropdown__body">

			<div class="address-list">
				<?php

				foreach ( $profile_model->list_addresses() as $address ) {
					?>
					<div
						class="north-radio shipping-address"
						data-id="<?php echo esc_attr( $address['id'] ); ?>"
						data-options="<?php echo htmlspecialchars( json_encode( $address ), ENT_QUOTES, 'UTF-8' ); ?>"
					>

						<input
							type="radio"
							name="shipping_address_id"
							class="address-checkbox-handler"
							value="<?php echo esc_attr( $address['id'] ); ?>"
							<?php checked( $address['id'] === $profile_address_id ); ?>
						>

						<span class="north-radio__label">
							<span class="address">
								<span class="address__icon address__icon--hide"></span>
								<span class="address__title">
									<?php echo esc_html( $address['preformatted_line'] ); ?>
								</span>
								<span class="address__country">
									<?php echo esc_html( $address['country']['name'] ); ?>
								</span>
								<span class="address__actions">
									<span class="address__actions__wrapper">
										<span class="address__actions__edit">
											<span class="north-icon north-icon--edit"></span>
										</span>
										<span class="address__actions__remove">
											<span class="north-icon  north-icon--trash"></span>
										</span>
									</span>
								</span>
							</span>
						</span>

					</div>
					<?php
				}

				?>
			</div><?php // address-list

			$button_create_new_address();

			?>
		</div><?php // north-dropdown__body ?>

	</div><?php // north-dropdown ?>

	<div class="north-dropdown address-dropdown template">
		<div class="north-dropdown__header">
			<span class="address">
				<span class="address__icon"></span>
				<span class="address__title"></span>
				<span class="address__country"></span>
			</span>
			<div class="north-dropdown__header__toggle">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none">
					<path fill="#222222" d="M11.99 15.425L18 9.414L16.586 8L11.986 12.6L7.39301 8L5.97901 9.414L11.99 15.425Z"/>
				</svg>
			</div>
		</div>
		<div class="north-dropdown__body">
			<div class="address-list">
				<div class="north-radio shipping-address template" data-options="" data-id="">

					<input
						type="radio"
						name="shipping_address_id"
						class="address-checkbox-handler"
						value=""
						>

					<span class="north-radio__label">
						<span class="address">
							<span class="address__icon address__icon--hide"></span>
							<span class="address__title"></span>
							<span class="address__country"></span>
							<span class="address__actions">
								<span class="address__actions__wrapper">
									<span class="address__actions__edit">
										<span class="north-icon north-icon--edit"></span>
									</span>
									<span class="address__actions__remove">
										<span class="north-icon north-icon--trash"></span>
									</span>
								</span>
							</span>
						</span>
					</span>

				</div>
			</div>
			<?php

			$button_create_new_address();

			?>
		</div>
	</div>
</div>
