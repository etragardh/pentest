<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Models\ShippingProfileModel;

/**
 * @package north-commerce/admin/templates/shipment
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.0
 * @version 0.1.24
 */

$profile_model = $profile_model ?? new ShippingProfileModel();

$shippable_products = $profile_model->list_shippable_products();
$related_products = $profile_model->list_related_products( $profile['id'] ?? null );

$is_default_profile = (bool) ( $profile['is_default'] ?? false );

$profile_subtitle = $is_default_profile
	? __( 'Here are all the products that are not in other Profiles. New products are added to this profile.', 'north-commerce' )
	: __( 'Manage Products and Variants for current Profile.', 'north-commerce' );

?>
<div
	class="profile-card shipment-product-list"
	data-selected-products="<?php echo htmlspecialchars( json_encode( $related_products ), ENT_QUOTES, 'UTF-8' ); ?>"
	data-shippable-products="<?php echo  htmlspecialchars( json_encode( $shippable_products ), ENT_QUOTES, 'UTF-8' ); ?>"
>
	<div class="profile-card__header with-actions">
		<div class="profile-card__title">
			<?php esc_html_e( 'Products', 'north-commerce' ); ?>
		</div>
		<div class="profile-card__sub-title">
			<?php echo esc_html( $profile_subtitle ); ?>
		</div>
		<div class="profile-card__actions">
			<button type="button" class="btn submit-btn manage">
				<?php esc_html_e( 'Manage', 'north-commerce' ); ?>
			</button>
		</div>
	</div>

	<hr class="full-width">

	<div class="products-list<?php echo ! $related_products ? ' hide' : ''; ?>">
		<?php
		$this->template( 'shipment-product-list-item', 'shipment' ); // product item template

		foreach ( $related_products as $product ) {
			$this->template( 'shipment-product-list-item', 'shipment', compact(
				'product'
			) );
		}
		?>
	</div>

	<div class="product-list--empty has-no-data<?php echo $related_products ? ' hide' : ''; ?>">
		<p class="title">
			<?php esc_html_e( 'No products', 'north-commerce' ); ?>
		</p>
		<p class="description">
			<?php esc_html_e( 'Add products here to set up separate rates from default.', 'north-commerce' ); ?>
		</p>
	</div>
</div>
