<?php

defined( 'ABSPATH' ) || exit;

/**
 * @package north-commerce/admin/templates/shipment/popups
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.1
 * @version 0.1.24
 */

$profile_class = new North_Commerce_Shipping_Profile();

?>
<form class="popup-create-shipping-zone admin-popup north-settings popup-create-shipping-zone">
    <input type="hidden" name="shipping_zone_id">

	<div class="admin-popup__header">
		<div class="admin-popup__left-side">
			<h3
				class="integration-popup-name"
				data-create-title="<?php esc_attr_e( 'Create Shipping Zone', 'north-commerce' ); ?>"
				data-edit-title="<?php esc_attr_e( 'Edit Shipping Zone', 'north-commerce' ); ?>"
			></h3>
			<div class="loader"></div>
		</div>
		<a
			href="javascript:void(0);"
			class="admin-popup__close"
			data-fancybox-close
		></a>
	</div>

	<div class="admin-popup__body">
		<div class="admin-popup__notice"></div>

		<div class="admin-popup__content">
			<div class="popup-field-new">
				<label class="popup-field-new__label" for="add_zone_name">
					<?php esc_html_e( 'Zone name', 'north-commerce' ); ?>
				</label>
				<div class="popup-field-new__input-wrapper">
					<input
						type="text"
						name="zone_name"
						id="add_zone_name"
						class="zone_name popup-field-new__text-input"
						placeholder="<?php esc_attr_e( 'Zone name', 'north-commerce' ); ?>"
						value=""
					>
				</div>
				<span class="popup-field-new__info">
					<?php esc_html_e( 'Customers wonâ€™t see this.', 'north-commerce' ); ?>
				</span>
			</div>

			<div class="popup-field-new search-input">
				<div class="popup-field-new__input-wrapper search-input">
					<input
						type="text"
						name="zone_location_search"
						class="zone_location_search popup-field-new__text-input"
						id="zone_location_search"
						placeholder="<?php esc_attr_e( 'Search countries and subunits', 'north-commerce' ); ?>"
					>
					<label
						for="zone_location_search"
						class="popup-field-new__input-wrapper__icon search-icon"
					>
					</label>
				</div>
			</div>

			<div class="zone-selectors-not-found hide">
				<?php esc_html_e( 'No results for', 'north-commerce' ); ?>
				<span class="zone-selectors-not-found__search"></span>
			</div>

			<div class="zone-selectors regions-container">
				<?php
				foreach ( $profile_class->get_shipping_regions() as $region_code => $region ) {
					?>
					<div
						class="zone-selectors__region parent-holder <?php echo esc_attr( 'region-' . $region_code ); ?>"
						data-level="region"
						data-region-code="<?php echo esc_attr( $region_code ); ?>"
					>
						<div class="zone-selectors__region__wrapper">
							<div class="zone-selectors__region__checkbox">
								<input
									type="checkbox"
									name="regions[]"
									id="<?php echo esc_attr( 'region-' . $region_code ); ?>"
									class="zone-selectors__checkbox north-checkbox__handler"
									value="<?php echo esc_attr( $region_code ); ?>"
								>
								<label
									for="<?php echo esc_attr( 'region-' . $region_code ); ?>"
									class="north-checkbox"
								>
								</label>
							</div>

							<div for="" class="zone-selectors__region__label">
								<?php echo esc_html( $region['name'] ); ?>
							</div>

							<label
								for="<?php echo esc_attr( 'dropdown_region-' . $region_code ); ?>"
								class="region__toggle<?php echo ! $region['countries'] ? ' hide' : ''; ?>"
							>
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none">
									<path d="M12.0002 15.713L18.0102 9.70299L16.5972 8.28799L12.0002 12.888L7.40423 8.28799L5.99023 9.70199L12.0002 15.713Z"/>
								</svg>
							</label>
						</div>

						<input
							type="checkbox"
							id="<?php echo esc_attr( 'dropdown_region-' . $region_code ); ?>"
							class="dropdown-checkbox zone-selectors__region__expander<?php echo ! $region['countries'] ? ' hide' : ''; ?>"
						>

						<div class="sub-items children-items countries-list">
							<?php
							foreach ( $region['countries'] as $country_code => $country ) {
								$subunits_list = $country['division']['subunits'] ?? [];

								?>
								<div
									class="sub-item parent-holder <?php echo esc_attr( 'region-' . $region_code . '-country-' . $country_code ); ?>"
									data-level="country"
									data-country-code="<?php echo esc_attr( $country_code ); ?>"
								>
									<div class="country-item-wrapper">
										<div class="sub-item__checkbox">
											<input
												type="checkbox"
												name="countries[]"
												id="<?php echo esc_attr( 'country-' . $country_code ); ?>"
												class="sub-item__checkbox__input zone-selectors__checkbox north-checkbox__handler"
												value="<?php echo esc_attr( $country_code ); ?>"
											>
											<label
												for="<?php echo esc_attr( 'country-' . $country_code ); ?>"
												class="north-checkbox"
											>
											</label>
										</div>

										<div class="sub-item__image">
											<svg width="32" height="24" viewBox="0 0 34 24">
												<use
													href="<?php echo NORTH_COMMERCE_PLUGIN_DIR_URL . 'admin/images/countries-sprite.svg#' . strtolower( $country_code ); ?>"
													data-href="<?php echo NORTH_COMMERCE_PLUGIN_DIR_URL . 'admin/images/countries-sprite.svg#'; ?>"
												>
											</svg>
										</div>

										<div class="sub-item__label">
											<?php echo esc_html( $country['name'] ); ?>
										</div>

										<div class="sub-item__info">
											<span class="subunits-count<?php echo ! $subunits_list ? ' hide' : ''; ?>">
												<?php
												if ( $subunits_list ) {
													echo '<span class="selected-subunits-counter">0</span>&nbsp;';
													printf(
														'of <span class="country-subunits-counter">%s</span>&nbsp;<span class="country-units-name">%s</span>',
														count( $subunits_list ),
														esc_html( $country['division']['name']['plural'] ?? '' )
													);
												}
												?>
											</span>
										</div>

										<label
											for="<?php echo esc_attr( 'dropdown_country-' . $country_code ); ?>"
											class="sub-item__handler<?php echo ! $subunits_list ? ' hide' : ''; ?>"
										>
											<svg width="24" height="24" viewBox="0 0 24 24" fill="none">
												<path d="M12.0002 15.713L18.0102 9.70299L16.5972 8.28799L12.0002 12.888L7.40423 8.28799L5.99023 9.70199L12.0002 15.713Z" />
											</svg>
										</label>
									</div>

									<div class="zone-selectors__states">
										<input
											type="checkbox"
											id="<?php echo esc_attr( 'dropdown_country-' . $country_code ); ?>"
											class="dropdown-checkbox zone-selectors__states__expander"
										>

										<div class="states-container children-items">
											<?php

											foreach ( $subunits_list as $subunit_code => $subunit_name ) {
												?>
												<div
													class="sub-sub-item parent-holder <?php echo esc_attr( 'region-' . $region_code . '-country-' . $country_code . '-subunit-' . $subunit_code ); ?>"
													data-level="subunit"
												>
													<div class="sub-sub-item__wrapper">
														<div class="sub-sub-item__checkbox">
															<input
																type="checkbox"
																class="zone-selectors__checkbox north-checkbox__handler"
																name="subunits[]"
																id="<?php echo esc_attr( 'state-' . $region_code . '-' . $subunit_code ); ?>"
																value="<?php echo esc_attr( $subunit_code ); ?>"
															>
															<label
																for="<?php echo esc_attr( 'state-' . $region_code . '-' . $subunit_code ); ?>"
																class="north-checkbox"
															>
															</label>
														</div>
														<div
															for="<?php echo esc_attr( 'state-' . $subunit_code ); ?>"
															class="sub-sub-item__label"
														>
															<?php esc_html_e( $subunit_name ); ?>
														</div>
													</div>
												</div>
												<?php
											}

											?>
										</div>
									</div>
								</div>
								<?php
							}
							?>
						</div>
					</div>
					<?php
				}
				?>
			</div>

			<div class="admin-popup__actions">
				<a href="javascript:void(0);" data-fancybox-close class="btn btn--cancel admin-popup-cancel">
 					<?php esc_html_e( 'Cancel', 'north-commerce' ); ?>
				</a>
				<input
					type="submit"
					class="btn btn--submit admin-popup-submit"
					value="<?php esc_attr_e( 'Create zone', 'north-commerce' ); ?>"
					disabled
				>
			</div>
		</div>
	</div>
</form>
