<?php

defined( 'ABSPATH' ) || exit;

use NorthCommerce\Models\CountryModel;

/**
 * Regional rates template
 *
 * @package north-commerce/admin/templates/shipment
 * @author  North Commerce <hello@northplugins.com>
 * @link    https://northcommerce.com/
 * @since   0.1.24
 * @version 0.1.24
 */


$get_profile_countries_list = function() use ( $profile ) {
	$country_model = new CountryModel();
	$countries_list = $country_model->get_formated_list();

	$countries = [];
	foreach ( $profile['shipping_zones'] as $zone ) {
		foreach ( $zone['shipping_countries'] as $country_code => $subunits ) {
			if ( $countries_list[ $country_code ] ) {
				$countries[] = $countries_list[ $country_code ];
			}
		}
	}

	return implode( ', ', $countries );
};

$count_profile_regional_rates = function() use ( $profile ) {
	$rates_counter = 0;

	foreach ( $profile['shipping_zones'] as $zone ) {
		$rates_counter += count( $zone['shipping_rates_internal'] ) + count( $zone['shipping_rates_easypost'] );
	}

	return $rates_counter;
};

?>
<div class="single-shipping-profile__rates">
	<?php
	if ( count( $profile['shipping_zones'] ) ) {

		?>
		<div class="single-shipping-profile__rates__item">
			<div class="single-shipping-profile__rates__item__icon">
				<?php $this->template( 'planet', 'icons' ); ?>
			</div>
			<div class="single-shipping-profile__rates__item__label">
				<?php
				printf(
					__( '%s - %s rates', 'north-commerce' ),
					$get_profile_countries_list(),
					$count_profile_regional_rates(),
				);
				?>
			</div>
		</div>
		<?php

	} else {

		?>
		<div class="single-shipping-profile__rates--empty has-no-data">
			<p class="title">
				<?php esc_html_e( 'No shipping rates', 'north-commerce' ); ?>
			</p>
			<p class="description">
				<?php esc_html_e( 'Create shipping rates so customers will see shipping at checkout.', 'north-commerce' ); ?>
			</p>
		</div>
		<?php

	}
	?>
</div>
