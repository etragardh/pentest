document.addEventListener('DOMContentLoaded', function() {

	const ordersList = document.querySelector('.orders__board .result__orders')
	const easyPostManager = window.NorthCommerce.EasyPostManager
	const createShippingBtn = document.querySelector('.order-shipping-button')
	const orderShippingModal = document.querySelector('.order-shipping-modal')
	const dismissModalBtns = document.querySelectorAll('.dismiss-modal')


	setOrderItemClickListener()

	dismissModalBtns.forEach((btn) => {
		btn.addEventListener('click', () => {
			orderShippingModal.style.display = 'none';
		});
	});


	function setOrderItemClickListener() {
		if (!ordersList) {
			return
		}

		ordersList.addEventListener('click', handleOrderItemClick)
	}

	function handleOrderItemClick(e) {
		if (
			'A' === e.target.tagName
			|| e.target.closest('a')
			|| e.target.closest('.order__select')
			|| e.target.closest('.customer.active')
		) {
			return
		}

		const orderItem = e.target.closest('[data-order-id]')

		if (!orderItem) {
			return
		}

		const permalink = orderItem.dataset.orderUrl

		if (!permalink) {
			return
		}

		window.location.href = permalink
	}

	// Easy Post Label Creation
	const openShippingLabelModal = document.querySelector('[data-nc-ship-action]');
	if (openShippingLabelModal) {
		openShippingLabelModal.addEventListener('click', function() {
		const orderId = this.getAttribute('data-nc-ship-action');
			easyPostManager.getOrderLineItems(orderId);
		});
	}

	jQuery(document).on('click', function(e) {
		if (!jQuery(e.target).closest('.customer.active').length) {
			if (jQuery('.customer.active').length > 0) {
				jQuery('.order__customer .customer').hide()
				jQuery('.order__customer .customer').removeClass('active')
			}
		}
	})

	// Show customer details
	jQuery(document).on('click', '.order__customer > a', function(e) {
		e.stopPropagation()
		const customer = jQuery(this).parent().find('.customer')

		if (customer.hasClass('active')) {
			customer.hide('fast')
			customer.removeClass('active')
			return
		}

		jQuery('.order__customer .customer').hide()
		jQuery('.order__customer .customer').removeClass('active')
		customer.addClass('active')
		customer.show('fast')
	})

})
