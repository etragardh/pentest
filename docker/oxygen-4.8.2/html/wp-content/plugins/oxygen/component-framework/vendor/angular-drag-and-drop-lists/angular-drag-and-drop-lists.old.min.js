/**
 * angular-drag-and-drop-lists v2.1.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2017 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
(function(a){function b(j,k){return'all'==k?j:j.filter(function(l){return-1!=k.toLowerCase().indexOf(l)})}var c='application/x-dnd',d='application/json',f='Text',g=['move','copy','link'];a.directive('dndDraggable',['$parse','$timeout',function(j,k){return function(l,m,n){m.attr('draggable','true'),n.dndDisableIf&&l.$watch(n.dndDisableIf,function(o){m.attr('draggable',!o)}),m.on('dragstart',function(o){if(o=o.originalEvent||o,'false'==m.attr('draggable'))return!0;h.isDragging=!0,h.itemType=n.dndType&&l.$eval(n.dndType).toLowerCase(),h.dropEffect='none',h.effectAllowed=n.dndEffectAllowed||g[0],o.dataTransfer.effectAllowed=h.effectAllowed;var p=l.$eval(n.dndDraggable),q=c+(h.itemType?'-'+h.itemType:'');try{o.dataTransfer.setData(q,angular.toJson(p))}catch(u){var r=angular.toJson({item:p,type:h.itemType});try{o.dataTransfer.setData(d,r)}catch(v){var s=b(g,h.effectAllowed);o.dataTransfer.effectAllowed=s[0],o.dataTransfer.setData(f,r)}}if(m.addClass('dndDragging'),k(function(){m.addClass('dndDraggingSource')},0),o._dndHandle&&o.dataTransfer.setDragImage&&o.dataTransfer.setDragImage(m[0],0,0),j(n.dndDragstart)(l,{event:o}),n.dndCallback){var t=j(n.dndCallback);h.callback=function(u){return t(l,u||{})}}o.stopPropagation()}),m.on('dragend',function(o){o=o.originalEvent||o,l.$apply(function(){var p=h.dropEffect;j(n[{copy:'dndCopied',link:'dndLinked',move:'dndMoved',none:'dndCanceled'}[p]])(l,{event:o}),j(n.dndDragend)(l,{event:o,dropEffect:p})}),h.isDragging=!1,h.callback=void 0,m.removeClass('dndDragging'),m.removeClass('dndDraggingSource'),o.stopPropagation(),k(function(){m.removeClass('dndDraggingSource')},0)}),m.on('click',function(o){n.dndSelected&&(o=o.originalEvent||o,l.$apply(function(){j(n.dndSelected)(l,{event:o})}),o.stopPropagation())}),m.on('selectstart',function(){this.dragDrop&&this.dragDrop()})}}]),a.directive('dndList',['$parse',function(j){return function(k,l,m){function n(z){if(!z)return f;for(var A=0;A<z.length;A++)if(z[A]==f||z[A]==d||z[A].substr(0,c.length)==c)return z[A];return null}function o(z){return h.isDragging?h.itemType||void 0:z==f||z==d?null:z&&z.substr(c.length+1)||void 0}function p(z){return!y.disabled&&(y.externalSources||h.isDragging)&&(y.allowedTypes&&null!==z?z&&-1!=y.allowedTypes.indexOf(z):!0)}function q(z,A){var B=g;return A||(B=b(B,z.dataTransfer.effectAllowed)),h.isDragging&&(B=b(B,h.effectAllowed)),m.dndEffectAllowed&&(B=b(B,m.dndEffectAllowed)),B.length?z.ctrlKey&&-1!=B.indexOf('copy')?'copy':z.altKey&&-1!=B.indexOf('link')?'link':B[0]:'none'}function r(){return v.remove(),l.removeClass('dndDragover'),!0}function s(z,A,B,C,D,E){return j(z)(k,{callback:h.callback,dropEffect:B,event:A,external:!h.isDragging,index:D===void 0?t():D,item:E||void 0,type:C})}function t(){return Array.prototype.indexOf.call(x.children,w)}var v=function(){var z;return angular.forEach(l.children(),function(A){var B=angular.element(A);B.hasClass('dndPlaceholder')&&(z=B)}),z||angular.element('<li class=\'dndPlaceholder\'></li>')}();v.remove();var w=v[0],x=l[0],y={};l.on('dragenter',function(z){z=z.originalEvent||z;var A=m.dndAllowedTypes&&k.$eval(m.dndAllowedTypes);y={allowedTypes:angular.isArray(A)&&A.join('|').toLowerCase().split('|'),disabled:m.dndDisableIf&&k.$eval(m.dndDisableIf),externalSources:m.dndExternalSources&&k.$eval(m.dndExternalSources),horizontal:m.dndHorizontalList&&k.$eval(m.dndHorizontalList)};var B=n(z.dataTransfer.types);return B&&p(o(B))?void z.preventDefault():!0}),l.on('dragover',function(z){z=z.originalEvent||z;var A=n(z.dataTransfer.types),B=o(A);if(!A||!p(B))return!0;if(w.parentNode!=x&&l.append(v),z.target!=x){for(var C=z.target;C.parentNode!=x&&C.parentNode;)C=C.parentNode;if(C.parentNode==x&&C!=w){var D=C.getBoundingClientRect();if(y.horizontal)var E=z.clientX<D.left+D.width/2;else var E=z.clientY<D.top+D.height/2;x.insertBefore(w,E?C:C.nextSibling)}}else{var C=z.target,F=C.children,G=document.getElementsByClassName('dndPlaceholder');for(G[0].parentNode.removeChild(G[0]),C.appendChild(w),i=0;i<F.length;i++)if(!(F[i].classList.contains('dndPlaceholder')||F[i].classList.contains('dndDraggingCloneSource')||F[i].classList.contains('dndDraggingSource'))){var D=F[i].getBoundingClientRect();if(y.horizontal){if(z.clientX<D.left){C.insertBefore(w,F[i]);break}}else if(z.clientY<D.top){C.insertBefore(w,F[i]);break}}}var H=A==f,I=q(z,H);return'none'==I?r():m.dndDragover&&!s(m.dndDragover,z,I,B)?r():(z.preventDefault(),H||(z.dataTransfer.dropEffect=I),l.addClass('dndDragover'),z.stopPropagation(),!1)}),l.on('drop',function(z){z=z.originalEvent||z;var A=n(z.dataTransfer.types),B=o(A);if(!A||!p(B))return!0;z.preventDefault();try{var C=JSON.parse(z.dataTransfer.getData(A))}catch(G){return r()}if((A==f||A==d)&&(B=C.type||void 0,C=C.item,!p(B)))return r();var D=A==f,E=q(z,D);if('none'==E)return r();var F=t();return m.dndDrop&&(C=s(m.dndDrop,z,E,B,F,C),!C)?r():(h.dropEffect=E,D||(z.dataTransfer.dropEffect=E),!0!==C&&k.$apply(function(){k.$eval(m.dndList).splice(F,0,C)}),s(m.dndInserted,z,E,B,F,C),r(),z.stopPropagation(),!1)}),l.on('dragleave',function(z){z=z.originalEvent||z;var A=document.elementFromPoint(z.clientX,z.clientY);x.contains(A)&&!z._dndPhShown?z._dndPhShown=!0:r()})}}]),a.directive('dndNodrag',function(){return function(j,k){k.attr('draggable','true'),k.on('dragstart',function(m){m=m.originalEvent||m,m._dndHandle||(!(m.dataTransfer.types&&m.dataTransfer.types.length)&&m.preventDefault(),m.stopPropagation())}),k.on('dragend',function(m){m=m.originalEvent||m,m._dndHandle||m.stopPropagation()})}}),a.directive('dndHandle',function(){return function(j,k){k.attr('draggable','true'),k.on('dragstart dragend',function(m){m=m.originalEvent||m,m._dndHandle=!0})}});var h={}})(angular.module('dndLists',[]));