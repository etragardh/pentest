#!/usr/bin/env python3
import requests, sys, pickle

# Args =)
if len(sys.argv) > 1:
    host=sys.argv[1]
else:
    host="https://vuln-patch.blueteamer.io"

if len(sys.argv) > 2:
    username=sys.argv[2]
else:
    username="emil"

if len(sys.argv) > 3:
    password=sys.argv[3]
else:
    password="hello"

# Contacts
wp_login = host+'/wp-login.php'
wp_admin = host+'/wp-admin/'

print("Attacking: ",host,username,password)

# Cookie helpers
def save_cookies(requests_cookiejar, filename):
    with open(filename, 'wb') as f:
        pickle.dump(requests_cookiejar, f)

def load_cookies(filename):
    with open(filename, 'rb') as f:
        return pickle.load(f)

# Attack
with requests.Session() as s:
    headers1 = { 'Cookie':'wordpress_test_cookie=WP Cookie check' }
    datas={ 
        'log':username, 'pwd':password, 'wp-submit':'Log In', 
        'redirect_to':wp_admin, 'testcookie':'1'  
    }
    s.post(wp_login, headers=headers1, data=datas)
    resp = s.get(wp_admin)
    print(resp.text)

    # Save session to file
    save_cookies(s.cookies, '_cookies')

